<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>galaxywars - Akashic</title>
<script>
	require=function t(e,i,r){function s(n,a){if(!i[n]){if(!e[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(o)return o(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var d=i[n]={exports:{}};e[n][0].call(d.exports,function(t){var i=e[n][1][t];return s(i?i:t)},d,d.exports,t,e,i,r)}return i[n].exports}for(var o="function"==typeof require&&require,n=0;n<r.length;n++)s(r[n]);return s}({"@akashic/akashic-engine":[function(t,e,i){(function(){"use strict";var t,i=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)};!function(t){var e;!function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(e=t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e){var i=new Error(t+" has no implementation.");return i.name="PureVirtualError",i.cause=e,i}function r(t,e){var i=new Error(t);return i.name="AssertionError",i.cause=e,i}function s(t,e,i,r){var s="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var o;o=i&&i.constructor&&i.constructor.name?i.constructor.name:typeof i,s+=", actual type is "+(o.length>40?o.substr(0,40):o)}catch(n){}s+=".";var a=new Error(s);return a.name="TypeMismatchError",a.cause=r,a.expected=e,a.actual=i,a}function o(e,i,r,s){void 0===i&&(i=!0),void 0===r&&(r=t.AssetLoadErrorType.Unspecified);var o=new Error(e);return o.name="AssetLoadError",o.cause=s,o.retriable=i,o.type=r,o}e.createPureVirtualError=i,e.createAssertionError=r,e.createTypeMismatchError=s,e.createAssetLoadError=o}(e=t.ExceptionFactory||(t.ExceptionFactory={}))}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.createImageAsset=function(e,i,r,s){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createImageAsset")},e.prototype.createVideoAsset=function(e,i,r,s,o,n,a){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createVideoAsset")},e.prototype.createAudioAsset=function(e,i,r,s,o,n){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createAudioAsset")},e.prototype.createTextAsset=function(e,i){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createTextAsset")},e.prototype.createAudioPlayer=function(e){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createAudioPlayer")},e.prototype.createScriptAsset=function(e,i){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createScriptAsset")},e.prototype.createSurface=function(e,i){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createSurface")},e.prototype.createGlyphFactory=function(e,i,r,s,o,n,a,h){throw t.ExceptionFactory.createPureVirtualError("ResourceFactory#createGlphFactory")},e.prototype.createSurfaceAtlas=function(e,i){return new t.SurfaceAtlas(this.createSurface(e,i))},e}();t.ResourceFactory=e}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();t.RequireCachedValue=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.seed=t}return e.prototype.get=function(e,i){throw t.ExceptionFactory.createPureVirtualError("RandomGenerator#get")},e.prototype.serialize=function(){throw t.ExceptionFactory.createPureVirtualError("RandomGenerator#serialize")},e}();t.RandomGenerator=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e)}return e.prototype.destroy=function(){this.id=void 0,this.originalPath=void 0,this.path=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._load=function(e){throw t.ExceptionFactory.createPureVirtualError("Asset#_load")},e.prototype._assetPathFilter=function(t){return t},e}();t.Asset=e;var r=function(e){function r(t,i,r,s){var o=e.call(this,t,i)||this;return o.width=r,o.height=s,o}return i(r,e),r.prototype.asSurface=function(){throw t.ExceptionFactory.createPureVirtualError("ImageAsset#asSurface")},r}(e);t.ImageAsset=r;var s=function(e){function r(t,i,r,s,o,n,a){var h=e.call(this,t,i,r,s)||this;return h.realWidth=0,h.realHeight=0,h._system=o,h._loop=n,h._useRealSize=a,h}return i(r,e),r.prototype.asSurface=function(){throw t.ExceptionFactory.createPureVirtualError("VideoAsset#asSurface")},r.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},r.prototype.stop=function(){this.getPlayer().stop()},r.prototype.getPlayer=function(){throw t.ExceptionFactory.createPureVirtualError("VideoAsset#getPlayer")},r.prototype.destroy=function(){this._system=void 0,e.prototype.destroy.call(this)},r}(r);t.VideoAsset=s;var o=function(t){function e(e,i,r,s,o,n){var a=t.call(this,e,i)||this;return a.duration=r,a.loop=o,a.hint=n,a._system=s,a.data=void 0,a}return i(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,t.prototype.destroy.call(this)},e}(e);t.AudioAsset=o;var n=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.data=void 0,r}return i(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(e);t.TextAsset=n;var a=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return i(r,e),r.prototype.execute=function(e){throw t.ExceptionFactory.createPureVirtualError("ScriptAsset#execute")},r.prototype.destroy=function(){this.script=void 0,e.prototype.destroy.call(this)},r}(e);t.ScriptAsset=a}(t||(t={}));var t;!function(t){function e(t){t=t||{};var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var i in e)i in t||(t[i]=e[i]);return t}var i=function(){function t(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1}return t}(),r=function(){function r(t,i,r){this.game=t,this.configuration=this._normalize(i||{},e(r)),this._assets={},this._liveAssetVirtualPathTable={},this._liveAbsolutePathTable={},this._refCounts={},this._loadings={}}return r.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.game=void 0,this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAbsolutePathTable=void 0,this._refCounts=void 0,this._loadings=void 0},r.prototype.destroyed=function(){return void 0===this.game},r.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var i=this._loadings[e.id];if(i.errorCount>r.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw t.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}i.loading||(i.loading=!0,e._load(this))},r.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var i in e)e.hasOwnProperty(i)&&e[i].global&&t.push(i);return t},r.prototype.requestAsset=function(t,e){var r,s="string"==typeof t?t:t.id,o=!1;if(this._assets.hasOwnProperty(s))++this._refCounts[s],e._onAssetLoad(this._assets[s]);else if(this._loadings.hasOwnProperty(s))r=this._loadings[s],r.handlers.push(e),++this._refCounts[s],o=!0;else{var n=this._createAssetFor(t);r=new i(n,e),this._loadings[s]=r,this._refCounts[s]=1,o=!0,r.loading=!0,n._load(this)}return o},r.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},r.prototype.requestAssets=function(t,e){for(var i=0,r=0,s=t.length;s>r;++r)this.requestAsset(t[r],e)&&++i;return i},r.prototype.unrefAssets=function(t){for(var e=0,i=t.length;i>e;++e)this.unrefAsset(t[e])},r.prototype._normalize=function(e,i){var r={};if(!(e instanceof Object))throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var s in e)if(e.hasOwnProperty(s)){var o=Object.create(e[s]);if(!o.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+s);if(!o.virtualPath)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+s);if(!o.type)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+s);if("image"===o.type){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+s);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+s)}if("audio"===o.type){void 0===o.duration&&(o.duration=0);var n=i[o.systemId];void 0===o.loop&&(o.loop=!!n&&!!n.loop),void 0===o.hint&&(o.hint=n?n.hint:{})}if("video"===o.type&&!o.useRealSize){if("number"!=typeof o.width)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+s);if("number"!=typeof o.height)throw t.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+s);o.useRealSize=!1}o.global||(o.global=!1),r[s]=o}return r},r.prototype._createAssetFor=function(e){var i,r,s;if("string"==typeof e)i=e,s=this.configuration[i],r=this.configuration[i].path;else{var o=e;i=o.id,s=o,r=o.uri}var n=this.game.resourceFactory;if(!s)throw t.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+i);switch(s.type){case"image":return n.createImageAsset(i,r,s.width,s.height);case"audio":var a=s.systemId?this.game.audio[s.systemId]:this.game.audio[this.game.defaultAudioSystemId];return n.createAudioAsset(i,r,s.duration,a,s.loop,s.hint);case"text":return n.createTextAsset(i,r);case"script":return n.createScriptAsset(i,r);case"video":return n.createVideoAsset(i,r,s.width,s.height,new t.VideoSystem,s.loop,s.useRealSize);default:throw t.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+s.type+" for asset ID: "+i)}},r.prototype._releaseAsset=function(e){var i,r=this._assets[e]||this._loadings[e]&&this._loadings[e].asset;if(r)if(i=r.path,r.inUse())if(r instanceof t.AudioAsset)r._system.requestDestroy(r);else{if(!(r instanceof t.VideoAsset))throw t.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+r.constructor.name);r.destroy()}else r.destroy();if(delete this._refCounts[e],delete this._loadings[e],delete this._assets[e],this.configuration[e]){var s=this.configuration[e].virtualPath;s&&this._liveAssetVirtualPathTable.hasOwnProperty(s)&&delete this._liveAssetVirtualPathTable[s],i&&this._liveAbsolutePathTable.hasOwnProperty(i)&&delete this._liveAbsolutePathTable[i]}},r.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},r.prototype._onAssetError=function(e,i){if(!this.destroyed()&&!e.destroyed()){var s=this._loadings[e.id],o=s.handlers;s.loading=!1,++s.errorCount,s.errorCount>r.MAX_ERROR_COUNT&&i.retriable&&(i=t.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,t.AssetLoadErrorType.RetryLimitExceeded,i)),i.retriable||delete this._loadings[e.id];for(var n=0;n<o.length;++n)o[n]._onAssetError(e,i,this)}},r.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id];if(i.loading=!1,delete this._loadings[e.id],this._assets[e.id]=e,this.configuration[e.id]){var r=this.configuration[e.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(r)){if(this._liveAssetVirtualPathTable[r].path!==e.path)throw t.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[r]=e;this._liveAbsolutePathTable.hasOwnProperty(e.path)||(this._liveAbsolutePathTable[e.path]=r)}for(var s=i.handlers,o=0;o<s.length;++o)s[o]._onAssetLoad(e)}},r}();r.MAX_ERROR_COUNT=3,t.AssetManager=r}(t||(t={}));var t;!function(t){function e(e,i,r){var s,o,n,a=r?r._dirname:e.assetBase,h=e._assetManager._liveAssetVirtualPathTable;if(-1===i.indexOf("/")&&e._assetManager._assets.hasOwnProperty(i)&&(s=e._assetManager._assets[i]),/^\.\/|^\.\.\/|^\//.test(i)){if(o=t.PathUtil.resolvePath(a,i),e._scriptCaches.hasOwnProperty(o))return e._scriptCaches[o]._cachedValue();if(e._scriptCaches.hasOwnProperty(o+".js"))return e._scriptCaches[o+".js"]._cachedValue();if(r){if(!r._virtualDirname)throw t.ExceptionFactory.createAssertionError("g._require: require from DynamicAsset is not supported");n=t.PathUtil.resolvePath(r._virtualDirname,i)}else{if("./"!==i.substring(0,2))throw t.ExceptionFactory.createAssertionError("g._require: entry point must start with './'");n=i.substring(2)}s||(s=t.Util.findAssetByPathAsFile(n,h)),s||(s=t.Util.findAssetByPathAsDirectory(n,h))}else if(!s){var c=r?r.paths:[];c.push("node_modules");for(var d=0;d<c.length;++d){var l=c[d];if(n=t.PathUtil.resolvePath(l,i),s=t.Util.findAssetByPathAsFile(n,h))break;if(s=t.Util.findAssetByPathAsDirectory(n,h))break}}if(s){if(e._scriptCaches.hasOwnProperty(s.path))return e._scriptCaches[s.path]._cachedValue();if(s instanceof t.ScriptAsset){var u=new t.ScriptAssetContext(e,s);return e._scriptCaches[s.path]=u,u._executeScript(r)}if(s instanceof t.TextAsset&&s&&".json"===t.PathUtil.resolveExtname(i)){var p=e._scriptCaches[s.path]=new t.RequireCachedValue(JSON.parse(s.data));return p._cachedValue()}}throw t.ExceptionFactory.createAssertionError("g._require: can not find module: "+i)}t._require=e;var i=function(){function e(e,i,r){var s=this,o=t.PathUtil.resolveDirname(r),n=e._assetManager._liveAbsolutePathTable[r],a=n?t.PathUtil.resolveDirname(n):void 0,h=Object.create(t,{game:{value:e,enumerable:!0},filename:{value:r,enumerable:!0},dirname:{value:o,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}});this.id=i,this.filename=r,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=a?t.PathUtil.makeNodeModulePaths(a):[],this._dirname=o,this._virtualDirname=a,this._g=h,this.require=function(i){return"g"===i?h:t._require(e,i,s)}}return e}();t.Module=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this._game=e,this._asset=i,this._module=new t.Module(e,i.path,i.path),this._g=this._module._g,this._started=!1}return e.prototype._cachedValue=function(){if(!this._started)throw t.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},e.prototype._executeScript=function(t){return this._started?this._module.exports:(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._g),this._module.loaded=!0,this._module.exports)},e}();t.ScriptAssetContext=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,i,r,s,0,0)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,i,r,s,o,n){var a=s*Math.PI/180,h=Math.cos(a),c=Math.sin(a),d=h*i,l=c*i,u=c*r,p=h*r,f=t/2,g=e/2;this._matrix[0]=d,this._matrix[1]=l,this._matrix[2]=-u,this._matrix[3]=p,this._matrix[4]=-d*f+u*g+f+o,this._matrix[5]=-l*f-p*g+g+n},t.prototype.updateByInverse=function(t,e,i,r,s,o,n){var a=s*Math.PI/180,h=Math.cos(a),c=Math.sin(a),d=h/i,l=c/r,u=c/i,p=h/r,f=t/2,g=e/2;this._matrix[0]=d,this._matrix[1]=-l,this._matrix[2]=u,this._matrix[3]=p,this._matrix[4]=-d*(f+o)-u*(g+n)+f,this._matrix[5]=l*(f+o)-p*(g+n)+g},t.prototype.multiply=function(t){var e=this._matrix,i=t._matrix,r=e[0],s=e[1],o=e[2],n=e[3];e[0]=r*i[0]+o*i[1],e[1]=s*i[0]+n*i[1],e[2]=r*i[2]+o*i[3],e[3]=s*i[2]+n*i[3],e[4]=r*i[4]+o*i[5]+e[4],e[5]=s*i[4]+n*i[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,i=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*i*t.x+-e[2]*i*t.y+(e[5]*e[2]-e[4]*e[3])*i,y:e[0]*i*t.y+-e[1]*i*t.x+(-e[5]*e[0]+e[4]*e[1])*i}},t.prototype.scale=function(t,e){var i=this._matrix;i[0]*=t,i[1]*=e,i[2]*=t,i[3]*=e,i[4]*=t,i[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix,i=e[0]*t.x+e[2]*t.y+e[4],r=e[1]*t.x+e[3]*t.y+e[5];return{x:i,y:r}},t.prototype.multplyPoint=function(t){return this.multiplyPoint(t)},t}();t.PlainMatrix=e}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e,i,r){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-r,2))}function r(t,i){return e.distance(t.x,t.y,i.x,i.y)}function s(t,i){return e.distance(t.x-t.width/2,t.y-t.height/2,i.x-i.width/2,i.y-i.height/2)}function o(e,i,r,s,o){return void 0===e?new t.PlainMatrix:new t.PlainMatrix(e,i,r,s,o)}function n(e,i,r){var s=i.x,o=i.y,n=0,a=0,h=i.width,c=i.height,d=i.calculateBoundingRect(r);if(!d)throw t.ExceptionFactory.createAssertionError("Util#createSpriteFromE: camera must look e");h=d.right-d.left,c=d.bottom-d.top,d.left<i.x&&(n=i.x-d.left),d.top<i.y&&(a=i.y-d.top),i.moveTo(n,a),i._matrix&&(i._matrix._modified=!0);var l=e.game.resourceFactory.createSurface(Math.ceil(h),Math.ceil(c)),u=l.renderer();u.begin(),i.render(u,r),u.end();var p=new t.Sprite({scene:e,src:l,width:h,height:c});return p.moveTo(d.left,d.top),i.moveTo(s,o),i._matrix&&(i._matrix._modified=!0),p}function a(e,i,r){var s=e.game.resourceFactory.createSurface(Math.ceil(i.game.width),Math.ceil(i.game.height)),o=s.renderer();o.begin();for(var n=i.children,a=0;a<n.length;++a)n[a].render(o,r);return o.end(),new t.Sprite({scene:e,src:s,width:i.game.width,height:i.game.height})}function h(e){if(!e)return e;if(e instanceof t.Surface)return e;if(e instanceof t.ImageAsset)return e.asSurface();throw t.ExceptionFactory.createTypeMismatchError("Util#asSurface","ImageAsset|Surface",e)}function c(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0}function d(i,r){var s;if(s=i+"/package.json",r.hasOwnProperty(s)&&r[s]instanceof t.TextAsset){var o=JSON.parse(r[s].data);if(o&&"string"==typeof o.main){var n=e.findAssetByPathAsFile(t.PathUtil.resolvePath(i,o.main),r);if(n)return n}}return s=i+"/index.js",r.hasOwnProperty(s)?r[s]:void 0}function l(t,e){var i=t.charCodeAt(e);if(i>=55296&&56319>=i){var r=i,s=t.charCodeAt(e+1);return r<<16|s}return i>=56320&&57343>=i?null:i}function u(t,e){e.isDynamic&&(e.animatingStarted.handle(t,t._onAnimatingStarted),e.animatingStopped.handle(t,t._onAnimatingStopped),e.isPlaying()&&t._onAnimatingStarted())}function p(t,e,i){t._onAnimatingStopped(),!e.destroyed()&&e.isDynamic&&(e.animatingStarted.remove(t,t._onAnimatingStarted),e.animatingStopped.remove(t,t._onAnimatingStopped)),i.isDynamic&&(i.animatingStarted.handle(t,t._onAnimatingStarted),i.animatingStopped.handle(t,t._onAnimatingStopped),i.isPlaying()&&t._onAnimatingStarted())}e.distance=i,e.distanceBetweenOffsets=r,e.distanceBetweenAreas=s,e.createMatrix=o,e.createSpriteFromE=n,e.createSpriteFromScene=a,e.asSurface=h,e.findAssetByPathAsFile=c,e.findAssetByPathAsDirectory=d,e.charCodeAt=l,e.setupAnimatingHandler=u,e.migrateAnimatingHandler=p}(e=t.Util||(t.Util={}))}(t||(t={}));var t;!function(t){var e;!function(e){function i(t,e,i,r,s,o,n,a){return s+n>=t&&t+i>=s&&o+a>=e&&e+r>=o}function r(t,i){return e.intersect(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height)}function s(e,i,r,s,o){return void 0===o&&(o=1),o>=t.Util.distance(e,i,r,s)}function o(e,i,r){return void 0===r&&(r=1),r>=t.Util.distanceBetweenAreas(e,i)}e.intersect=i,e.intersectAreas=r,e.within=s,e.withinAreas=o}(e=t.Collision||(t.Collision={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.chain=t,this._handlers=[]}return t.prototype.handle=function(t,e,i){this._handlers.length||this._activateChain(),e?this._handlers.push({owner:t,handler:e,name:i}):this._handlers.push({owner:void 0,handler:t,name:i})},t.prototype.destroy=function(){this._deactivateChain(),this.chain=void 0,this._handlers=void 0},t.prototype.destroyed=function(){return void 0===this._handlers},t.prototype.hasHandler=function(){return this._handlers&&this._handlers.length>0},t.prototype.handleInsert=function(t,e,i,r){this._handlers.length||this._activateChain(),i?this._handlers.splice(t,0,{owner:e,handler:i,name:r}):this._handlers.splice(t,0,{owner:void 0,handler:e,name:r})},t.prototype.removeAll=function(t){for(var e,i=[];e=this._handlers.shift();)e.owner!==t&&i.push(e);this._handlers=i,this._handlers.length||this._deactivateChain()},t.prototype.removeAllByHandler=function(t){for(var e,i=[];e=this._handlers.shift();)e.handler!==t&&i.push(e);this._handlers=i,this._handlers.length||this._deactivateChain()},t.prototype.remove=function(t,e){var i=[];e||(e=t,t=void 0);for(var r=0;r<this._handlers.length;++r){var s=this._handlers[r];s.handler===e&&s.owner===t||i.push(s)}this._handlers=i,this._handlers.length||this._deactivateChain()},t.prototype.removeByName=function(t){for(var e=[],i=0;i<this._handlers.length;++i){var r=this._handlers[i];r.name!==t&&e.push(r)}this._handlers=e,this._handlers.length||this._deactivateChain()},t.prototype.isHandled=function(t,e){e||(e=t,t=void 0);for(var i=0;i<this._handlers.length;++i)if(this._handlers[i].owner===t&&this._handlers[i].handler===e)return!0;return!1},t.prototype.fire=function(t){if(this._handlers&&this._handlers.length)for(var e=this._handlers.concat(),i=0;i<e.length;++i){var r=e[i];r.handler.call(r.owner,t)&&this._remove(r)}},t.prototype._reset=function(){this._handlers=[],this._deactivateChain()},t.prototype._activateChain=function(){this.chain&&(this.chain.isHandled(this,this._onChainFire)||this.chain.handle(this,this._onChainFire))},t.prototype._deactivateChain=function(){this.chain&&this.chain.isHandled(this,this._onChainFire)&&this.chain.remove(this,this._onChainFire)},t.prototype._remove=function(t){var e=this._handlers.indexOf(t);-1!==e&&(this._handlers.splice(e,1),this._handlers.length||this._deactivateChain())},t.prototype._onChainFire=function(t){this.fire(t)},t}();t.Trigger=e;var r=function(t){function e(e,i,r){var s=t.call(this,e)||this;return s.filterOwner=i,s.filter=r,s}return i(e,t),e.prototype._onChainFire=function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)},e}(e);t.ConditionalChainTrigger=r}(t||(t={}));var t;!function(t){var e=function(){function e(e,i){this.interval=e,this._scaledInterval=Math.round(e*i),this.elapsed=new t.Trigger,this._scaledElapsed=0}return e.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.elapsed;)this.elapsed.fire(),this._scaledElapsed-=this._scaledInterval},e.prototype.canDelete=function(){return!this.elapsed.hasHandler()},e.prototype.destroy=function(){this.interval=void 0,this.elapsed.destroy(),this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},e.prototype.destroyed=function(){return void 0===this.elapsed},e}();t.Timer=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,s){this._timer=t,this._handler=e,this._handlerOwner=i,this._fired=r,this._firedOwner=s,this._timer.elapsed.handle(this,this._fire)}return t.prototype.destroy=function(){this._timer.elapsed.remove(this,this._fire),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._fire=function(){this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this)},t}();t.TimerIdentifier=e;var i=function(){function i(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return i.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(var t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},i.prototype.destroyed=function(){return void 0===this._timers},i.prototype.createTimer=function(e){if(this._registered||(this._trigger.handle(this,this._tick),this._registered=!0),0>e)throw t.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");1>e&&(e=1);for(var i=Math.min(1e3,e*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===e&&this._timers[r]._scaledElapsed<i)return this._timers[r];var s=new t.Timer(e,this._fps);return this._timers.push(s),s},i.prototype.deleteTimer=function(e){if(e.canDelete()){var i=this._timers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(i,1),e.destroy(),!this._timers.length){if(!this._registered)throw t.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this,this._tick),this._registered=!1}}},i.prototype.setTimeout=function(t,i,r){void 0===r&&(r=i,i=null);var s=this.createTimer(t),o=new e(s,r,i,this._onTimeoutFired,this);return this._identifiers.push(o),o},i.prototype.clearTimeout=function(t){this._clear(t)},i.prototype.setInterval=function(t,i,r){void 0===r&&(r=i,i=null);var s=this.createTimer(t),o=new e(s,r,i);return this._identifiers.push(o),o},i.prototype.clearInterval=function(t){this._clear(t)},i.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},i.prototype._onTimeoutFired=function(e){var i=this._identifiers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i.prototype._clear=function(e){var i=this._identifiers.indexOf(e);if(0>i)throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(e.destroyed())throw t.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(i,1);var r=e._timer;e.destroy(),this.deleteTimer(r)},i}();t.TimerManager=i}(t||(t={}));var t;!function(t){var e=function(){function e(e){this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentAudio=void 0,this.volume=e.volume,this._muted=e._muted,this._playbackRate=e._playbackRate,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.played.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;this.currentAudio=void 0,this.stopped.fire({player:this,audio:t})},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){this._muted=t},e.prototype._changePlaybackRate=function(t){this._playbackRate=t},e.prototype._supportsPlaybackRate=function(){return!1},e}();t.AudioPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function e(t,e){var i=e._audioSystemManager;this.id=t,this.game=e,this._volume=1,this._destroyRequestedAssets={},this._muted=i._muted,this._playbackRate=i._playbackRate}return Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(0>e||e>1||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+e);this._volume=e,this._onVolumeChanged()},enumerable:!0,configurable:!0}),e.prototype.stopAll=function(){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#stopAll")},e.prototype.findPlayers=function(e){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#findPlayers")},e.prototype.createPlayer=function(){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#createPlayer")},e.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},e.prototype._setMuted=function(t){var e=this._muted;this._muted=!!t,this._muted!==e&&this._onMutedChanged()},e.prototype._setPlaybackRate=function(e){if(0>e||isNaN(e)||"number"!=typeof e)throw t.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+e);var i=this._playbackRate;this._playbackRate=e,this._playbackRate!==i&&this._onPlaybackRateChanged()},e.prototype._onVolumeChanged=function(){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#_onVolumeChanged")},e.prototype._onMutedChanged=function(){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#_onMutedChanged")},e.prototype._onPlaybackRateChanged=function(){throw t.ExceptionFactory.createPureVirtualError("AudioSystem#_onPlaybackRateChanged")},e}();t.AudioSystem=e;var r=function(e){function r(t,i){var r=e.call(this,t,i)||this;return r._player=void 0,r._suppressingAudio=void 0,r}return i(r,e),Object.defineProperty(r.prototype,"player",{get:function(){return this._player||(this._player=this.game.resourceFactory.createAudioPlayer(this),this._player.played.handle(this,this._onPlayerPlayed),this._player.stopped.handle(this,this._onPlayerStopped)),this._player},set:function(t){this._player=t},enumerable:!0,configurable:!0}),r.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},r.prototype.createPlayer=function(){return this.player},r.prototype.stopAll=function(){this._player&&this._player.stop()},r.prototype._onVolumeChanged=function(){this.player.changeVolume(this._volume)},r.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},r.prototype._onPlaybackRateChanged=function(){var t=this.player;t._changePlaybackRate(this._playbackRate),t._supportsPlaybackRate()||this._onUnsupportedPlaybackRateChanged()},r.prototype._onUnsupportedPlaybackRateChanged=function(){if(1===this._playbackRate&&this._suppressingAudio){var t=this._suppressingAudio;this._suppressingAudio=void 0,t.destroyed()||this.player.play(t)}},r.prototype._onPlayerPlayed=function(e){if(e.player!==this._player)throw t.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player");e.player._supportsPlaybackRate()||1!==this._playbackRate&&(e.player.stop(),this._suppressingAudio=e.audio)},r.prototype._onPlayerStopped=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},r}(e);t.MusicAudioSystem=r;var s=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.players=[],r}return i(e,t),e.prototype.createPlayer=function(){var t=this.game.resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.played.handle(this,this._onPlayerPlayed),t.stopped.handle(this,this._onPlayerStopped),t},e.prototype.findPlayers=function(t){for(var e=[],i=0;i<this.players.length;++i)this.players[i].currentAudio&&this.players[i].currentAudio.id===t.id&&e.push(this.players[i]);return e},e.prototype.stopAll=function(){for(var t=this.players.concat(),e=0;e<t.length;++e)t[e].stop()},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changePlaybackRate(this._playbackRate)},e.prototype._onPlayerPlayed=function(t){t.player._supportsPlaybackRate()||1!==this._playbackRate&&t.player.stop()},e.prototype._onPlayerStopped=function(t){var e=this.players.indexOf(t.player);0>e||(t.player.stopped.remove(this,this._onPlayerStopped),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t].changeVolume(this._volume);
},e}(e);t.SoundAudioSystem=s}(t||(t={}));var t;!function(t){var e=function(){function e(e){this._loop=!!e,this.played=new t.Trigger,this.stopped=new t.Trigger,this.currentVideo=void 0,this.volume=1}return e.prototype.play=function(t){this.currentVideo=t,this.played.fire({player:this,video:t}),t.asSurface().animatingStarted.fire()},e.prototype.stop=function(){var t=this.currentVideo;this.stopped.fire({player:this,video:t}),t.asSurface().animatingStopped.fire()},e.prototype.changeVolume=function(t){this.volume=t},e}();t.VideoPlayer=e}(t||(t={}));var t;!function(t){var e=function(){function t(){}return t}();t.VideoSystem=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity="opacity"in t?t.opacity:1,this.scaleX="scaleX"in t?t.scaleX:1,this.scaleY="scaleY"in t?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this._matrix=void 0)}return e.prototype.moveTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof e?(this.x=e,this.y=i):(this.x=e.x,this.y=e.y)},e.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},e.prototype.resizeTo=function(e,i){if("number"==typeof e&&"number"!=typeof i)throw t.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof e?(this.width=e,this.height=i):(this.width=e.width,this.height=e.height)},e.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},e.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},e.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=t.Util.createMatrix();return this._updateMatrix(),this._matrix._modified=!1,this._matrix},e.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(this.x,this.y)},e}();t.Object2D=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;if(i instanceof t.Scene){var s=i;r=e.call(this)||this,r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.local=s.local!==t.LocalTickMode.NonLocal,s.register(r),s.game.logger.debug("[deprecated] E or Subclass of E: This constructor is deprecated. Refer to the API documentation and use each constructor(param: ParameterObject) instead.")}else{var o=i;if(r=e.call(this,o)||this,r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._update=void 0,r._message=void 0,r._pointDown=void 0,r._pointMove=void 0,r._pointUp=void 0,r._targetCameras=void 0,r.tag=o.tag,r.local=o.scene.local!==t.LocalTickMode.NonLocal||!!o.local,o.children)for(var n=0;n<o.children.length;++n)r.append(o.children[n]);o.parent&&o.parent.append(r),o.targetCameras&&(r.targetCameras=o.targetCameras),"touchable"in o&&(r.touchable=o.touchable),o.hidden&&r.hide(),r.id=o.id,o.scene.register(r)}return r}return i(r,e),Object.defineProperty(r.prototype,"update",{get:function(){return this._update||(this._update=new t.Trigger(this.scene.update)),this._update},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"message",{get:function(){return this._message||(this._message=new t.Trigger(this.scene.message)),this._message},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointDown",{get:function(){return this._pointDown||(this._pointDown=new t.ConditionalChainTrigger(this.scene.pointDownCapture,this,this._isTargetOperation)),this._pointDown},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointUp",{get:function(){return this._pointUp||(this._pointUp=new t.ConditionalChainTrigger(this.scene.pointUpCapture,this,this._isTargetOperation)),this._pointUp},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pointMove",{get:function(){return this._pointMove||(this._pointMove=new t.ConditionalChainTrigger(this.scene.pointMoveCapture,this,this._isTargetOperation)),this._pointMove},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"targetCameras",{get:function(){return this._targetCameras||(this._targetCameras=[])},set:function(t){this._targetCameras=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!0,configurable:!0}),r.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state)){var i=this._targetCameras;if(!(i&&i.length>0)||e&&-1!==i.indexOf(e)){if(8&this.state){t.translate(this.x,this.y);var r=this.renderSelf(t,e);if(r&&this.children)for(var s=this.children,o=s.length,n=0;o>n;++n)s[n].render(t,e);return void t.translate(-this.x,-this.y)}t.save(),this.angle||1!==this.scaleX||1!==this.scaleY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity),void 0!==this.compositeOperation&&t.setCompositeOperation(this.compositeOperation);var r=this.renderSelf(t,e);if(r&&this.children)for(var s=this.children,n=0;n<s.length;++n)s[n].render(t,e);t.restore()}}},r.prototype.renderSelf=function(t,e){return!0},r.prototype.game=function(){return this.scene.game},r.prototype.append=function(t){this.insertBefore(t,void 0)},r.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},r.prototype.remove=function(e){if(void 0===e)return void this.parent.remove(this);var i=this.children?this.children.indexOf(e):-1;if(0>i)throw t.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[i].parent=void 0,this.children.splice(i,1),(e._touchable||e._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)},r.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(;this.children.length;)this.children[this.children.length-1].destroy();this.children=void 0}this._update&&(this._update.destroy(),this._update=void 0),this._message&&(this._message.destroy(),this._message=void 0),this._pointDown&&(this._pointDown.destroy(),this._pointDown=void 0),this._pointMove&&(this._pointMove.destroy(),this._pointMove=void 0),this._pointUp&&(this._pointUp.destroy(),this._pointUp=void 0),this.scene.unregister(this)},r.prototype.destroyed=function(){return void 0===this.scene},r.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||1!==this.opacity||void 0!==this.compositeOperation?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},r.prototype.shouldFindChildrenByPoint=function(t){return!0},r.prototype.findPointSourceByPoint=function(t,e,i,r){if(!(1&this.state)){var s=this._targetCameras;if(!(s&&s.length>0)||r&&-1!==s.indexOf(r)){e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone();var o=e.multiplyInverseForPoint(t);if((this._hasTouchableChildren||i&&this.children&&this.children.length)&&this.shouldFindChildrenByPoint(o))for(var n=this.children.length-1;n>=0;--n){var a=this.children[n];if(i||a._touchable||a._hasTouchableChildren){var h=a.findPointSourceByPoint(t,e,i,r);if(h)return h}}if(i||this._touchable)return 0<=o.x&&this.width>o.x&&0<=o.y&&this.height>o.y?{target:this,point:o}:void 0}}},r.prototype.visible=function(){return 1!==(1&this.state)},r.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},r.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},r.prototype.calculateBoundingRect=function(t){return this._calculateBoundingRect(void 0,t)},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},s=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(s[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<s.length;++a)o=i.multiplyPoint(s[a]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);if(void 0!==this.children)for(var a=0;a<this.children.length;++a){var h=this.children[a]._calculateBoundingRect(i,e);h&&(n.left>h.left&&(n.left=h.left),n.right<h.right&&(n.right=h.right),n.top>h.top&&(n.top=h.top),n.bottom<h.bottom&&(n.bottom=h.bottom))}return n}},r.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},r.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof r&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},r.prototype._isTargetOperation=function(e){return!(1&this.state)&&e instanceof t.PointEvent&&this._touchable&&e.target===this},r.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var i=this._findTouchableChildren(t.children[e]);if(i)return i}},r}(t.Object2D);t.E=e}(t||(t={}));var t;!function(t){var e=function(e){function r(t){var i=e.call(this,t)||this;return i._shouldRenderChildren=!0,i._cache=void 0,i._renderer=void 0,i._renderedCamera=void 0,i}return i(r,e),r.prototype.invalidate=function(){this.state&=-3,this.modified()},r.prototype.renderSelf=function(t,e){if(this._renderedCamera!==e&&(this.state&=-3,this._renderedCamera=e),!(2&this.state)){var i=!this._cache||this._cache.width<Math.ceil(this.width)||this._cache.height<Math.ceil(this.height);i&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(Math.ceil(this.width),Math.ceil(this.height)),this._renderer=this._cache.renderer()),this._renderer.begin(),i||this._renderer.clear(),this.renderCache(this._renderer,e),this.state|=2,this._renderer.end()}return this._cache&&this.width>0&&this.height>0&&t.drawImage(this._cache,0,0,this.width,this.height,0,0),this._shouldRenderChildren},r.prototype.renderCache=function(e,i){throw t.ExceptionFactory.createPureVirtualError("CacheableE#renderCache")},r.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,e.prototype.destroy.call(this)},r}(t.E);t.CacheableE=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Slots=1]="Slots",t[t.Scores=2]="Scores",t[t.Counts=3]="Counts",t[t.Values=4]="Values"}(e=t.StorageRegion||(t.StorageRegion={}));var i;!function(t){t[t.Asc=0]="Asc",t[t.Desc=1]="Desc"}(i=t.StorageOrder||(t.StorageOrder={}));var r;!function(t){t[t.Equal=1]="Equal",t[t.GreaterThan=2]="GreaterThan",t[t.LessThan=3]="LessThan"}(r=t.StorageCondition||(t.StorageCondition={}));var s;!function(t){t[t.Incr=1]="Incr",t[t.Decr=2]="Decr"}(s=t.StorageCountsOperation||(t.StorageCountsOperation={}));var o=function(){function t(t,e){this._keys=t,this._values=e}return t.prototype.get=function(t){if(void 0===this._values)return[];if("number"==typeof t)return this._values[t];var e=this._keys.indexOf(t);if(-1!==e)return this._values[e];for(var i=0;i<this._keys.length;++i){var r=this._keys[i];if(r.region===t.region&&r.regionKey===t.regionKey&&r.userId===t.userId&&r.gameId===t.gameId)return this._values[i]}return[]},t.prototype.getOne=function(t){var e=this.get(t);return e?e[0]:void 0},t}();t.StorageValueStore=o;var n=function(){function t(t,e,i){this._loaded=!1,this._storage=t,this._valueStore=new o(e),this._handler=void 0,this._valueStoreSerialization=i}return t.prototype._load=function(t){this._handler=t,this._storage._load&&this._storage._load.call(this._storage,this._valueStore._keys,this,this._valueStoreSerialization)},t.prototype._onLoaded=function(t,e){this._valueStore._values=t,this._loaded=!0,e&&(this._valueStoreSerialization=e),this._handler&&this._handler._onStorageLoaded()},t.prototype._onError=function(t){this._handler&&this._handler._onStorageLoadError(t)},t}();t.StorageLoader=n;var a=function(){function t(t){this._game=t}return t.prototype.write=function(t,e,i){this._write&&this._write(t,e,i)},t.prototype.requestValuesForJoinPlayer=function(t){this._requestedKeysForJoinPlayer=t},t.prototype._createLoader=function(t,e){return new n(this,t,e)},t.prototype._registerWrite=function(t){this._write=t},t.prototype._registerLoad=function(t){this._load=t},t}();t.Storage=a}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.waitingAssetsCount=t.assetIds.length,this._scene=t.scene,this._assetManager=t.assetManager,this._assetIds=t.assetIds,this._assets=[],this._handler=t.handler,this._handlerOwner=t.handlerOwner||null,this._direct=!!t.direct,this._requested=!1}return e.prototype.request=function(){return!(0===this.waitingAssetsCount||!this._requested&&(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this),0))},e.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this._scene=void 0,this._assetIds=void 0,this._handler=void 0,this._requested=!1},e.prototype.destroyed=function(){return!this._scene},e.prototype.callHandler=function(){this._handler.call(this._handlerOwner)},e.prototype._onAssetError=function(t,e,i){if(!this.destroyed()&&!this._scene.destroyed()){var r={asset:t,error:e,cancelRetry:!1};this._scene.assetLoadFailed.fire(r),e.retriable&&!r.cancelRetry?this._assetManager.retryLoad(t):this._assetManager.configuration[t.id]&&this._scene.game.terminateGame(),this._scene.assetLoadCompleted.fire(t)}},e.prototype._onAssetLoad=function(e){if(!this.destroyed()&&!this._scene.destroyed()){if(this._scene.assets[e.id]=e,this._scene.assetLoaded.fire(e),this._scene.assetLoadCompleted.fire(e),this._assets.push(e),--this.waitingAssetsCount,this.waitingAssetsCount<0)throw t.ExceptionFactory.createAssertionError("SceneAssetHolder#_onAssetLoad: broken waitingAssetsCount");this.waitingAssetsCount>0||(this._direct?this.callHandler():this._scene.game._callSceneAssetHolderHandler(this))}},e}();t.SceneAssetHolder=e;var i;!function(t){t[t.Destroyed=0]="Destroyed",t[t.Standby=1]="Standby",t[t.Active=2]="Active",t[t.Deactive=3]="Deactive",t[t.BeforeDestroyed=4]="BeforeDestroyed"}(i=t.SceneState||(t.SceneState={}));var r;!function(t){t[t.Initial=0]="Initial",t[t.Ready=1]="Ready",t[t.ReadyFired=2]="ReadyFired",t[t.LoadedFired=3]="LoadedFired"}(r=t.SceneLoadState||(t.SceneLoadState={}));var s=function(){function s(s,o){var n,a,h;if(s instanceof t.Game)n=s,a=t.LocalTickMode.NonLocal,h=t.TickGenerationMode.ByClock,n.logger.debug("[deprecated] Scene:This constructor is deprecated. Refer to the API documentation and use Scene(param: SceneParameterObject) instead.");else{var c=s;n=c.game,o=c.assetIds,c.storageKeys?(this._storageLoader=n.storage._createLoader(c.storageKeys,c.storageValuesSerialization),this.storageValues=this._storageLoader._valueStore):(this._storageLoader=void 0,this.storageValues=void 0),a=void 0===c.local?t.LocalTickMode.NonLocal:c.local===!1?t.LocalTickMode.NonLocal:c.local===!0?t.LocalTickMode.FullLocal:c.local,h=void 0!==c.tickGenerationMode?c.tickGenerationMode:t.TickGenerationMode.ByClock,this.name=c.name}o||(o=[]),this.game=n,this.local=a,this.tickGenerationMode=h,this.loaded=new t.Trigger,this._ready=new t.Trigger,this.assets={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState=r.Initial,this.update=new t.Trigger,this._timer=new t.TimerManager(this.update,this.game.fps),this.assetLoaded=new t.Trigger,this.assetLoadFailed=new t.Trigger,this.assetLoadCompleted=new t.Trigger,this.message=new t.Trigger,this.pointDownCapture=new t.Trigger,this.pointMoveCapture=new t.Trigger,this.pointUpCapture=new t.Trigger,this.operation=new t.Trigger,this.children=[],this.state=i.Standby,this.stateChanged=new t.Trigger,this._assetHolders=[],this._sceneAssetHolder=new e({scene:this,assetManager:this.game._assetManager,assetIds:o,handler:this._onSceneAssetsLoad,handlerOwner:this,direct:!0})}return s.prototype.modified=function(t){this.game.modified=!0},s.prototype.destroy=function(){this.state=i.BeforeDestroyed,this.stateChanged.fire(this.state);var t=this.game.db;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();var t=this.game._localDb;for(var e in t)t.hasOwnProperty(e)&&t[e].scene===this&&t[e].destroy();this._timer.destroy(),this.update.destroy(),this.message.destroy(),this.pointDownCapture.destroy(),this.pointMoveCapture.destroy(),this.pointUpCapture.destroy(),this.operation.destroy(),this.loaded.destroy(),this.assetLoaded.destroy(),this.assetLoadFailed.destroy(),this.assetLoadCompleted.destroy(),this.assets={};for(var r=0;r<this._assetHolders.length;++r)this._assetHolders[r].destroy();this._sceneAssetHolder.destroy(),this._storageLoader=void 0,this.game=void 0,this.state=i.Destroyed,this.stateChanged.fire(this.state),this.stateChanged.destroy()},s.prototype.destroyed=function(){return void 0===this.game},s.prototype.createTimer=function(t){return this._timer.createTimer(t)},s.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},s.prototype.setInterval=function(t,e,i){return this._timer.setInterval(t,e,i)},s.prototype.clearInterval=function(t){this._timer.clearInterval(t)},s.prototype.setTimeout=function(t,e,i){return this._timer.setTimeout(t,e,i)},s.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},s.prototype.isCurrentScene=function(){return this.game.scene()===this},s.prototype.gotoScene=function(e,i){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");i?this.game.pushScene(e):this.game.replaceScene(e)},s.prototype.end=function(){if(!this.isCurrentScene())throw t.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},s.prototype.register=function(t){this.game.register(t),t.scene=this},s.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},s.prototype.append=function(t){this.insertBefore(t,void 0)},s.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var i=-1;void 0!==e&&(i=this.children.indexOf(e))>-1?this.children.splice(i,0,t):this.children.push(t),this.modified(!0)},s.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},s.prototype.findPointSourceByPoint=function(e,i,r){var s=this.local!==t.LocalTickMode.NonLocal,o=this.children,n=void 0;r&&r instanceof t.Camera2D&&(n=r.getMatrix());for(var a=o.length-1;a>=0;--a){var h=o[a].findPointSourceByPoint(e,n,i,r);if(h)return h.local=h.target.local||s,h}return{target:void 0,point:void 0,local:s}},s.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},s.prototype.serializeStorageValues=function(){return this._storageLoader?this._storageLoader._valueStoreSerialization:void 0},s.prototype.requestAssets=function(i,s){if(this._loadingState<r.ReadyFired)throw t.ExceptionFactory.createAssertionError("Scene#requestAsset(): can be called after loaded.");var o=new e({scene:this,assetManager:this.game._assetManager,assetIds:i,handler:s});this._assetHolders.push(o),o.request()},s.prototype._activate=function(){this.state=i.Active,this.stateChanged.fire(this.state)},s.prototype._deactivate=function(){this.state=i.Deactive,this.stateChanged.fire(this.state)},s.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||this._storageLoader&&!this._storageLoader._loaded},s.prototype._load=function(){if(!this._loaded){this._loaded=!0;var t=this._sceneAssetHolder.request();this._storageLoader&&(this._storageLoader._load(this),t=!0),t||this._notifySceneReady()}},s.prototype._onSceneAssetsLoad=function(){this._loaded&&(this._storageLoader&&!this._storageLoader._loaded||this._notifySceneReady())},s.prototype._onStorageLoadError=function(t){this.game.terminateGame()},s.prototype._onStorageLoaded=function(){0===this._sceneAssetHolder.waitingAssetsCount&&this._notifySceneReady()},s.prototype._notifySceneReady=function(){this._loadingState=r.Ready,this.game._fireSceneReady(this)},s.prototype._fireReady=function(){this._ready.fire(this),this._loadingState=r.ReadyFired},s.prototype._fireLoaded=function(){this.loaded.fire(this),this._loadingState=r.LoadedFired},s}();t.Scene=s}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;return i.local=!0,r=e.call(this,i)||this,r.targetReset=new t.Trigger,r.targetReady=new t.Trigger,r.targetAssetLoaded=new t.Trigger,r._explicitEnd=!!i.explicitEnd,r._targetScene=void 0,r}return i(r,e),r.prototype.destroy=function(){this._clearTargetScene(),e.prototype.destroy.call(this)},r.prototype.reset=function(e){this._clearTargetScene(),this._targetScene=e,this._loadingState<t.SceneLoadState.LoadedFired?this.loaded.handle(this,this._doReset):this._doReset()},r.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},r.prototype.end=function(){if(!this._targetScene||this._targetScene._loadingState<t.SceneLoadState.Ready){var e=this._targetScene?t.SceneLoadState[this._targetScene._loadingState]:"(no scene)",i="LoadingScene#end(): the target scene is in invalid state: "+e;throw t.ExceptionFactory.createAssertionError(i)}this.game.popScene(!0),this.game._fireSceneLoaded(this._targetScene),this._clearTargetScene()},r.prototype._clearTargetScene=function(){this._targetScene&&(this._targetScene._ready.removeAll(this),this._targetScene.assetLoaded.removeAll(this),this._targetScene=void 0)},r.prototype._doReset=function(){return this.targetReset.fire(this._targetScene),this._targetScene._loadingState<t.SceneLoadState.ReadyFired?(this._targetScene._ready.handle(this,this._fireTriggerOnTargetReady),this._targetScene.assetLoaded.handle(this,this._fireTriggerOnTargetAssetLoad),this._targetScene._load()):this._fireTriggerOnTargetReady(this._targetScene),!0},r.prototype._fireTriggerOnTargetAssetLoad=function(t){this._onTargetAssetLoad(t),this.targetAssetLoaded.fire(t)},r.prototype._fireTriggerOnTargetReady=function(t){this.targetReady.fire(t),this._explicitEnd||this.end()},r.prototype._onTargetAssetLoad=function(t){return!0},r}(t.Scene);t.LoadingScene=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=e.call(this,i)||this;return r._canceller=new t.Object2D,r}return i(r,e),r.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e){var i=e,r=this._canceller;i.x===r.x&&i.y===r.y&&i.angle===r.angle&&i.scaleX===r.scaleX&&i.scaleY===r.scaleY||(r.x=i.x,r.y=i.y,r.angle=i.angle,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r._matrix&&(r._matrix._modified=!0)),t.save(),t.transform(r.getMatrix()._matrix)}for(var s=this.children,o=0;o<s.length;++o)s[o].render(t,e);return e&&t.restore(),!1},r}(t.E),r=function(r){function s(t){var e=r.call(this,{game:t.game,name:"akashic:default-loading-scene"})||this;return e._barWidth=Math.min(t.game.width,Math.max(100,t.game.width/2)),e._barHeight=5,e._gauge=void 0,e._gaugeUpdateCount=0,e._totalWaitingAssetCount=0,e.loaded.handle(e,e._onLoaded),e.targetReset.handle(e,e._onTargetReset),e.targetAssetLoaded.handle(e,e._onTargetAssetLoaded),e}return i(s,r),s.prototype._onLoaded=function(){var i;return this.append(new e({scene:this,children:[new t.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:"rgba(0, 0, 0, 0.8)",children:[new t.FilledRect({scene:this,x:(this.game.width-this._barWidth)/2,y:(this.game.height-this._barHeight)/2,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[i=new t.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),i.update.handle(this,this._onUpdateGuage),this._gauge=i,!0},s.prototype._onUpdateGuage=function(){var t=50,e=2/3;++this._gaugeUpdateCount;var i=Math.round(255-t+Math.sin(this._gaugeUpdateCount/this.game.fps*e*(2*Math.PI))*t);this._gauge.cssColor="rgb("+i+","+i+","+i+")",this._gauge.modified()},s.prototype._onTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},s.prototype._onTargetAssetLoaded=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},s}(t.LoadingScene);t.DefaultLoadingScene=r}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o){var n=this;if(i instanceof t.Scene){var a=i;n=e.call(this,a)||this,n.surface=t.Util.asSurface(r),n.width=void 0!==s?s:n.surface.width,n.height=void 0!==o?o:n.surface.height,n.srcWidth=n.width,n.srcHeight=n.height,n.srcX=0,n.srcY=0,n._stretchMatrix=void 0,n._beforeSurface=n.surface,t.Util.setupAnimatingHandler(n,n.surface)}else{var h=i;n=e.call(this,h)||this,n.surface=t.Util.asSurface(h.src),"width"in h||(n.width=n.surface.width),"height"in h||(n.height=n.surface.height),n.srcWidth="srcWidth"in h?h.srcWidth:n.width,n.srcHeight="srcHeight"in h?h.srcHeight:n.height,n.srcX=h.srcX||0,n.srcY=h.srcY||0,n._stretchMatrix=void 0,n._beforeSurface=n.surface,t.Util.setupAnimatingHandler(n,n.surface),n._invalidateSelf()}return n}return i(r,e),r.prototype._onUpdate=function(){this.modified()},r.prototype._onAnimatingStarted=function(){this.update.isHandled(this,this._onUpdate)||this.update.handle(this,this._onUpdate)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this,this._onUpdate)},r.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this.surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore(),!0)},r.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},r.prototype.destroy=function(t){this.surface&&!this.surface.destroyed()&&(t?this.surface.destroy():this.surface.isDynamic&&(this.surface.animatingStarted.remove(this,this._onAnimatingStarted),this.surface.animatingStopped.remove(this,this._onAnimatingStopped))),this.surface=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=t.Util.createMatrix(),this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.surface!==this._beforeSurface&&(t.Util.migrateAnimatingHandler(this,this._beforeSurface,this.surface),this._beforeSurface=this.surface)},r}(t.E);t.Sprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o){var n=this;if(i instanceof t.Scene){var a=i;n=e.call(this,a,r,s,o)||this,n._lastUsedIndex=0,n.frameNumber=0,n.frames=[0],n.interval=void 0,n._timer=void 0}else{var h=i;n=e.call(this,h)||this,n._lastUsedIndex=0,n.frameNumber=h.frameNumber||0,n.frames="frames"in h?h.frames:[0],n.interval=h.interval,n._timer=void 0,n._modifiedSelf()}return n}return i(r,e),r.createBySprite=function(t,e,i){var s=new r({scene:t.scene,src:t.surface,width:void 0===e?t.width:e,height:void 0===i?t.height:i});return s.srcHeight=void 0===i?t.srcHeight:i,s.srcWidth=void 0===e?t.srcWidth:e,s},r.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.elapsed.handle(this,this._onElapsed)},r.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t)},r.prototype.stop=function(){this._timer&&this._free()},r.prototype.modified=function(t){this._modifiedSelf(t),e.prototype.modified.call(this,t)},r.prototype._onElapsed=function(){++this.frameNumber>=this.frames.length&&(this.frameNumber=0),this.modified()},r.prototype._free=function(){this._timer&&(this._timer.elapsed.remove(this,this._onElapsed),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},r.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this.surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},r.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},r}(t.Sprite);t.FrameSprite=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o,n){var a=this;if(i instanceof t.Scene){var h=i;a=e.call(this,h)||this,a.tileWidth=s,a.tileHeight=o,a.tileData=n,a.tileChips=t.Util.asSurface(r),a.height=a.tileHeight*a.tileData.length,a.width=a.tileWidth*a.tileData[0].length,a._tilesInRow=Math.floor(a.tileChips.width/a.tileWidth)}else{var c=i;a=e.call(this,c)||this,a.tileWidth=c.tileWidth,a.tileHeight=c.tileHeight,a.tileData=c.tileData,a.tileChips=t.Util.asSurface(c.src),a.height=a.tileHeight*a.tileData.length,a.width=a.tileWidth*a.tileData[0].length}return a._beforeTileChips=a.tileChips,t.Util.setupAnimatingHandler(a,a.tileChips),a._invalidateSelf(),a}return i(r,e),r.prototype._onUpdate=function(){this.invalidate()},r.prototype._onAnimatingStarted=function(){this.update.isHandled(this,this._onUpdate)||this.update.handle(this,this._onUpdate)},r.prototype._onAnimatingStopped=function(){this.destroyed()||this.update.remove(this,this._onUpdate)},r.prototype.renderCache=function(e){if(!this.tileData)throw t.ExceptionFactory.createAssertionError("Tile#_renderCache: don't have a tile data");if(!(this.tileWidth<=0||this.tileHeight<=0))for(var i=0;i<this.tileData.length;++i)for(var r=this.tileData[i],s=0;s<r.length;++s){var o=r[s];if(!(0>o)){var n=this.tileWidth*(o%this._tilesInRow),a=this.tileHeight*Math.floor(o/this._tilesInRow),h=this.tileWidth*s,c=this.tileHeight*i;e.drawImage(this.tileChips,n,a,this.tileWidth,this.tileHeight,h,c)}}},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.destroy=function(t){t&&this.tileChips&&!this.tileChips.destroyed()&&this.tileChips.destroy(),this.tileChips=void 0,e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){this._tilesInRow=Math.floor(this.tileChips.width/this.tileWidth),this.tileChips!==this._beforeTileChips&&(t.Util.migrateAnimatingHandler(this,this._beforeTileChips,this.tileChips),this._beforeTileChips=this.tileChips)},r}(t.CacheableE);t.Tile=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Unknown=0]="Unknown",t[t.Join=1]="Join",t[t.Leave=2]="Leave",t[t.Timestamp=3]="Timestamp",t[t.Seed=4]="Seed",t[t.PointDown=5]="PointDown",t[t.PointMove=6]="PointMove",t[t.PointUp=7]="PointUp",t[t.Message=8]="Message",t[t.Operation=9]="Operation"}(e=t.EventType||(t.EventType={}));var r=function(){function t(t,e,i,r,s,o){this.priority=o,this.local=s,this.player=r,this.pointerId=t,this.target=e,this.point=i}return t}();t.PointEvent=r;var s=function(t){function r(i,r,s,o,n,a){var h=t.call(this,i,r,s,o,n,a)||this;return h.type=e.PointDown,h}return i(r,t),r}(r);t.PointDownEvent=s;var o=function(t){function r(i,r,s,o,n,a,h,c){var d=t.call(this,i,r,s,a,h,c)||this;return d.type=e.PointUp,d.prevDelta=o,d.startDelta=n,d}return i(r,t),r}(r);t.PointUpEvent=o;var n=function(t){function r(i,r,s,o,n,a,h,c){var d=t.call(this,i,r,s,a,h,c)||this;
return d.type=e.PointMove,d.prevDelta=o,d.startDelta=n,d}return i(r,t),r}(r);t.PointMoveEvent=n;var a=function(){function t(t,i,r,s){this.type=e.Message,this.priority=s,this.local=r,this.player=i,this.data=t}return t}();t.MessageEvent=a;var h=function(){function t(t,i,r,s,o){this.type=e.Operation,this.priority=o,this.local=s,this.player=r,this.code=t,this.data=i}return t}();t.OperationEvent=h;var c=function(){function t(t,i,r){this.type=e.Join,this.priority=r,this.player=t,this.storageValues=i}return t}();t.JoinEvent=c;var d=function(){function t(t,i){this.type=e.Leave,this.priority=i,this.player=t}return t}();t.LeaveEvent=d;var l=function(){function t(t,i,r){this.type=e.Timestamp,this.priority=r,this.player=i,this.timestamp=t}return t}();t.TimestampEvent=l;var u=function(){function t(t,i){this.type=e.Seed,this.priority=i,this.generator=t}return t}();t.SeedEvent=u}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Info=2]="Info",t[t.Debug=3]="Debug"}(e=t.LogLevel||(t.LogLevel={}));var i=function(){function i(e){this.game=e,this.logging=new t.Trigger}return i.prototype.error=function(t,i){this.logging.fire({game:this.game,level:e.Error,message:t,cause:i})},i.prototype.warn=function(t,i){this.logging.fire({game:this.game,level:e.Warn,message:t,cause:i})},i.prototype.info=function(t,i){this.logging.fire({game:this.game,level:e.Info,message:t,cause:i})},i.prototype.debug=function(t,i){this.logging.fire({game:this.game,level:e.Debug,message:t,cause:i})},i}();t.Logger=i}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,s,o){e=this._normalizeConfiguration(e),this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.random=[],this.age=0,this.assetBase=r||"",this.resourceFactory=i,this.selfId=s||void 0,this.playId=void 0,this._audioSystemManager=new t.AudioSystemManager(this),this.audio={music:new t.MusicAudioSystem("music",this),sound:new t.SoundAudioSystem("sound",this)},this.defaultAudioSystemId="sound",this.storage=new t.Storage(this),this.assets={},this.join=new t.Trigger,this.leave=new t.Trigger,this.seed=new t.Trigger,this._eventTriggerMap={},this._eventTriggerMap[t.EventType.Join]=this.join,this._eventTriggerMap[t.EventType.Leave]=this.leave,this._eventTriggerMap[t.EventType.Seed]=this.seed,this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,this._eventTriggerMap[t.EventType.Operation]=void 0,this._loaded=new t.Trigger,this._started=new t.Trigger,this.isLoaded=!1,this.snapshotRequest=new t.Trigger,this.external={},this.logger=new t.Logger(this),this._main=e.main,this._mainParameter=void 0,this._configuration=e,this._assetManager=new t.AssetManager(this,e.assets,e.audio);var n=e.operationPlugins||[];this._operationPluginManager=new t.OperationPluginManager(this,o,n),this._operationPluginOperated=new t.Trigger,this._operationPluginManager.operated.handle(this._operationPluginOperated,this._operationPluginOperated.fire),this._sceneChanged=new t.Trigger,this._sceneChanged.handle(this,this._updateEventTriggers),this._initialScene=new t.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.loaded.handle(this,this._onInitialSceneLoaded),this._reset({age:0})}return Object.defineProperty(e.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this.modified&&this.render(this._focusingCamera),this._focusingCamera=t)},enumerable:!0,configurable:!0}),e.prototype.pushScene=function(t){this._sceneChangeRequests.push({type:0,scene:t})},e.prototype.replaceScene=function(t,e){this._sceneChangeRequests.push({type:1,scene:t,preserveCurrent:e})},e.prototype.popScene=function(t){this._sceneChangeRequests.push({type:2,preserveCurrent:t})},e.prototype.scene=function(){return this.scenes.length?this.scenes[this.scenes.length-1]:void 0},e.prototype.tick=function(e){var i=void 0;if(this._isTerminated)return!1;if(this.scenes.length){if(i=this.scenes[this.scenes.length-1],this.events.length){var r=this.events;this.events=[];for(var s=0;s<r.length;++s){var o=this._eventTriggerMap[r[s].type];o&&o.fire(r[s])}}i.update.fire(),(e===!0||void 0===e&&i.local!==t.LocalTickMode.FullLocal)&&++this.age}return!!this._sceneChangeRequests.length&&(this._flushSceneChangeRequests(),i!==this.scenes[this.scenes.length-1])},e.prototype.render=function(t){t||(t=this.focusingCamera);for(var e=this.renderers,i=0;i<e.length;++i)e[i].draw(this,t);this.modified=!1},e.prototype.findPointSource=function(t,e){return e||(e=this.focusingCamera),this.scene().findPointSourceByPoint(t,!1,e)},e.prototype.register=function(e){if(e.local){if(void 0===e.id)e.id=--this._localIdx;else{if(e.id>0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+e.id);if(this._localDb.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._localIdx>e.id&&(this._localIdx=e.id)}this._localDb[e.id]=e}else{if(void 0===e.id)e.id=++this._idx;else{if(e.id<0)throw t.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+e.id);if(this.db.hasOwnProperty(String(e.id)))throw t.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+e.id);this._idx<e.id&&(this._idx=e.id)}this.db[e.id]=e}},e.prototype.unregister=function(t){t.local?delete this._localDb[t.id]:delete this.db[t.id]},e.prototype.leaveGame=function(){this._leaveGame()},e.prototype.terminateGame=function(){this._leaveGame(),this._isTerminated=!0,this._terminateGame()},e.prototype.raiseEvent=function(e){throw t.ExceptionFactory.createPureVirtualError("Game#raiseEvent")},e.prototype.raiseTick=function(e){throw t.ExceptionFactory.createPureVirtualError("Game#raiseTick")},e.prototype.addEventFilter=function(e){throw t.ExceptionFactory.createPureVirtualError("Game#addEventFilter")},e.prototype.removeEventFilter=function(e){throw t.ExceptionFactory.createPureVirtualError("Game#removeEventFilter")},e.prototype.shouldSaveSnapshot=function(){throw t.ExceptionFactory.createPureVirtualError("Game#shouldSaveSnapshot")},e.prototype.saveSnapshot=function(e,i){throw t.ExceptionFactory.createPureVirtualError("Game#saveSnapshot")},e.prototype._fireSceneReady=function(t){this._sceneChangeRequests.push({type:3,scene:t})},e.prototype._fireSceneLoaded=function(e){e._loadingState<t.SceneLoadState.LoadedFired&&this._sceneChangeRequests.push({type:4,scene:e})},e.prototype._callSceneAssetHolderHandler=function(t){this._sceneChangeRequests.push({type:5,assetHolder:t})},e.prototype._normalizeConfiguration=function(e){if(!e)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if("assets"in e||(e.assets={}),"fps"in e||(e.fps=30),"number"!=typeof e.fps)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=e.fps&&e.fps<=60))throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof e.width)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof e.height)throw t.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return e},e.prototype._setAudioPlaybackRate=function(t){this._audioSystemManager._setPlaybackRate(t)},e.prototype._setMuted=function(t){this._audioSystemManager._setMuted(t)},e.prototype._decodeOperationPluginOperation=function(t,e){var i=this._operationPluginManager.plugins;return i[t]&&i[t].decode?i[t].decode(e):e},e.prototype._reset=function(e){if(this._operationPluginManager.stopAll(),this.scene()){for(;this.scene()!==this._initialScene;)this.popScene(),this._flushSceneChangeRequests();this.isLoaded||this.scenes.pop()}switch(e&&(void 0!==e.age&&(this.age=e.age),void 0!==e.randGen&&(this.random[0]=e.randGen)),this._loaded.removeAllByHandler(this._start),this.join._reset(),this.leave._reset(),this.seed._reset(),this._idx=0,this._localIdx=0,this._cameraIdx=0,this.db={},this._localDb={},this.events=[],this.modified=!0,this.loadingScene=void 0,this._focusingCamera=void 0,this._scriptCaches={},this.snapshotRequest._reset(),this._sceneChangeRequests=[],this._isTerminated=!1,this.vars={},this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new t.LoadingScene({game:this});break;default:this._defaultLoadingScene=new t.DefaultLoadingScene({game:this})}},e.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._start():(this._loaded.handle(this,this._start),this.pushScene(this._initialScene),this._flushSceneChangeRequests())},e.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw t.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushSceneChangeRequests()},e.prototype._updateEventTriggers=function(e){return this.modified=!0,e?(this._eventTriggerMap[t.EventType.Message]=e.message,this._eventTriggerMap[t.EventType.PointDown]=e.pointDownCapture,this._eventTriggerMap[t.EventType.PointMove]=e.pointMoveCapture,this._eventTriggerMap[t.EventType.PointUp]=e.pointUpCapture,this._eventTriggerMap[t.EventType.Operation]=e.operation,void e._activate()):(this._eventTriggerMap[t.EventType.Message]=void 0,this._eventTriggerMap[t.EventType.PointDown]=void 0,this._eventTriggerMap[t.EventType.PointMove]=void 0,this._eventTriggerMap[t.EventType.PointUp]=void 0,void(this._eventTriggerMap[t.EventType.Operation]=void 0))},e.prototype._onInitialSceneLoaded=function(){this._initialScene.loaded.remove(this,this._onInitialSceneLoaded),this.assets=this._initialScene.assets,this.isLoaded=!0,this._loaded.fire()},e.prototype._leaveGame=function(){throw t.ExceptionFactory.createPureVirtualError("Game#_leaveGame")},e.prototype._terminateGame=function(){},e.prototype._flushSceneChangeRequests=function(){do{var e=this._sceneChangeRequests;this._sceneChangeRequests=[];for(var i=0;i<e.length;++i){var r=e[i];switch(r.type){case 0:var s=this.scene();s&&s._deactivate(),this._doPushScene(r.scene);break;case 1:this._doPopScene(r.preserveCurrent,!1),this._doPushScene(r.scene);break;case 2:this._doPopScene(r.preserveCurrent,!0);break;case 3:r.scene._fireReady();break;case 4:r.scene._fireLoaded();break;case 5:r.assetHolder.callHandler();break;default:throw t.ExceptionFactory.createAssertionError("Game#_flushSceneChangeRequests: unknown scene change request.")}}}while(this._sceneChangeRequests.length>0)},e.prototype._doPopScene=function(e,i){var r=this.scenes.pop();if(r===this._initialScene)throw t.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");e||r.destroy(),i&&this._sceneChanged.fire(this.scene())},e.prototype._start=function(){if(this._operationPluginManager.initialize(),this.operationPlugins=this._operationPluginManager.plugins,!this._main){if(this._mainParameter.snapshot){if(!this.assets.snapshotLoader)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'snapshotLoader' not found.");var e=t._require(this,"snapshotLoader");e(this._mainParameter.snapshot),this._flushSceneChangeRequests()}else{if(!this.assets.mainScene)throw t.ExceptionFactory.createAssertionError("Game#_start: global asset 'mainScene' not found.");var i=t._require(this,"mainScene")();this.pushScene(i),this._flushSceneChangeRequests()}return void this._started.fire()}var r=t._require(this,this._main);if(!r||"function"!=typeof r)throw t.ExceptionFactory.createAssertionError("Game#_start: Entry point '"+this._main+"' not found.");r(this._mainParameter),this._flushSceneChangeRequests(),this._started.fire()},e.prototype._doPushScene=function(e,i){if(i||(i=this.loadingScene||this._defaultLoadingScene),this.scenes.push(e),e._needsLoading()&&e._loadingState<t.SceneLoadState.LoadedFired){if(this._defaultLoadingScene._needsLoading())throw t.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets/storages.");this._doPushScene(i,this._defaultLoadingScene),i.reset(e)}else this._sceneChanged.fire(e),e._loaded||(e._load(),this._fireSceneLoaded(e));this.modified=!0},e}();t.Game=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i){var r=this;if(i instanceof t.Game){var s=i;r=e.call(this)||this,r.game=s,r.local=!1,r.name=void 0,r._modifiedCount=0,r.width=s.width,r.height=s.height,s.logger.debug("[deprecated] Camera2D:This constructor is deprecated. Refer to the API documentation and use Camera2D(param: Camera2DParameterObject) instead.")}else{var o=i;r=e.call(this,o)||this,r.game=o.game,r.local=!!o.local,r.name=o.name,r._modifiedCount=0,r.width=o.game.width,r.height=o.game.height}return r.id=r.local?void 0:r.game._cameraIdx++,r}return i(r,e),r.deserialize=function(t,e){var i=t;i.param.game=e;var s=new r(i.param);return s.id=i.id,s},r.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0),this.game.modified=!0},r.prototype.serialize=function(){var t={id:this.id,param:{game:void 0,local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,compositeOperation:this.compositeOperation}};return t},r.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},r.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y):this._matrix.reset(-this.x,-this.y)},r}(t.Object2D);t.Camera2D=e}(t||(t={}));var t;!function(t){var e=function(){function e(){}return e.prototype.draw=function(t,e){var i=t.scene();if(i){this.begin(),this.clear(),e&&(this.save(),e._applyTransformToRenderer(this));for(var r=i.children,s=0;s<r.length;++s)r[s].render(this,e);e&&this.restore(),this.end()}},e.prototype.begin=function(){},e.prototype.clear=function(){throw t.ExceptionFactory.createPureVirtualError("Renderer#clear")},e.prototype.drawImage=function(e,i,r,s,o,n,a){throw t.ExceptionFactory.createPureVirtualError("Renderer#drawImage")},e.prototype.drawSprites=function(e,i,r,s,o,n,a,h){throw t.ExceptionFactory.createPureVirtualError("Renderer#drawSprites")},e.prototype.drawSystemText=function(e,i,r,s,o,n,a,h,c,d,l,u){throw t.ExceptionFactory.createPureVirtualError("Renderer#drawSystemText")},e.prototype.translate=function(e,i){throw t.ExceptionFactory.createPureVirtualError("Renderer#translate")},e.prototype.transform=function(e){throw t.ExceptionFactory.createPureVirtualError("Renderer#transform")},e.prototype.opacity=function(e){throw t.ExceptionFactory.createPureVirtualError("Renderer#opacity")},e.prototype.save=function(){throw t.ExceptionFactory.createPureVirtualError("Renderer#save")},e.prototype.restore=function(){throw t.ExceptionFactory.createPureVirtualError("Renderer#restore")},e.prototype.fillRect=function(e,i,r,s,o){throw t.ExceptionFactory.createPureVirtualError("Renderer#fillRect")},e.prototype.setCompositeOperation=function(e){throw t.ExceptionFactory.createPureVirtualError("Renderer#setCompositeOperation")},e.prototype.setTransform=function(e){throw t.ExceptionFactory.createPureVirtualError("Renderer#setTransform")},e.prototype.setOpacity=function(e){throw t.ExceptionFactory.createPureVirtualError("Renderer#setOpacity")},e.prototype.end=function(){},e}();t.Renderer=e}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,s){if(void 0===s&&(s=!1),e%1!==0||i%1!==0)throw t.ExceptionFactory.createAssertionError("Surface#constructor: width and height must be integers");this.width=e,this.height=i,r&&(this._drawable=r),this.isDynamic=s,this.isDynamic?(this.animatingStarted=new t.Trigger,this.animatingStopped=new t.Trigger):(this.animatingStarted=void 0,this.animatingStopped=void 0)}return e.prototype.renderer=function(){throw t.ExceptionFactory.createPureVirtualError("Surface#renderer")},e.prototype.isPlaying=function(){throw t.ExceptionFactory.createPureVirtualError("Surface#isPlaying()")},e.prototype.destroy=function(){this.animatingStarted&&this.animatingStarted.destroy(),this.animatingStopped&&this.animatingStopped.destroy(),this._destroyed=!0},e.prototype.destroyed=function(){return!!this._destroyed},e}();t.Surface=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o){var n=this;if(i instanceof t.Scene){var a=i;n=e.call(this,a)||this,n.text=r,n.bitmapFont=s,n.font=s,n.textAlign=t.TextAlign.Left,n.glyphs=new Array(r.length),n.fontSize=o,n.maxWidth=void 0,n.widthAutoAdjust=!0,n.textColor=void 0,n._textWidth=0,n._game=void 0,n._invalidateSelf()}else{var h=i;if(!h.font&&!h.bitmapFont)throw t.ExceptionFactory.createAssertionError("Label#constructor: 'font' or 'bitmapFont' must be given to LabelParameterObject");n=e.call(this,h)||this,n.text=h.text,n.bitmapFont=h.bitmapFont,n.font=h.font?h.font:h.bitmapFont,n.textAlign="textAlign"in h?h.textAlign:t.TextAlign.Left,n.glyphs=new Array(h.text.length),n.fontSize=h.fontSize,n.maxWidth=h.maxWidth,n.widthAutoAdjust=!("widthAutoAdjust"in h)||h.widthAutoAdjust,n.textColor=h.textColor,n._textWidth=0,n._game=void 0,n._invalidateSelf()}return n}return i(r,e),r.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderCache=function(e){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var i=this.scene.game.resourceFactory.createSurface(Math.ceil(this._textWidth),Math.ceil(this.height)),r=i.renderer();r.begin(),r.save();for(var s=0;s<this.glyphs.length;++s){var o=this.glyphs[s],n=this.fontSize/this.font.size,a=o.advanceWidth*n;o.surface&&(r.save(),r.transform([n,0,0,n,0,0]),r.drawImage(o.surface,o.x,o.y,o.width,o.height,o.offsetX,o.offsetY),r.restore()),r.translate(a,0)}r.restore(),r.end();var h,c=this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1;switch(this.textAlign){case t.TextAlign.Center:h=this.width/2-this._textWidth/2*c;break;case t.TextAlign.Right:h=this.width-this._textWidth*c;break;default:h=0}e.save(),e.translate(h,0),1!==c&&e.transform([c,0,0,1,0,0]),e.drawImage(i,0,0,this._textWidth,this.height,0,0),i.destroy(),this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this._textWidth,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){e.prototype.destroy.call(this)},r.prototype._invalidateSelf=function(){if(void 0!==this.bitmapFont&&(this.font=this.bitmapFont),this.glyphs.length=0,this._textWidth=0,!this.fontSize)return void(this.height=0);for(var e=0,i=this.font.size>0?this.fontSize/this.font.size:0,r=0;r<this.text.length;++r){var s=t.Util.charCodeAt(this.text,r);if(s){var o=this.font.glyphForCharacter(s);if(o){if(!(o.width<0||o.height<0||o.x<0||o.y<0)){this.glyphs.push(o),this._textWidth+=o.advanceWidth*i;var n=o.offsetY+o.height;n>e&&(e=n)}}else{var a=4294901760&s?String.fromCharCode((4294901760&s)>>>16,65535&s):String.fromCharCode(s);this.game().logger.warn("Label#_invalidateSelf(): failed to get a glyph for '"+a+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")}}}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=e*i},r}(t.CacheableE);t.Label=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i,r,s,o,n,a,h,c){void 0===o&&(o=0),void 0===n&&(n=0),void 0===a&&(a=r),void 0===c&&(c=!!h),this.code=t,this.x=e,this.y=i,this.width=r,this.height=s,this.offsetX=o,this.offsetY=n,this.advanceWidth=a,this.surface=h,this.isSurfaceValid=c,this._atlas=null}return t.prototype.renderingWidth=function(t){return this.width&&this.height?t/this.height*this.width:0},t}();t.Glyph=e;var i=function(){function i(e,i,r,s,o){if(e instanceof t.Surface||e instanceof t.Asset)this.surface=t.Util.asSurface(e),this.map=i,this.defaultGlyphWidth=r,this.defaultGlyphHeight=s,this.missingGlyph=o,this.size=s;else{var n=e;this.surface=t.Util.asSurface(n.src),this.map=n.map,this.defaultGlyphWidth=n.defaultGlyphWidth,this.defaultGlyphHeight=n.defaultGlyphHeight,this.missingGlyph=n.missingGlyph,this.size=n.defaultGlyphHeight}}return i.prototype.glyphForCharacter=function(t){var i=this.map[t]||this.missingGlyph;if(!i)return null;var r=void 0===i.width?this.defaultGlyphWidth:i.width,s=void 0===i.height?this.defaultGlyphHeight:i.height,o=i.offsetX||0,n=i.offsetY||0,a=void 0===i.advanceWidth?r:i.advanceWidth,h=0===r||0===s?void 0:this.surface;return new e(t,i.x,i.y,r,s,o,n,a,h,!0)},i.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},i.prototype.destroyed=function(){return!this.map},i}();t.BitmapFont=i}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o){var n=this;if(i instanceof t.Scene){var a=i;if(n=e.call(this,a)||this,"string"!=typeof r)throw t.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",r);n.cssColor=r,n.width=s,n.height=o}else{var h=i;if(n=e.call(this,h)||this,"string"!=typeof h.cssColor)throw t.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",r);n.cssColor=h.cssColor}return n}return i(r,e),r.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},r}(t.E);t.FilledRect=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o,n,a){var h=this;if(i instanceof t.Scene){var c=i;h=e.call(this,c)||this,h.width=h._oldWidth=r,h.height=h._oldHeight=s,h.backgroundImage=t.Util.asSurface(o),h.backgroundEffector=a,h._shouldRenderChildren=!1,h._padding=n,h._initialize(),h._paddingChanged=!1,h._bgSurface=void 0,h._bgRenderer=void 0}else{var d=i;h=e.call(this,d)||this,h._oldWidth=d.width,h._oldHeight=d.height,h.backgroundImage=t.Util.asSurface(d.backgroundImage),h.backgroundEffector=d.backgroundEffector,h._shouldRenderChildren=!1,h._padding=d.padding,h._initialize(),h._paddingChanged=!1,h._bgSurface=void 0,h._bgRenderer=void 0}return h}return i(r,e),Object.defineProperty(r.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!0,configurable:!0}),r.prototype.modified=function(t){t&&(this.state&=-3),e.prototype.modified.call(this)},r.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},r.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this.backgroundImage&&t.drawImage(this.backgroundImage,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},r.prototype.destroy=function(t){t&&this.backgroundImage&&!this.backgroundImage.destroyed()&&this.backgroundImage.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,e.prototype.destroy.call(this)},r.prototype._renderBackground=function(){this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this.backgroundImage&&this.backgroundEffector?this._bgSurface=this.backgroundEffector.render(this.backgroundImage,this.width,this.height):this._bgSurface=void 0},r.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var i=this.children,r=0;r<i.length;++r)i[r].render(this._childrenRenderer,t);this._childrenRenderer.end()},r.prototype._initialize=function(){var t,e=void 0===this._padding?0:this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:this._padding,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var i=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=i.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},r.prototype._calculateBoundingRect=function(t,e){var i=this.getMatrix();if(t&&(i=t.multiplyNew(i)),this.visible()&&(!e||this._targetCameras&&-1!==this._targetCameras.indexOf(e))){for(var r={left:0,right:this.width,top:0,bottom:this.height},s=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],o=i.multiplyPoint(s[0]),n={left:o.x,right:o.x,top:o.y,bottom:o.y},a=1;a<s.length;++a)o=i.multiplyPoint(s[a]),n.left>o.x&&(n.left=o.x),n.right<o.x&&(n.right=o.x),n.top>o.y&&(n.top=o.y),n.bottom<o.y&&(n.bottom=o.y);return n}},r}(t.CacheableE);t.Pane=e}(t||(t={}));var t;!function(t){var e=function(){function e(t){this.game=t}return e.prototype.open=function(e,i){throw t.ExceptionFactory.createPureVirtualError("TextInputMethod#open")},e}();t.TextInputMethod=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e,i){this._code=t,this._handler=i,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;t instanceof Array?e={_code:this._code,data:t}:(e=t,e._code=this._code),this._handler.call(this._handlerOwner,e)},t}(),i=function(){function i(e,i,r){this.operated=new t.Trigger,this.plugins={},this._game=e,this._viewInfo=i,this._infos=r,this._initialized=!1}return i.prototype.initialize=function(){this._initialized||(this._initialized=!0,this._loadOperationPlugins()),this._doAutoStart()},i.prototype.destroy=function(){this.stopAll(),this.operated.destroy(),this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0,this._infos=void 0},i.prototype.stopAll=function(){if(this._initialized)for(var t=0;t<this._infos.length;++t){var e=this._infos[t];e._plugin&&e._plugin.stop()}},i.prototype._doAutoStart=function(){for(var t=0;t<this._infos.length;++t){var e=this._infos[t];!e.manualStart&&e._plugin&&e._plugin.start()}},i.prototype._loadOperationPlugins=function(){for(var i=0;i<this._infos.length;++i){var r=this._infos[i];if(r.script){var s=t._require(this._game,r.script);if(s.isSupported()){var o=new s(this._game,this._viewInfo,r.option),n=r.code;if(this.plugins[n])throw new Error("Plugin#code conflicted for code: "+n);this.plugins[n]=o,r._plugin=o;var a=new e(n,this.operated,this.operated.fire);o.operationTrigger.handle(a,a.onOperation)}}}},i}();t.OperationPluginManager=i}(t||(t={}));var t;!function(t){}(t||(t={}));var t;!function(t){function e(t,e,i){for(;t;){if(t.width>=e&&t.height>=i)return t;t=t.next}return null}function i(t){var e=Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),i=Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight));return{width:e,height:i}}var r;!function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(r=t.FontWeight||(t.FontWeight={}));var s=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r,this.prev=null,this.next=null}return t}();t.SurfaceAtlasSlot=s;var o=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new s(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype._acquireSurfaceAtlasSlot=function(t,i){t+=1,i+=1;var r=e(this._emptySurfaceAtlasSlotHead,t,i);if(!r)return null;var o,n,a=r.width-t,h=r.height-i;h>=a?(o=new s(r.x+t,r.y,a,i),n=new s(r.x,r.y+i,r.width,h)):(o=new s(r.x,r.y+i,t,h),n=new s(r.x+t,r.y,a,r.height)),o.prev=r.prev,o.next=n,null===o.prev?this._emptySurfaceAtlasSlotHead=o:o.prev.next=o,n.prev=o,n.next=r.next,n.next&&(n.next.prev=n);var c=new s(r.x,r.y,t,i);return this._updateUsedRectangleAreaSize(c),c},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,i=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),i>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=i)},t.prototype.addSurface=function(t,e){var i=this._acquireSurfaceAtlasSlot(e.width,e.height);if(!i)return null;var r=this._surface.renderer();return r.begin(),r.drawImage(t,e.x,e.y,e.width,e.height,i.x,i.y),r.end(),i},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.duplicateSurface=function(t){var e=this._surface,i=t.createSurface(this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height),r=i.renderer();return r.begin(),r.drawImage(e,0,0,this._usedRectangleAreaSize.width,this._usedRectangleAreaSize.height,0,0),r.end(),i},t}();t.SurfaceAtlas=o;var n=function(){function e(e,s,o,n,a,h,c,d){if(void 0===n&&(n={}),void 0===a&&(a="black"),void 0===h&&(h=0),void 0===c&&(c="black"),void 0===d&&(d=!1),"number"==typeof e)this.fontFamily=e,this.size=s,this.hint=n,this.fontColor=a,this.strokeWidth=h,this.strokeColor=c,this.strokeOnly=d,this._resourceFactory=o.resourceFactory,this._glyphFactory=this._resourceFactory.createGlyphFactory(e,s,n.baselineHeight,a,h,c,d),o.logger.debug("[deprecated] DynamicFont: This constructor is deprecated. Refer to the API documentation and use constructor(param: DynamicFontParameterObject) instead.");else{var l=e;this.fontFamily=l.fontFamily,this.size=l.size,this.hint="hint"in l?l.hint:{},this.fontColor="fontColor"in l?l.fontColor:"black",this.fontWeight="fontWeight"in l?l.fontWeight:r.Normal,this.strokeWidth="strokeWidth"in l?l.strokeWidth:0,this.strokeColor="strokeColor"in l?l.strokeColor:"black",this.strokeOnly="strokeOnly"in l&&l.strokeOnly,this._resourceFactory=l.game.resourceFactory,this._glyphFactory=this._resourceFactory.createGlyphFactory(this.fontFamily,this.size,this.hint.baselineHeight,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)}if(this._glyphs={},this._atlases=[],this._currentAtlasIndex=0,this._destroyed=!1,this.hint.initialAtlasWidth=this.hint.initialAtlasWidth?this.hint.initialAtlasWidth:2048,this.hint.initialAtlasHeight=this.hint.initialAtlasHeight?this.hint.initialAtlasHeight:2048,this.hint.maxAtlasWidth=this.hint.maxAtlasWidth?this.hint.maxAtlasWidth:2048,this.hint.maxAtlasHeight=this.hint.maxAtlasHeight?this.hint.maxAtlasHeight:2048,this.hint.maxAtlasNum=this.hint.maxAtlasNum?this.hint.maxAtlasNum:1,this._atlasSize=i(this.hint),this._atlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),n.presetChars)for(var u=0,p=n.presetChars.length;p>u;u++){var f=t.Util.charCodeAt(n.presetChars,u);f&&this.glyphForCharacter(f)}}return e.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if(e=this._glyphFactory.create(t),e.surface){if(e.width>this._atlasSize.width||e.height>this._atlasSize.height)return null;var i=this._addToAtlas(e);if(!i&&(this._reallocateAtlas(),i=this._addToAtlas(e),!i))return null;e._atlas=i}this._glyphs[t]=e}for(var r=0;r<this._atlases.length;r++){var s=this._atlases[r];s===e._atlas&&(s._accessScore+=1),s._accessScore/=2}return e},e.prototype.asBitmapFont=function(e){var i=this;if(1!==this._atlases.length)return null;var r;e&&(r=t.Util.charCodeAt(e,0),this.glyphForCharacter(r));
var s={};Object.keys(this._glyphs).forEach(function(t){var e=Number(t),r=i._glyphs[e],o={x:r.x,y:r.y,width:r.width,height:r.height,offsetX:r.offsetX,offsetY:r.offsetY,advanceWidth:r.advanceWidth};s[e]=o});var o=s[r],n=this._atlases[0].duplicateSurface(this._resourceFactory),a=new t.BitmapFont(n,s,0,this.size,o);return a},e.prototype._removeLowUseAtlas=function(){for(var t=Number.MAX_VALUE,e=-1,i=0;i<this._atlases.length;i++)this._atlases[i]._accessScore<=t&&(t=this._atlases[i]._accessScore,e=i);var r=this._atlases.splice(e,1)[0];return r},e.prototype._reallocateAtlas=function(){if(this._atlases.length>=this.hint.maxAtlasNum){var t=this._removeLowUseAtlas(),e=this._glyphs;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];r.surface===t._surface&&(r.surface=null,r.isSurfaceValid=!1,r._atlas=null)}t.destroy()}this._atlases.push(this._resourceFactory.createSurfaceAtlas(this._atlasSize.width,this._atlasSize.height)),this._currentAtlasIndex=this._atlases.length-1},e.prototype._addToAtlas=function(t){for(var e=null,i=null,r={x:t.x,y:t.y,width:t.width,height:t.height},s=0;s<this._atlases.length;s++){var o=(this._currentAtlasIndex+s)%this._atlases.length;if(e=this._atlases[o],i=e.addSurface(t.surface,r)){this._currentAtlasIndex=o;break}}return i?(t.surface.destroy(),t.surface=e._surface,t.x=i.x,t.y=i.y,e):null},e.prototype.destroy=function(){for(var t=0;t<this._atlases.length;t++)this._atlases[t].destroy();this._glyphs=null,this._glyphFactory=null,this._destroyed=!0},e.prototype.destroyed=function(){return this._destroyed},e}();t.DynamicFont=n}(t||(t={}));var t;!function(t){var e=function(){function t(t){this._game=t,this._muted=!1,this._playbackRate=1}return t.prototype._setMuted=function(t){if(this._muted!==t){this._muted=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setMuted(t)}},t.prototype._setPlaybackRate=function(t){if(this._playbackRate!==t){this._playbackRate=t;var e=this._game.audio;for(var i in e)e.hasOwnProperty(i)&&e[i]._setPlaybackRate(t)}},t}();t.AudioSystemManager=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy"}(e=t.CompositeOperation||(t.CompositeOperation={}))}(t||(t={}));var t;!function(t){var e=function(){function e(e,i,r,s,o,n,a,h){void 0===r&&(r=i),void 0===s&&(s="black"),void 0===o&&(o=0),void 0===n&&(n="black"),void 0===a&&(a=!1),void 0===h&&(h=t.FontWeight.Normal),this.fontFamily=e,this.fontSize=i,this.fontWeight=h,this.baselineHeight=r,this.fontColor=s,this.strokeWidth=o,this.strokeColor=n,this.strokeOnly=a}return e.prototype.create=function(e){throw t.ExceptionFactory.createPureVirtualError("GlyphFactory#create")},e}();t.GlyphFactory=e}(t||(t={}));var t;!function(t){var e;!function(t){t[t.NonLocal=0]="NonLocal",t[t.FullLocal=1]="FullLocal",t[t.InterpolateLocal=2]="InterpolateLocal"}(e=t.LocalTickMode||(t.LocalTickMode={}))}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r,s,o,n,a){void 0===a&&(a=!0);var h=this;if(i instanceof t.Scene){var c=i;h=e.call(this,c)||this,h.text=r,h.bitmapFont=s,h.fontSize=o,h.width=n,h.lineBreak=a,h.lineGap=0,h.textAlign=t.TextAlign.Left,h.textColor=void 0}else{var d=i;h=e.call(this,d)||this,h.text=d.text,h.bitmapFont=d.bitmapFont,h.fontSize=d.fontSize,h.width=d.width,h.lineBreak=!("lineBreak"in d)||d.lineBreak,h.lineGap=d.lineGap||0,h.textAlign="textAlign"in d?d.textAlign:t.TextAlign.Left,h.textColor=d.textColor}return h._lines=[],h._beforeText=void 0,h._beforeLineBreak=void 0,h._beforeBitmapFont=void 0,h._beforeFontSize=void 0,h._beforeTextAlign=void 0,h._beforeWidth=void 0,h._invalidateSelf(),h}return i(r,e),r.prototype.invalidate=function(){this._invalidateSelf(),e.prototype.invalidate.call(this)},r.prototype.renderCache=function(e){if(0!==this.fontSize){e.save();for(var i=0;i<this._lines.length;++i)this._lines[i].width<=0||e.drawImage(this._lines[i].surface,0,0,this._lines[i].width,this.fontSize,this._offsetX(this._lines[i].width),i*(this.fontSize+this.lineGap));this.textColor&&(e.setCompositeOperation(t.CompositeOperation.SourceAtop),e.fillRect(0,0,this.width,this.height,this.textColor)),e.restore()}},r.prototype.destroy=function(){this._destroyLines(),e.prototype.destroy.call(this)},r.prototype._offsetX=function(e){switch(this.textAlign){case t.TextAlign.Left:return 0;case t.TextAlign.Right:return this.width-e;case t.TextAlign.Center:return(this.width-e)/2;default:return 0}},r.prototype._lineBrokenText=function(){var t=this.text.split(/\r\n|\r|\n/);if(this.lineBreak){for(var e=[],i=0;i<t.length;++i){for(var r=t[i],s=0,o=0,n=0;n<r.length;++n){var a=this.bitmapFont.glyphForCharacter(r.charCodeAt(n)),h=a.renderingWidth(this.fontSize);s+h>this.width&&(e.push(r.substring(o,n)),o=n,s=0),s+=h}e.push(r.substring(o,r.length))}return e}return t},r.prototype._invalidateSelf=function(){if(this.fontSize<0)throw t.ExceptionFactory.createAssertionError("MultiLineLabel#_invalidateSelf: fontSize must not be negative.");if(this.lineGap<-1*this.fontSize)throw t.ExceptionFactory.createAssertionError("MultiLineLabel#_invalidateSelf: lineGap must be greater than -1 * fontSize.");(this._beforeText!==this.text||this._beforeFontSize!==this.fontSize||this._beforeBitmapFont!==this.bitmapFont||this._beforeLineBreak!==this.lineBreak||this._beforeWidth!==this.width&&this._beforeLineBreak===!0)&&this._createLines(),this.height=this.fontSize+(this.fontSize+this.lineGap)*(this._lines.length-1),this._beforeText=this.text,this._beforeTextAlign=this.textAlign,this._beforeFontSize=this.fontSize,this._beforeLineBreak=this.lineBreak,this._beforeBitmapFont=this.bitmapFont,this._beforeWidth=this.width},r.prototype._createLineInfo=function(t){if(0===this.fontSize)return{text:t,width:0};for(var e=0,i=[],r=0;r<t.length;++r){var s=this.bitmapFont.glyphForCharacter(t.charCodeAt(r));s.width&&s.height&&(i.push(s),e+=s.renderingWidth(this.fontSize))}if(0===e)return{text:t,width:0};var o=this.scene.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(this.fontSize)),n=o.renderer();n.begin(),n.save();for(var r=0;r<i.length;++r){var s=i[r];n.save();var a=this.fontSize/s.height;n.transform([a,0,0,a,0,0]),n.drawImage(this.bitmapFont.surface,s.x,s.y,s.width,s.height,0,0),n.restore(),n.translate(s.renderingWidth(this.fontSize),0)}return n.restore(),n.end(),{text:t,width:e,surface:o}},r.prototype._createLines=function(){for(var t=this._lineBrokenText(),e=[],i=0;i<t.length;++i)void 0!==this._lines[i]&&t[i]===this._lines[i].text&&this._beforeBitmapFont===this.bitmapFont&&this._beforeFontSize===this.fontSize?e.push(this._lines[i]):(this._lines[i]&&this._lines[i].surface&&!this._lines[i].surface.destroyed()&&this._lines[i].surface.destroy(),e.push(this._createLineInfo(t[i])));for(var i=e.length;i<this._lines.length;i++)this._lines[i].surface&&!this._lines[i].surface.destroyed()&&this._lines[i].surface.destroy();this._lines=e},r.prototype._destroyLines=function(){for(var t=0;t<this._lines.length;t++)this._lines[t].surface&&!this._lines[t].surface.destroyed()&&this._lines[t].surface.destroy();this._lines=void 0},r}(t.CacheableE);t.MultiLineLabel=e}(t||(t={}));var t;!function(t){var e=function(){function t(t,e){void 0===e&&(e=4),this.game=t,"number"==typeof e?this.borderWidth={top:e,bottom:e,left:e,right:e}:this.borderWidth=e}return t.prototype.render=function(t,e,i){var r=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(i)),s=r.renderer();s.begin();var o=this.borderWidth.left,n=t.width-this.borderWidth.right,a=this.borderWidth.top,h=t.height-this.borderWidth.bottom,c=this.borderWidth.left,d=e-this.borderWidth.right,l=this.borderWidth.top,u=i-this.borderWidth.bottom,p=[{x:0,y:0,width:this.borderWidth.left,height:this.borderWidth.top},{x:n,y:0,width:this.borderWidth.right,height:this.borderWidth.top},{x:0,y:h,width:this.borderWidth.left,height:this.borderWidth.bottom},{x:n,y:h,width:this.borderWidth.right,height:this.borderWidth.bottom}],f=[{x:0,y:0},{x:d,y:0},{x:0,y:u},{x:d,y:u}],g=0;for(g=0;g<p.length;++g){var _=p[g];s.save(),s.translate(f[g].x,f[g].y),s.drawImage(t,_.x,_.y,_.width,_.height,0,0),s.restore()}var y=[{x:o,y:0,width:n-o,height:this.borderWidth.top},{x:0,y:a,width:this.borderWidth.left,height:h-a},{x:n,y:a,width:this.borderWidth.right,height:h-a},{x:o,y:h,width:n-o,height:this.borderWidth.bottom}],v=[{x:c,y:0,width:d-c,height:this.borderWidth.top},{x:0,y:l,width:this.borderWidth.left,height:u-l},{x:d,y:l,width:this.borderWidth.right,height:u-l},{x:c,y:u,width:d-c,height:this.borderWidth.bottom}];for(g=0;g<y.length;++g){var m=y[g],w=v[g];s.save(),s.translate(w.x,w.y),s.transform([w.width/m.width,0,0,w.height/m.height,0,0]),s.drawImage(t,m.x,m.y,m.width,m.height,0,0),s.restore()}var x=n-o,S=h-a,A=d-c,b=u-l;return s.save(),s.translate(c,l),s.transform([A/x,0,0,b/S,0,0]),s.drawImage(t,o,a,x,S,0,0),s.restore(),s.end(),r},t}();t.NinePatchSurfaceEffector=e}(t||(t={}));var t;!function(t){var e;!function(e){function i(i,r){function s(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return i;for(var o=e.splitPath(i),n=s(o.path).concat(s(r)),a=[],h=0;h<n.length;++h){var c=n[h];switch(c){case"..":var d=a.pop();if(void 0===d||""===d||"."===d)throw t.ExceptionFactory.createAssertionError("PathUtil.resolvePath: invalid arguments");break;case".":0===a.length&&a.push(".");break;case"":a=[""];break;default:a.push(c)}}return o.host+a.join("/")}function r(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)}function s(t){for(var e=t.length-1;e>=0;--e){var i=t.charAt(e);if("."===i)return t.substr(e);if("/"===i)return""}return""}function o(t){var i=e.splitPath(t),r=i.host;t=i.path,"/"===t[t.length-1]&&(t=t.slice(0,t.length-1));for(var s=t.split("/"),o=s.indexOf("node_modules"),n=o>0?o-1:0,a=[],h=s.length-1;h>=n;--h)if("node_modules"!==s[h]){var c=s.slice(0,h+1);c.push("node_modules");var d=c.join("/");a.push(r+d)}return a}function n(t,e){var i=t.indexOf("?");return-1===i?t+"."+e:t.substring(0,i)+"."+e+t.substring(i,t.length)}function a(t){var e="",i=t.indexOf("//");if(i>=0){var r=t.indexOf("/",i+2);r>=0?(e=t.slice(0,r),t=t.slice(r)):(e=t,t="/")}else e="";return{host:e,path:t}}e.resolvePath=i,e.resolveDirname=r,e.resolveExtname=s,e.makeNodeModulePaths=o,e.addExtname=n,e.splitPath=a}(e=t.PathUtil||(t.PathUtil={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Top=0]="Top",t[t.Middle=1]="Middle",t[t.Alphabetic=2]="Alphabetic",t[t.Bottom=3]="Bottom"}(e=t.TextBaseline||(t.TextBaseline={}));var r;!function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(r=t.FontFamily||(t.FontFamily={}));var s=function(s){function o(i){var o=s.call(this,i)||this;return o.text=i.text,o.fontSize=i.fontSize,o.textAlign="textAlign"in i?i.textAlign:t.TextAlign.Left,o.textBaseline="textBaseline"in i?i.textBaseline:e.Alphabetic,o.maxWidth=i.maxWidth,o.textColor="textColor"in i?i.textColor:"black",o.fontFamily="fontFamily"in i?i.fontFamily:r.SansSerif,o.strokeWidth="strokeWidth"in i?i.strokeWidth:0,o.strokeColor="strokeColor"in i?i.strokeColor:"black",o.strokeOnly="strokeOnly"in i&&i.strokeOnly,o}return i(o,s),o.prototype.renderSelf=function(e,i){if(this.text){var r;switch(this.textAlign){case t.TextAlign.Right:r=this.width;break;case t.TextAlign.Center:r=this.width/2;break;default:r=0}e.drawSystemText(this.text,r,0,this.maxWidth,this.fontSize,this.textAlign,this.textBaseline,this.textColor,this.fontFamily,this.strokeWidth,this.strokeColor,this.strokeOnly)}return!0},o}(t.E);t.SystemLabel=s}(t||(t={}));var t;!function(t){var e;!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(e=t.TextAlign||(t.TextAlign={}))}(t||(t={}));var t;!function(t){var e;!function(t){t[t.ByClock=0]="ByClock",t[t.Manual=1]="Manual"}(e=t.TickGenerationMode||(t.TickGenerationMode={}))}(t||(t={}));var t;!function(t){var e=function(){function t(t){this.initState(t)}return t.deserialize=function(e){var i=new t(0);return i._state0U=e._state0U,i._state0L=e._state0L,i._state1U=e._state1U,i._state1L=e._state1L,i},t.prototype.initState=function(t){var e=1812433253;t=e*(t^t>>30)+1,this._state0U=t,t=e*(t^t>>30)+2,this._state0L=t,t=e*(t^t>>30)+3,this._state1U=t,t=e*(t^t>>30)+4,this._state1L=t},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,i=this._state1U,r=this._state1L;this._state0U=i,this._state0L=r;var s=0,o=0,n=0,a=0,h=23,c=4294967295<<32-h;s=t<<h|(e&c)>>>32-h,o=e<<h,t^=s,e^=o,s=t^i,o=e^r;var d=17,l=4294967295>>>32-d;n=t>>>d,a=e>>>d|(t&l)<<32-d,s^=n,o^=a;var u=26,p=4294967295>>>32-u;n=i>>>u,a=r>>>u|(i&p)<<32-u,s^=n,o^=a,this._state1U=s,this._state1L=o;var f=(o>>>0)+(r>>>0);return n=s+i+(f/2>>>31)>>>0,a=f>>>0,[n,a]},t.prototype.random=function(){var t=this.randomInt();return(4294967296*t[0]+t[1])/0x10000000000000000},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t}();t.Xorshift=e}(t||(t={}));var t;!function(t){var e=function(e){function r(i,r){var s=this;if(void 0===i)throw t.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return s=e.call(this,i)||this,r?s._xorshift=t.Xorshift.deserialize(r):s._xorshift=new t.Xorshift(i),s}return i(r,e),r.deserialize=function(t){return new r(t._seed,t._xorshift)},r.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},r.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},r}(t.RandomGenerator);t.XorshiftRandomGenerator=e}(t||(t={})),e.exports=t}).call(this)},{}]},{},[]);	require=function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){var i=t[s][1][e];return n(i?i:e)},h,h.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=function(){function e(t){this.fps=t.fps,this.scaleFactor=t.scaleFactor||1,this.frameTrigger=new r.Trigger,this.rawFrameTrigger=new r.Trigger,this._platform=t.platform,this._maxFramePerOnce=t.maxFramePerOnce,this._deltaTimeBrokenThreshold=t.deltaTimeBrokenThreshold||e.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,t.frameHandler&&this.frameTrigger.handle(t.frameHandlerOwner,t.frameHandler),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return e.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},e.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},e.prototype.changeScaleFactor=function(e){this.running?(this.stop(),this.scaleFactor=e,this.start()):this.scaleFactor=e},e.prototype._onLooperCall=function(e){if(0>=e)return this._waitTime-this._totalDeltaTime;e>this._deltaTimeBrokenThreshold&&(e=this._waitTime);var t=this._totalDeltaTime;if(t+=e,t<=this._skipFrameWaitTime)return this._totalDeltaTime=t,this._waitTime-t;for(var i=t<this._waitTimeDoubled?1:t>this._waitTimeMax?this._realMaxFramePerOnce:t/this._waitTime|0,r=i,n={interrupt:!1};r>0&&this.running&&!n.interrupt;)--r,this.frameTrigger.fire(n);return t-=(i-r)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=t,this._waitTime-t},e.prototype._updateWaitTimes=function(t,i){var r=t*i;this._waitTime=1e3/r,this._waitTimeDoubled=Math.max(2e3/r|0,1),this._waitTimeMax=Math.max(i*(1e3*this._maxFramePerOnce/r)|0,1),this._skipFrameWaitTime=this._waitTime*e.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*i},e}();n.ANTICIPATE_RATE=.8,n.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,i.Clock=n},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("@akashic/playlog"),e("@akashic/akashic-pdi"),e("@akashic/akashic-engine")),n=(e("./EventIndex"),e("./PointEventResolver")),o=function(){function e(e){this._amflow=e.amflow,this._isReceiver=!1,this._isSender=!1,this._defaultEventPriority=0,this._buffer=null,this._joinLeaveBuffer=null,this._localBuffer=null,this._filters=null,this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._unfilteredJoinLeaves=[],this._pointEventResolver=new n.PointEventResolver({game:e.game}),this._onEvent_bound=this.onEvent.bind(this)}return e.isEventLocal=function(e){switch(e[0]){case 0:return e[5];case 1:return e[3];case 2:return e[4];case 32:return e[4];case 33:return e[7];case 34:return e[11];case 35:return e[11];case 64:return e[5];default:throw r.ExceptionFactory.createAssertionError("EventBuffer.isEventLocal")}},e.prototype.setMode=function(e){null!=e.isReceiver&&this._isReceiver!==e.isReceiver&&(this._isReceiver=e.isReceiver,e.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=e.isSender&&(this._isSender=e.isSender),null!=e.defaultEventPriority&&(this._defaultEventPriority=e.defaultEventPriority)},e.prototype.getMode=function(){return{isReceiver:this._isReceiver,isSender:this._isSender,defaultEventPriority:this._defaultEventPriority}},e.prototype.onEvent=function(t){return e.isEventLocal(t)?void this._unfilteredLocalEvents.push(t):(this._isReceiver&&(0===t[0]||1===t[0]?this._unfilteredJoinLeaves.push(t):this._unfilteredEvents.push(t)),void(this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t))))},e.prototype.onPointEvent=function(e){var t;switch(e.type){case 0:t=this._pointEventResolver.pointDown(e);break;case 1:t=this._pointEventResolver.pointMove(e);break;case 2:t=this._pointEventResolver.pointUp(e)}t&&this.onEvent(t)},e.prototype.addEventDirect=function(t){return e.isEventLocal(t)?void(this._localBuffer?this._localBuffer.push(t):this._localBuffer=[t]):(this._isReceiver&&(0===t[0]||1===t[0]?this._joinLeaveBuffer?this._joinLeaveBuffer.push(t):this._joinLeaveBuffer=[t]:this._buffer?this._buffer.push(t):this._buffer=[t]),void(this._isSender&&(null==t[1]&&(t[1]=this._defaultEventPriority),this._amflow.sendEvent(t))))},e.prototype.readEvents=function(){var e=this._buffer;return this._buffer=null,e},e.prototype.readJoinLeaves=function(){var e=this._joinLeaveBuffer;return this._joinLeaveBuffer=null,e},e.prototype.readLocalEvents=function(){var e=this._localBuffer;return this._localBuffer=null,e},e.prototype.addFilter=function(e){this._filters||(this._filters=[]),this._filters.push(e)},e.prototype.removeFilter=function(e){if(this._filters){if(!e)return void(this._filters=null);for(var t=this._filters.length-1;t>=0;--t)this._filters[t]===e&&this._filters.splice(t,1)}},e.prototype.processEvents=function(){var e=this._unfilteredLocalEvents,t=this._unfilteredEvents,i=this._unfilteredJoinLeaves;if(!this._filters)return e.length>0&&(this._unfilteredLocalEvents=[],this._localBuffer=this._localBuffer?this._localBuffer.concat(e):e),t.length>0&&(this._unfilteredEvents=[],this._buffer=this._buffer?this._buffer.concat(t):t),void(i.length>0&&(this._unfilteredJoinLeaves=[],this._joinLeaveBuffer=this._joinLeaveBuffer?this._joinLeaveBuffer.concat(i):i));if(e.length>0){this._unfilteredLocalEvents=[];for(var r=0;r<this._filters.length&&(e=this._filters[r](e));++r);e&&e.length>0&&(this._localBuffer=this._localBuffer?this._localBuffer.concat(e):e)}if(t.length>0){this._unfilteredEvents=[];for(var r=0;r<this._filters.length&&(t=this._filters[r](t));++r);t&&t.length>0&&(this._buffer=this._buffer?this._buffer.concat(t):t)}if(i.length>0){this._unfilteredJoinLeaves=[];for(var r=0;r<this._filters.length&&i&&i.length>0&&(i=this._filters[r](i));++r);i&&i.length>0&&(this._joinLeaveBuffer=this._joinLeaveBuffer?this._joinLeaveBuffer.concat(i):i)}},e}();i.EventBuffer=o},{"./EventIndex":4,"./PointEventResolver":13,"@akashic/akashic-engine":"@akashic/akashic-engine","@akashic/akashic-pdi":22,"@akashic/playlog":26}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=(e("@akashic/playlog"),e("./EventIndex"),function(){function e(e){this._game=e.game,this._playerTable={}}return e.prototype.toGameEvent=function(e){var t,i,n,o,s,a,u,c,h=e[0],l=e[1],f=e[2],_=this._playerTable[f]||{id:f};switch(h){case 0:_={id:f,name:e[3]},this._playerTable[f]=_;var p=void 0;if(e[4]){var g=[],d=[];e[4].map(function(e){g.push(e.readKey),d.push(e.values)}),p=new r.StorageValueStore(g,d)}return new r.JoinEvent(_,p,l);case 1:return delete this._playerTable[_.id],new r.LeaveEvent(_,l);case 2:return c=e[3],new r.TimestampEvent(c,_,l);case 32:return u=e[4],new r.MessageEvent(e[3],_,u,l);case 33:return u=e[7],t=e[3],i=e[6],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:e[4],y:e[5]},new r.PointDownEvent(t,n,o,_,u,l);case 34:return u=e[11],t=e[3],i=e[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:e[4],y:e[5]},s={x:e[6],y:e[7]},a={x:e[8],y:e[9]},new r.PointMoveEvent(t,n,o,a,s,_,u,l);case 35:return u=e[11],t=e[3],i=e[10],n=null==i?void 0:i>=0?this._game.db[i]:this._game._localDb[i],o={x:e[4],y:e[5]},s={x:e[6],y:e[7]},a={x:e[8],y:e[9]},new r.PointUpEvent(t,n,o,a,s,_,u,l);case 64:u=e[5];var v=e[3],m=e[4],T=this._game._decodeOperationPluginOperation(v,m);return new r.OperationEvent(v,T,_,u,l);default:throw r.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},e.prototype.toPlaylogEvent=function(e,t){var i,n;switch(e.type){case r.EventType.Join:case r.EventType.Leave:throw r.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+r.EventType[e.type]);case r.EventType.Timestamp:var o=e;return n=t?o.player.id:this._game.player.id,[2,o.priority,n,o.timestamp];case r.EventType.PointDown:var s=e;return i=s.target?s.target.id:null,n=t?s.player.id:this._game.player.id,[33,s.priority,n,s.pointerId,s.point.x,s.point.y,i,!!s.local];case r.EventType.PointMove:var a=e;return i=a.target?a.target.id:null,n=t?a.player.id:this._game.player.id,[34,a.priority,n,a.pointerId,a.point.x,a.point.y,a.startDelta.x,a.startDelta.y,a.prevDelta.x,a.prevDelta.y,i,!!a.local];case r.EventType.PointUp:var u=e;return i=u.target?u.target.id:null,n=t?u.player.id:this._game.player.id,[35,u.priority,n,u.pointerId,u.point.x,u.point.y,u.startDelta.x,u.startDelta.y,u.prevDelta.x,u.prevDelta.y,i,!!u.local];case r.EventType.Message:var c=e;return n=t?c.player.id:this._game.player.id,[32,c.priority,n,c.data,!!c.local];case r.EventType.Operation:var h=e;return n=t?h.player.id:this._game.player.id,[64,h.priority,n,h.code,h.data,!!h.local];default:throw r.ExceptionFactory.createAssertionError("Unknown type: "+e.type)}},e.prototype.makePlaylogOperationEvent=function(e){var t=this._game.player.id,i=null!=e.priority?e.priority:0;return[64,i,t,e._code,e.data,!!e.local]},e}());i.EventConverter=n},{"./EventIndex":4,"@akashic/akashic-engine":"@akashic/akashic-engine","@akashic/playlog":26}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(e){e[e.Active=0]="Active",e[e.Passive=1]="Passive"}(r||(r={})),i["default"]=r},{}],6:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=e("@akashic/akashic-engine"),o=function(e){function t(t){var i=e.call(this,t.configuration,t.resourceFactory,t.assetBase,t.player.id,t.operationPluginViewInfo)||this;return i.agePassedTrigger=new n.Trigger,i.skippingChangedTrigger=new n.Trigger,i.abortTrigger=new n.Trigger,i.player=t.player,i.raiseEventTrigger=new n.Trigger,i.raiseTickTrigger=new n.Trigger,i.snapshotTrigger=new n.Trigger,i.isSnapshotSaver=!!t.isSnapshotSaver,i._getCurrentTimeFunc=null,i._eventFilterFuncs=null,i._notifyPassedAgeTable={},i._gameArgs=t.gameArgs,i._globalGameArgs=t.globalGameArgs,i}return r(t,e),t.prototype.requestNotifyAgePassed=function(e){this._notifyPassedAgeTable[e]=!0},t.prototype.cancelNotifyAgePassed=function(e){delete this._notifyPassedAgeTable[e]},t.prototype.fireAgePassedIfNeeded=function(){var e=this.age-1;return!!this._notifyPassedAgeTable[e]&&(delete this._notifyPassedAgeTable[e],this.agePassedTrigger.fire(e),!0)},t.prototype.setCurrentTimeFunc=function(e){this._getCurrentTimeFunc=e},t.prototype.setEventFilterFuncs=function(e){this._eventFilterFuncs=e},t.prototype.setStorageFunc=function(e){this.storage._registerLoad(e.storageGetFunc),this.storage._registerWrite(e.storagePutFunc),this.storage.requestValuesForJoinPlayer=e.requestValuesForJoinFunc},t.prototype.raiseEvent=function(e){this.raiseEventTrigger.fire(e)},t.prototype.raiseTick=function(e){if(!this.scene()||this.scene().tickGenerationMode!==n.TickGenerationMode.Manual)throw n.ExceptionFactory.createAssertionError("Game#raiseTick(): tickGenerationMode for the current scene is not Manual.");this.raiseTickTrigger.fire(e)},t.prototype.addEventFilter=function(e){this._eventFilterFuncs.addFilter(e)},t.prototype.removeEventFilter=function(e){this._eventFilterFuncs.removeFilter(e)},t.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},t.prototype.saveSnapshot=function(e,t){void 0===t&&(t=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:this.age,timestamp:t,data:{randGenSer:this.random[0].serialize(),gameSnapshot:e}})},t.prototype._restartWithSnapshot=function(e){var t=e.data;if(this._eventFilterFuncs.removeFilter(),null!=t.seed){var i=new n.XorshiftRandomGenerator(t.seed);this._reset({age:e.frame,randGen:i}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})}else{var i=new n.XorshiftRandomGenerator(0,t.randGenSer);this._reset({age:e.frame,randGen:i}),this._loadAndStart({snapshot:t.gameSnapshot})}},t.prototype._leaveGame=function(){},t.prototype._terminateGame=function(){this.abortTrigger.fire()},t}(n.Game);i.Game=o},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("es6-promise"),n=e("@akashic/akashic-engine"),o=e("./ExecutionMode"),s=e("./Game"),a=e("./EventBuffer"),u=e("./GameLoop"),c=e("./PdiUtil"),h=function(){function e(e){this.errorTrigger=new n.Trigger,e.errorHandler&&this.errorTrigger.handle(e.errorHandlerOwner,e.errorHandler),this.configurationLoadedTrigger=new n.Trigger,this.gameCreatedTrigger=new n.Trigger,this._platform=e.platform,this._loadConfigurationFunc=c.PdiUtil.makeLoadConfigurationFunc(e.platform),this._player=e.player,this._playId=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1}return e.prototype.initialize=function(e,t){this.doInitialize(e).then(function(){t()},t)},e.prototype.changeState=function(e,t){var i=this,r=this._gameLoop&&this._gameLoop.running;r&&this._gameLoop.stop(),this.initialize(e,function(e){return e?void t(e):(r&&i._gameLoop.start(),void t())})},e.prototype.startGame=function(){return this._gameLoop?void this._gameLoop.start():void this.errorTrigger.fire(new Error("Not initialized"))},e.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},e.prototype.setNextAge=function(e){this._gameLoop.setNextAge(e)},e.prototype.getPermission=function(){return this._permission},e.prototype.getDriverConfiguration=function(){return{playId:this._playId,playToken:this._playToken,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},e.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},e.prototype.getHidden=function(){return this._hidden},e.prototype.doInitialize=function(e){var t=this,i=new r.Promise(function(i,r){return t._gameLoop&&t._gameLoop.running?r(new Error("Game is running. Must be stopped.")):(t._gameLoop&&e.loopConfiguration&&t._gameLoop.setLoopConfiguration(e.loopConfiguration),null!=e.hidden&&(t._hidden=e.hidden,t._game&&t._game._setMuted(e.hidden)),void i())}).then(function(){return t._doSetDriverConfiguration(e.driverConfiguration)});return e.configurationUrl?i.then(function(){return t._loadConfiguration(e.configurationUrl,e.assetBase)}).then(function(i){return t._createGame(i,t._player,e)}):i},e.prototype._doSetDriverConfiguration=function(e){var t=this;if(null==e)return r.Promise.resolve();void 0===e.playId&&(e.playId=this._playId),void 0===e.playToken&&(e.playToken=this._playToken),void 0===e.eventBufferMode&&(e.executionMode===o["default"].Active?e.eventBufferMode={isReceiver:!0,isSender:!1}:e.executionMode===o["default"].Passive&&(e.eventBufferMode={isReceiver:!1,isSender:!0}));var i=r.Promise.resolve();return this._playId!==e.playId&&(i=i.then(function(){return t._doOpenAmflow(e.playId)})),this._playToken!==e.playToken&&(i=i.then(function(){return t._doAuthenticate(e.playToken)})),i.then(function(){return new r.Promise(function(i,r){null!=e.eventBufferMode&&(null==e.eventBufferMode.defaultEventPriority&&(e.eventBufferMode.defaultEventPriority=t._permission.maxEventPriority),t._eventBuffer&&t._eventBuffer.setMode(e.eventBufferMode)),null!=e.executionMode&&t._gameLoop&&t._gameLoop.setExecutionMode(e.executionMode),i()})})},e.prototype._doCloseAmflow=function(){var e=this;return new r.Promise(function(t,i){return e._openedAmflow?void e._platform.amflow.close(function(r){return e._openedAmflow=!1,r?i(r):void t()}):t()})},e.prototype._doOpenAmflow=function(e){var t=this;if(void 0===e)return r.Promise.resolve();var i=this._doCloseAmflow();return i.then(function(){return new r.Promise(function(i,r){return null===e?i():void t._platform.amflow.open(e,function(n){return n?r(n):(t._openedAmflow=!0,t._playId=e,t._game&&t._updateGamePlayId(t._game),void i())})})})},e.prototype._doAuthenticate=function(e){var t=this;return null==e?r.Promise.resolve():new r.Promise(function(i,r){t._platform.amflow.authenticate(e,function(n,o){return n?r(n):(t._playToken=e,t._permission=o,t._game&&(t._game.isSnapshotSaver=t._permission.writeTick),void i())})})},e.prototype._loadConfiguration=function(e,t){var i=this;return new r.Promise(function(r,n){i._loadConfigurationFunc(e,t,function(e,t){return e?n(e):(i.configurationLoadedTrigger.fire(t),void r(t))})})},e.prototype._putZerothStartPoint=function(e){var t=this;return new r.Promise(function(i,r){var n={frame:0,timestamp:0,data:e};t._platform.amflow.putStartPoint(n,function(e){return e?r(e):void i()})})},e.prototype._getZerothStartPointData=function(){var e=this;return new r.Promise(function(t,i){e._platform.amflow.getStartPoint({frame:0},function(e,r){if(e)return i(e);var n=r.data;return"number"!=typeof n.seed?i(new Error("GameDriver#_getRandomSeed: No seed found.")):void t(n)})})},e.prototype._createGame=function(e,t,i){var c,h=this,l=i.driverConfiguration.executionMode===o["default"].Active&&this._permission.writeTick;return c=l?this._putZerothStartPoint({seed:Date.now(),globalArgs:i.globalGameArgs,fps:e.fps,startedAt:Date.now()}):r.Promise.resolve(),c=c.then(function(){return h._getZerothStartPointData()}),c.then(function(r){var c=h._platform,l=i.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:o["default"].Active},f=r.seed,_=i.gameArgs,p=r.globalArgs,g=r.startedAt;c.setRendererRequirement({primarySurfaceWidth:e.width,primarySurfaceHeight:e.height,rendererCandidates:e.renderers});var d=new s.Game({configuration:e,player:t,resourceFactory:c.getResourceFactory(),assetBase:i.assetBase,isSnapshotSaver:h._permission.writeTick,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():null,gameArgs:_,globalGameArgs:p}),v=new a.EventBuffer({game:d,amflow:c.amflow});v.setMode(l.eventBufferMode),c.setPlatformEventHandler(v),d.setEventFilterFuncs({addFilter:v.addFilter.bind(v),removeFilter:v.removeFilter.bind(v)}),d.renderers.push(c.getPrimarySurface().renderer());var m=new u.GameLoop({game:d,amflow:c.amflow,platform:c,executionMode:l.executionMode,eventBuffer:v,configuration:i.loopConfiguration,startedAt:g,profiler:i.profiler});d.setCurrentTimeFunc(m.getCurrentTime.bind(m)),d._reset({age:0,randGen:new n.XorshiftRandomGenerator(f)}),h._updateGamePlayId(d),h._hidden&&d._setMuted(!0),d.snapshotTrigger.handle(function(e){h._platform.amflow.putStartPoint(e,function(e){e&&h.errorTrigger.fire(e)})}),h._game=d,h._eventBuffer=v,h._gameLoop=m,h.gameCreatedTrigger.fire(d),h._game._loadAndStart({args:i.gameArgs||void 0})})},e.prototype._updateGamePlayId=function(e){var t=this;e.playId=this._playId,e.external.send=function(e){t._platform.sendToExternal(t._playId,e)}},e}();i.GameDriver=h},{"./EventBuffer":2,"./ExecutionMode":5,"./Game":6,"./GameLoop":8,"./PdiUtil":12,"@akashic/akashic-engine":"@akashic/akashic-engine","es6-promise":27}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=e("./LoopMode"),o=e("./LoopRenderMode"),s=e("./ExecutionMode"),a=(e("./EventIndex"),e("./Clock")),u=e("./ProfilerClock"),c=e("./EventConverter"),h=e("./TickController"),l=function(){function e(t){this.errorTrigger=new r.Trigger,this.running=!1,this._currentTime=0,this._frameTime=1e3/t.game.fps,t.errorHandler&&this.errorTrigger.handle(t.errorHandlerOwner,t.errorHandler);var i=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=i.targetTimeFunc||null,this._targetTimeOffset=i.targetTimeOffset||null,this._originDate=i.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate-this._startedAt:this._targetTimeOffset||0,this._delayIgnoreThreshold=i.delayIgnoreThreshold||e.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=i.skipTicksAtOnce||e.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=i.skipThreshold||e.DEFAULT_SKIP_THRESHOLD,this._jumpTryThreshold=i.jumpTryThreshold||e.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=i.jumpIgnoreThreshold||e.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=i._pollingTickThreshold||e.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=i.playbackRate||1;var n=null!=i.loopRenderMode?i.loopRenderMode:o["default"].AfterRawFrame;this._loopRenderMode=null,this._loopMode=i.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._sceneTickMode=null,this._sceneLocalMode=null,this._targetAge=null!=i.targetAge?i.targetAge:null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._skipping=!1,this._lastPollingTickTime=0,t.profiler?this._clock=new u.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new a.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new h.TickController({amflow:t.amflow,clock:this._clock,game:t.game,eventBuffer:t.eventBuffer,executionMode:t.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._eventConverter=new c.EventConverter({game:t.game}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(n),this._game.setStorageFunc(this._tickController.storageFunc()),this._game.raiseEventTrigger.handle(this,this._onGameRaiseEvent),this._game.raiseTickTrigger.handle(this,this._onGameRaiseTick),this._game._started.handle(this,this._onGameStarted),this._game._operationPluginOperated.handle(this,this._onGameOperationPluginOperated),this._tickBuffer.gotNextTickTrigger.handle(this,this._onGotNextFrameTick),this._tickBuffer.start(),this._updateGamePlaybackRate(),this._handleSceneChange()}return e.prototype.start=function(){this.running=!0,this._clock.start()},e.prototype.stop=function(){this._clock.stop(),this.running=!1},e.prototype.setNextAge=function(e){this._tickController.setNextAge(e)},e.prototype.getExecutionMode=function(){return this._executionMode},e.prototype.setExecutionMode=function(e){this._executionMode=e,this._tickController.setExecutionMode(e)},e.prototype.getLoopConfiguration=function(){return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:this._loopRenderMode,targetTimeFunc:this._targetTimeFunc,targetTimeOffset:this._targetTimeOffset,originDate:this._originDate,targetAge:this._targetAge}},e.prototype.setLoopConfiguration=function(e){null!=e.loopMode&&(this._loopMode=e.loopMode),null!=e.delayIgnoreThreshold&&(this._delayIgnoreThreshold=e.delayIgnoreThreshold),null!=e.skipTicksAtOnce&&(this._skipTicksAtOnce=e.skipTicksAtOnce),null!=e.skipThreshold&&(this._skipThreshold=e.skipThreshold),null!=e.jumpTryThreshold&&(this._jumpTryThreshold=e.jumpTryThreshold),null!=e.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=e.jumpIgnoreThreshold),null!=e.playbackRate&&(this._playbackRate=e.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGamePlaybackRate()),null!=e.loopRenderMode&&this._setLoopRenderMode(e.loopRenderMode),null!=e.targetTimeFunc&&(this._targetTimeFunc=e.targetTimeFunc),null!=e.targetTimeOffset&&(this._targetTimeOffset=e.targetTimeOffset),null!=e.originDate&&(this._originDate=e.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate-this._startedAt:this._targetTimeOffset||0,null!=e.targetAge&&(this._targetAge!==e.targetAge&&(this._waitingNextTick=!1),this._targetAge=e.targetAge)},e.prototype.addTickList=function(e){this._tickBuffer.addTickList(e)},e.prototype.getCurrentTime=function(){return this._currentTime},e.prototype._startSkipping=function(){this._skipping=!0,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!0)},e.prototype._stopSkipping=function(){this._skipping=!1,this._updateGamePlaybackRate(),this._game.skippingChangedTrigger.fire(!1)},e.prototype._updateGamePlaybackRate=function(){var e=this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate;this._game._setAudioPlaybackRate(e)},e.prototype._handleSceneChange=function(){var e=this._game.scene(),t=e?e.local:r.LocalTickMode.FullLocal,i=e?e.tickGenerationMode:r.TickGenerationMode.ByClock;if(this._sceneLocalMode!==t||this._sceneTickMode!==i)switch(this._sceneLocalMode=t,this._sceneTickMode=i,t){case r.LocalTickMode.FullLocal:this._tickController.stopTick(),this._clock.frameTrigger.remove(this,this._onFrame),this._clock.frameTrigger.handle(this,this._onLocalFrame);break;case r.LocalTickMode.NonLocal:case r.LocalTickMode.InterpolateLocal:i===r.TickGenerationMode.ByClock?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.remove(this,this._onLocalFrame),this._clock.frameTrigger.handle(this,this._onFrame);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+t))}},e.prototype._onLocalFrame=function(){this._doLocalTick()},e.prototype._doLocalTick=function(){var e=this._game,t=this._eventBuffer.readLocalEvents();if(this._currentTime+=this._frameTime,t)for(var i=0,r=t.length;r>i;++i)e.events.push(this._eventConverter.toGameEvent(t[i]));var n=e.tick(!1);n&&this._handleSceneChange()},e.prototype._onFrame=function(e){this._loopMode===n["default"].Replay&&this._targetTimeFunc?this._onFrameForTimedReplay(e):this._onFrameNormal(e)},e.prototype._onFrameForTimedReplay=function(e){var t=!1,i=this._game,n=this._targetTimeFunc()+this._realTargetTimeOffset,o=n-this._currentTime,s=o/this._frameTime;if((s>this._jumpTryThreshold||0>s)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=n,this._amflow.getStartPoint({timestamp:n},this._onGotStartPoint_bound)),this._skipping?1>=s&&this._stopSkipping():s>this._skipThreshold&&this._startSkipping(),!(0>=s))for(var a=0;a<this._skipTicksAtOnce;++a){if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._tickBuffer.requestTicks(),this._startWaitingNextTick());break}var u=this._currentTime+this._frameTime,c=this._tickBuffer.readNextTickTime();if(null==c&&(c=u),u>n){if(!(n>=c))break;u=n}else if(c>u){this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick();continue}this._currentTime=u;var h=this._tickBuffer.consume(),l=-1,f=this._eventBuffer.readLocalEvents();if(f)for(var _=0,p=f.length;p>_;++_)i.events.push(this._eventConverter.toGameEvent(f[_]));if("number"==typeof h)l=h,t=i.tick(!0);else{l=h[0];var g=h[1];if(g)for(var _=0,p=g.length;p>_;++_)i.events.push(this._eventConverter.toGameEvent(g[_]));t=i.tick(!0)}if(i._notifyPassedAgeTable[l]&&i.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(t){this._handleSceneChange();break}}},e.prototype._onFrameNormal=function(e){var t=!1,i=this._game;if(this._waitingNextTick)return void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());var o,s;if(this._loopMode===n["default"].Realtime?(o=this._tickBuffer.knownLatestAge+1,s=o-this._tickBuffer.currentAge):null===this._targetAge?(o=null,s=1):this._targetAge===this._tickBuffer.currentAge?(o=this._targetAge=null,s=1):(o=this._targetAge,s=o-this._tickBuffer.currentAge),(s>this._jumpTryThreshold||0>s)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<this._tickBuffer.currentAge&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=o,this._amflow.getStartPoint({frame:o},this._onGotStartPoint_bound)),this._skipping){var a=this._loopMode===n["default"].Realtime?0:1;a>=s&&this._stopSkipping()}else s>this._skipThreshold&&this._startSkipping();if(0>=s)return 0===s&&(this._sceneTickMode!==r.TickGenerationMode.Manual&&this._loopMode!==n["default"].Replay||0!==this._tickBuffer.currentAge||this._tickBuffer.requestTicks(),this._startWaitingNextTick()),void(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal&&this._doLocalTick());for(var u=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;u>c;++c){var h=this._currentTime+this._frameTime;if(this._loopMode===n["default"].Realtime);else{var l=this._tickBuffer.readNextTickTime();if(null!=l&&l>h){if(this._sceneLocalMode===r.LocalTickMode.InterpolateLocal){this._doLocalTick();continue}break}}this._currentTime=h;var f=this._tickBuffer.consume(),_=-1;if(null==f){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var p=this._eventBuffer.readLocalEvents();if(p)for(var g=0,d=p.length;d>g;++g)i.events.push(this._eventConverter.toGameEvent(p[g]));if("number"==typeof f)_=f,t=i.tick(!0);else{_=f[0];var v=f[1];if(v)for(var m=0,d=v.length;d>m;++m)i.events.push(this._eventConverter.toGameEvent(v[m]));t=i.tick(!0)}if(i._notifyPassedAgeTable[_]&&i.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(t){this._handleSceneChange();break}}},e.prototype._onGotNextFrameTick=function(){this._waitingNextTick&&this._loopMode!==n["default"].FrameByFrame&&this._stopWaitingNextTick()},e.prototype._onGotStartPoint=function(e,t){if(this._waitingStartPoint=!1,e)throw new Error;if(this._targetTimeFunc&&this._loopMode!==n["default"].Realtime){var i=this._targetTimeFunc()+this._realTargetTimeOffset;if(i<t.timestamp)return;var r=this._currentTime;if(i>r&&t.timestamp<r+this._jumpIgnoreThreshold*this._frameTime)return}else{var o=this._loopMode===n["default"].Realtime?this._tickBuffer.knownLatestAge:this._targetAge;if(null===o||o<t.frame)return;var s=this._tickBuffer.currentAge;if(o>s&&t.frame<s+this._jumpIgnoreThreshold)return}this._clock.frameTrigger.remove(this._eventBuffer,this._eventBuffer.processEvents),this._tickBuffer.setCurrentAge(t.frame),this._currentTime=t.timestamp||t.data.timestamp||0,this._waitingNextTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._game._restartWithSnapshot(t),this._handleSceneChange(),this.start()},e.prototype._onGameStarted=function(){this._clock.frameTrigger.handleInsert(0,this._eventBuffer,this._eventBuffer.processEvents)},e.prototype._setLoopRenderMode=function(e){if(e!==this._loopRenderMode)switch(this._loopRenderMode=e,e){case o["default"].AfterRawFrame:this._clock.rawFrameTrigger.handle(this,this._renderOnRawFrame);break;case o["default"].None:this._clock.rawFrameTrigger.remove(this,this._renderOnRawFrame);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+e))}},e.prototype._renderOnRawFrame=function(){var e=this._game;e.modified&&e.scenes.length>0&&e.render()},e.prototype._onGameRaiseEvent=function(e){var t=this._eventConverter.toPlaylogEvent(e);this._eventBuffer.onEvent(t)},e.prototype._onGameRaiseTick=function(e){if(this._executionMode===s["default"].Active){if(e)for(var t=0;t<e.length;++t)this._eventBuffer.addEventDirect(this._eventConverter.toPlaylogEvent(e[t]));this._tickController.forceGenerateTick()}},e.prototype._onGameOperationPluginOperated=function(e){var t=this._eventConverter.makePlaylogOperationEvent(e);
this._eventBuffer.onEvent(t)},e.prototype._onPollingTick=function(){var e=+new Date;e-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=e,this._tickBuffer.requestTicks())},e.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.handle(this,this._onPollingTick),this._lastPollingTickTime=+new Date},e.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this,this._onPollingTick)},e}();l.DEFAULT_DELAY_IGNORE_THRESHOLD=6,l.DEFAULT_SKIP_TICKS_AT_ONCE=100,l.DEFAULT_SKIP_THRESHOLD=3e4,l.DEFAULT_JUMP_TRY_THRESHOLD=9e4,l.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,l.DEFAULT_POLLING_TICK_THRESHOLD=1e4,l.DEFAULT_DELAY_IGNORE_THERSHOLD=l.DEFAULT_DELAY_IGNORE_THRESHOLD,i.GameLoop=l},{"./Clock":1,"./EventConverter":3,"./EventIndex":4,"./ExecutionMode":5,"./LoopMode":10,"./LoopRenderMode":11,"./ProfilerClock":14,"./TickController":17,"@akashic/akashic-engine":"@akashic/akashic-engine"}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("@akashic/playlog"),e("@akashic/akashic-engine")),n=(e("./EventIndex"),function(){function e(e,t,i,r){this.joinResolver=t,this.pev=e,0===e[0]&&r?(this.resolved=!1,i.getStorageData(r,this._onGotStorageData.bind(this))):this.resolved=!0}return e.prototype._onGotStorageData=function(e,t){return this.resolved=!0,e?void this.joinResolver.errorTrigger.fire(e):void(this.pev[4]=t)},e}());i.JoinLeaveRequest=n;var o=function(){function e(e){this.errorTrigger=new r.Trigger,e.errorHandler&&this.errorTrigger.handle(e.errorHandlerOwner,e.errorHandler),this._amflow=e.amflow,this._keysForJoin=null,this._requested=[]}return e.prototype.request=function(e){this._requested.push(new n(e,this,this._amflow,this._keysForJoin))},e.prototype.readResolved=function(){var e=this._requested.length;if(0===e||!this._requested[0].resolved)return null;for(var t=[],i=0;e>i;++i){var r=this._requested[i];if(!r.resolved)break;t.push(r.pev)}return this._requested.splice(0,i),t},e.prototype.setRequestValuesForJoin=function(e){this._keysForJoin=e},e}();i.JoinResolver=o},{"./EventIndex":4,"@akashic/akashic-engine":"@akashic/akashic-engine","@akashic/playlog":26}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(e){e[e.Realtime=0]="Realtime",e[e.Replay=1]="Replay",e[e.FrameByFrame=2]="FrameByFrame"}(r||(r={})),i["default"]=r},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;!function(e){e[e.AfterRawFrame=0]="AfterRawFrame",e[e.None=1]="None"}(r||(r={})),i["default"]=r},{}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,n=e("es6-promise"),o=e("@akashic/akashic-engine");!function(e){function t(t){function i(i,s,a){t.loadGameConfiguration(i,function(t,u){if(t)return void a(t,null);try{u=e._resolveConfigurationBasePath(u,null!=s?s:o.PathUtil.resolveDirname(i))}catch(c){return void a(c,null)}if(!u.definitions)return void a(null,u);var h=u.definitions.map(function(e){return"string"==typeof e?r(e):r(e.url,e.basePath)});n.Promise.all(h).then(function(t){return a(null,t.reduce(e._mergeGameConfiguration))})["catch"](function(e){return a(e,null)})})}function r(e,t){return new n.Promise(function(r,n){i(e,t,function(e,t){e?n(e):r(t)})})}return i}function i(e,t){function i(e,t){var i=o.PathUtil.resolvePath(e,t);if(0!==i.indexOf(e))throw o.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: invalid path: "+t);return i}var r=e.assets;if(r instanceof Object)for(var n in r)r.hasOwnProperty(n)&&"path"in r[n]&&(r[n].virtualPath=r[n].virtualPath||r[n].path,r[n].path=i(t,r[n].path));return e.globalScripts&&(e.globalScripts.forEach(function(e){if(r.hasOwnProperty(e))throw o.ExceptionFactory.createAssertionError("PdiUtil._resolveConfigurationBasePath: asset ID already exists: "+e);r[e]={type:/\.json$/i.test(e)?"text":"script",virtualPath:e,path:i(t,e),global:!0}}),delete e.globalScripts),e}function r(t,i){for(var r=Object.keys(i),n=0,o=r.length;o>n;++n){var s=r[n],a=i[s],u=typeof a,c=typeof t[s];if(u===c)switch(typeof a){case"string":case"number":case"boolean":t[s]=a;break;case"object":null==a?t[s]=a:Array.isArray(a)?t[s]=t[s].concat(a):e._mergeObject(t[s],a);break;default:throw new Error("PdiUtil._mergeObject(): unknown type")}else t[s]=a}return t}function s(t,i){return e._mergeObject(t,i)}e.makeLoadConfigurationFunc=t,e._resolveConfigurationBasePath=i,e._mergeObject=r,e._mergeGameConfiguration=s}(r=i.PdiUtil||(i.PdiUtil={}))},{"@akashic/akashic-engine":"@akashic/akashic-engine","es6-promise":27}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("@akashic/playlog"),function(){function e(e){this._game=e.game,this._pointEventMap={}}return e.prototype.pointDown=function(e){var t=this._game.player,i=this._game.findPointSource(e.offset),r=i.point?i.point:e.offset,n=i.target?i.target.id:null;this._pointEventMap[e.identifier]={targetId:n,local:i.local,point:r,start:{x:e.offset.x,y:e.offset.y},prev:{x:e.offset.x,y:e.offset.y}};var o=[33,2,t.id,e.identifier,r.x,r.y,n];return i.local&&o.push(i.local),o},e.prototype.pointMove=function(e){var t=this._game.player,i=this._pointEventMap[e.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,e.offset,r,n);var o=[34,2,t.id,e.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},e.prototype.pointUp=function(e){var t=this._game.player,i=this._pointEventMap[e.identifier];if(!i)return null;var r={x:0,y:0},n={x:0,y:0};this._pointMoveAndUp(i,e.offset,r,n),delete this._pointEventMap[e.identifier];var o=[35,2,t.id,e.identifier,i.point.x,i.point.y,n.x,n.y,r.x,r.y,i.targetId];return i.local&&o.push(i.local),o},e.prototype._pointMoveAndUp=function(e,t,i,r){r.x=t.x-e.start.x,r.y=t.y-e.start.y,i.x=t.x-e.prev.x,i.y=t.y-e.prev.y,e.prev.x=t.x,e.prev.y=t.y},e}());i.PointEventResolver=r},{"@akashic/playlog":26}],14:[function(e,t,i){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(i,"__esModule",{value:!0});var n=e("./Clock"),o=function(e){function t(t){var i=e.call(this,t)||this;return i._profiler=t.profiler,i}return r(t,e),t.prototype._onLooperCall=function(e){if(0>=e)return this._waitTime-this._totalDeltaTime;e>this._deltaTimeBrokenThreshold&&(e=this._waitTime);var t=this._totalDeltaTime;if(t+=e,t<=this._skipFrameWaitTime)return this._totalDeltaTime=t,this._waitTime-t;this._profiler.timeEnd(1),this._profiler.time(1);var i=t<this._waitTimeDoubled?1:t>this._waitTimeMax?this._realMaxFramePerOnce:t/this._waitTime|0,r=i,n={interrupt:!1};for(this._profiler.setValue(0,r-1);r>0&&this.running&&!n.interrupt;)--r,this._profiler.time(2),this.frameTrigger.fire(n),this._profiler.timeEnd(2);return t-=(i-r)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=t,this._profiler.flush(),this._waitTime-t},t}(n.Clock);i.ProfilerClock=o},{"./Clock":1}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=e("./ExecutionMode"),o=function(){function e(e){this.errorTrigger=new r.Trigger,e.errorHandler&&this.errorTrigger.handle(e.errorHandlerOwner,e.errorHandler),this.getStorageFunc=this._getStorage.bind(this),this.putStorageFunc=this._putStorage.bind(this),this.requestValuesForJoinFunc=this._requestValuesForJoin.bind(this),this._game=e.game,this._amflow=e.amflow,this._tickGenerator=e.tickGenerator,this._tickBuffer=e.tickBuffer,this._executionMode=null,this.setExecutionMode(e.executionMode),this._unresolvedLoaders={},this._unresolvedStorages={},this._onStoragePut_bound=this._onStoragePut.bind(this)}return e.prototype.setExecutionMode=function(e){if(this._executionMode!==e){this._executionMode=e;var t=this._tickBuffer,i=this._tickGenerator;e===n["default"].Active?(t.gotStorageTrigger.remove(this,this._onGotStorageOnTick),i.gotStorageTrigger.handle(this,this._onGotStorageOnTick)):(i.gotStorageTrigger.remove(this,this._onGotStorageOnTick),t.gotStorageTrigger.handle(this,this._onGotStorageOnTick))}},e.prototype._onGotStorageOnTick=function(e){var t=e.age,i=e.storageData,r=this._unresolvedLoaders[t];if(!r)return void(this._unresolvedStorages[t]=i);delete this._unresolvedLoaders[t];var n=t,o=i.map(function(e){return e.values});r._onLoaded(o,n)},e.prototype._getStorage=function(e,t,i){var r;null!=i?(r=i,this._tickBuffer.requestTicks(r,1)):this._executionMode===n["default"].Active?r=this._tickGenerator.requestStorageTick(e):(r=this._game.age,this._tickBuffer.requestTicks(r,1));var o=this._unresolvedStorages[r];if(!o)return void(this._unresolvedLoaders[r]=t);delete this._unresolvedStorages[r];var s=r,a=o.map(function(e){return e.values});t._onLoaded(a,s)},e.prototype._putStorage=function(e,t,i){this._executionMode===n["default"].Active&&this._amflow.putStorageData(e,t,i,this._onStoragePut_bound)},e.prototype._requestValuesForJoin=function(e){this._tickGenerator.setRequestValuesForJoin(e)},e.prototype._onStoragePut=function(e){e&&this.errorTrigger.fire(e)},e}();i.StorageResolver=o},{"./ExecutionMode":5,"@akashic/akashic-engine":"@akashic/akashic-engine"}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("@akashic/playlog"),e("@akashic/akashic-engine")),n=(e("./EventIndex"),e("./ExecutionMode")),o=function(){function e(t){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this._amflow=t.amflow,this._prefetchThreshold=t.prefetchThreshold||e.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=t.sizeRequestOnce||e.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=t.executionMode,this._receiving=!1,this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return e.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},e.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},e.prototype.setExecutionMode=function(e){this._executionMode!==e&&(this._dropUntil(this.knownLatestAge+1),this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=e,this._updateAmflowReceiveState())},e.prototype.setCurrentAge=function(e){this._dropUntil(e),this._nextTickTimeCache=null,this.currentAge=e,this._nearestAbsentAge=this._findNearestAbscentAge(e)},e.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},e.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var e=this.currentAge,t=this._tickRanges[0];return e===t.start?(this._nextTickTimeCache=null,++this.currentAge,++t.start,e+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),t.start===t.end&&this._tickRanges.shift(),t.ticks.length>0&&t.ticks[0][0]===e?t.ticks.shift():e):(this._dropUntil(this.currentAge),this.consume())},e.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var e=this.currentAge,t=this._tickRanges[0];if(e===t.start){if(0===t.ticks.length)return null;var i=t.ticks[0];if(i[0]!==e)return null;var r=i[1];if(!r)return null;for(var n=0;n<r.length;++n)if(2===r[n][0])return this._nextTickTimeCache=r[n][3],this._nextTickTimeCache;return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},e.prototype.requestTicks=function(e,t){void 0===e&&(e=this.currentAge),void 0===t&&(t=this._sizeRequestOnce),this._executionMode===n["default"].Passive&&this._amflow.getTickList(e,e+t,this._onTicks_bound)},e.prototype.addTick=function(e){var t=e[0],i=this.currentAge===t&&this._nearestAbsentAge===t;this.knownLatestAge<t&&(this.knownLatestAge=t),e[2]&&this.gotStorageTrigger.fire({age:e[0],storageData:e[2]});for(var r=this._tickRanges.length-1;r>=0;--r){var n=this._tickRanges[r];if(t>=n.start)break}var o=this._tickRanges[r+1];if(0>r)this._tickRanges.unshift(this._createTickRangeFromTick(e));else{var n=this._tickRanges[r];t===n.end?(++n.end,e[1]&&n.ticks.push(e)):t>n.end&&this._tickRanges.splice(r+1,0,this._createTickRangeFromTick(e))}this._nearestAbsentAge===t&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),i&&this.gotNextTickTrigger.fire()},e.prototype.addTickList=function(e){var t=e[0],i=e[1]+1,r=e[2],n=t,o=i;this.knownLatestAge<i-1&&(this.knownLatestAge=i-1);var s=0,a=this._tickRanges.length;for(s=0;a>s;++s){var u=this._tickRanges[s];if(t<u.start)break}var c=s;if(s>0){--s;var h=this._tickRanges[s].end;h>t&&(t=h)}for(;a>s;++s){var l=this._tickRanges[s];if(i<=l.end)break}if(a>s){var f=this._tickRanges[s].start;i>f&&(i=f)}if(t>=i)return{start:t,end:t,ticks:[]};r||(r=[]),n===t&&o===i||(r=r.filter(function(e){var r=e[0];return r>=t&&i>r}));for(var _=0;_<r.length;++_){var p=r[_];p[2]&&this.gotStorageTrigger.fire({age:p[0],storageData:p[2]})}var g={start:t,end:i,ticks:r},d=Math.max(0,s-c);return this._tickRanges.splice(c,d,g),t<=this._nearestAbsentAge&&this._nearestAbsentAge<i&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),g},e.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===n["default"].Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},e.prototype._onTicks=function(e,t){if(e)throw new Error;if(t){var i=this.currentAge===this._nearestAbsentAge,r=this.addTickList(t);i&&r.start<=this.currentAge&&this.currentAge<r.end&&this.gotNextTickTrigger.fire()}},e.prototype._findNearestAbscentAge=function(e){for(var t=0,i=this._tickRanges.length;i>t&&!(e<=this._tickRanges[t].end);++t);for(;i>t;++t){var r=this._tickRanges[t];if(e<r.start)break;e=r.end}return e},e.prototype._dropUntil=function(e){var t;for(t=0;t<this._tickRanges.length&&!(e<this._tickRanges[t].end);++t);if(this._tickRanges=this._tickRanges.slice(t),0!==this._tickRanges.length){var i=this._tickRanges[0];if(!(e<i.start)){for(i.start=e,t=0;t<i.ticks.length&&!(e<=i.ticks[t][0]);++t);i.ticks=i.ticks.slice(t)}}},e.prototype._createTickRangeFromTick=function(e){var t=e[0],i={start:t,end:t+1,ticks:[]};return e[1]&&i.ticks.push(e),i},e}();o.DEFAULT_PREFETCH_THRESHOLD=1800,o.DEFAULT_SIZE_REQUEST_ONCE=9e3,i.TickBuffer=o},{"./EventIndex":4,"./ExecutionMode":5,"@akashic/akashic-engine":"@akashic/akashic-engine","@akashic/playlog":26}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=e("./ExecutionMode"),o=e("./TickBuffer"),s=e("./TickGenerator"),a=e("./StorageResolver"),u=function(){function e(e){this.errorTrigger=new r.Trigger,e.errorHandler&&this.errorTrigger.handle(e.errorHandlerOwner,e.errorHandler),this._amflow=e.amflow,this._clock=e.clock,this._started=!1,this._executionMode=e.executionMode,this._generator=new s.TickGenerator({amflow:e.amflow,eventBuffer:e.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new o.TickBuffer({amflow:e.amflow,executionMode:e.executionMode}),this._storageResolver=new a.StorageResolver({game:e.game,amflow:e.amflow,tickGenerator:this._generator,tickBuffer:this._buffer,executionMode:e.executionMode,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._generator.tickTrigger.handle(this,this._onTickGenerated),this._clock.frameTrigger.handle(this._generator,this._generator.next)}return e.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},e.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},e.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.handle(this,this._stopTriggerOnTick),this._updateGeneratorState()},e.prototype.setNextAge=function(e){this._generator.setNextAge(e)},e.prototype.forceGenerateTick=function(){this._generator.forceNext()},e.prototype.getBuffer=function(){return this._buffer},e.prototype.storageFunc=function(){return{storageGetFunc:this._storageResolver.getStorageFunc,storagePutFunc:this._storageResolver.putStorageFunc,requestValuesForJoinFunc:this._storageResolver.requestValuesForJoinFunc}},e.prototype.setExecutionMode=function(e){this._executionMode!==e&&(this._executionMode=e,this._updateGeneratorState(),this._buffer.setExecutionMode(e),this._storageResolver.setExecutionMode(e))},e.prototype._stopTriggerOnTick=function(){return this.stopTick(),!0},e.prototype._updateGeneratorState=function(){var e=this._started&&this._executionMode===n["default"].Active;this._generator.startStopGenerate(e)},e.prototype._onTickGenerated=function(e){this._amflow.sendTick(e),this._buffer.addTick(e)},e}();i.TickController=u},{"./ExecutionMode":5,"./StorageResolver":15,"./TickBuffer":16,"./TickGenerator":18,"@akashic/akashic-engine":"@akashic/akashic-engine"}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=e("./JoinResolver"),o=function(){function e(e){this.tickTrigger=new r.Trigger,this.gotStorageTrigger=new r.Trigger,this.errorTrigger=new r.Trigger,e.errorHandler&&this.errorTrigger.handle(e.errorHandlerOwner,e.errorHandler),this._amflow=e.amflow,this._eventBuffer=e.eventBuffer,this._joinResolver=new n.JoinResolver({amflow:e.amflow,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._nextAge=0,this._storageDataForNext=null,this._generatingTick=!1,this._waitingStorage=!1,this._onGotStorageData_bound=this._onGotStorageData.bind(this)}return e.prototype.next=function(){if(this._generatingTick&&!this._waitingStorage){var e=this._eventBuffer.readJoinLeaves();if(e)for(var t=0;t<e.length;++t)this._joinResolver.request(e[t]);var i=this._eventBuffer.readEvents(),r=this._joinResolver.readResolved();r&&(i?i.push.apply(i,r):i=r);var n=this._storageDataForNext;this._storageDataForNext=null,this.tickTrigger.fire([this._nextAge++,i,n])}},e.prototype.forceNext=function(){if(this._waitingStorage)return void this.errorTrigger.fire(new Error("TickGenerator#forceNext(): cannot generate tick while waiting storage."));var e=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=e},e.prototype.startStopGenerate=function(e){this._generatingTick=e},e.prototype.startTick=function(){this._generatingTick=!0},e.prototype.stopTick=function(){this._generatingTick=!1},e.prototype.setNextAge=function(e){return this._waitingStorage?void this.errorTrigger.fire(new Error("TickGenerator#setNextAge(): cannot change the next age while waiting storage.")):void(this._nextAge=e)},e.prototype.requestStorageTick=function(e){if(this._waitingStorage){var t=r.ExceptionFactory.createAssertionError("TickGenerator#requestStorageTick(): Unsupported: multiple storage request");return this.errorTrigger.fire(t),-1}return this._waitingStorage=!0,this._amflow.getStorageData(e,this._onGotStorageData_bound),this._nextAge},e.prototype.setRequestValuesForJoin=function(e){this._joinResolver.setRequestValuesForJoin(e)},e.prototype._onGotStorageData=function(e,t){return this._waitingStorage=!1,e?void this.errorTrigger.fire(e):(this._storageDataForNext=t,void this.gotStorageTrigger.fire({age:this._nextAge,storageData:t}))},e}();i.TickGenerator=o},{"./JoinResolver":9,"@akashic/akashic-engine":"@akashic/akashic-engine"}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("../EventIndex"),function(){function e(e){this._playId=e.playId,this._putStorageDataSyncFunc=e.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=e.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,e.startPoints?(this._tickList=e.tickList,this._startPoints=e.startPoints):this._startPoints=[]}return e.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},e.prototype.open=function(e,t){var i=this;setTimeout(function(){return e!==i._playId?void t(new Error("MemoryAmflowClient#open: unknown playId")):void t()},0)},e.prototype.close=function(e){setTimeout(function(){e()},0)},e.prototype.authenticate=function(t,i){setTimeout(function(){switch(t){case e.TOKEN_ACTIVE:i(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case e.TOKEN_PASSIVE:i(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:i(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}},0)},e.prototype.sendTick=function(e){if(this._tickList){if(this._tickList[0]<=e[0]&&e[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=e[0]}else this._tickList=[e[0],e[0],[]];(e[1]||e[2])&&this._tickList[2].push(e),this._tickHandlers.forEach(function(t){return t(e)})},e.prototype.onTick=function(e){this._tickHandlers.push(e)},e.prototype.offTick=function(e){this._tickHandlers=this._tickHandlers.filter(function(t){return t!==e})},e.prototype.sendEvent=function(e){return 0===this._eventHandlers.length?void this._events.push(e):void this._eventHandlers.forEach(function(t){return t(e)})},e.prototype.onEvent=function(e){var t=this;this._eventHandlers.push(e),this._events.length>0&&(this._events.forEach(function(e){t._eventHandlers.forEach(function(t){return t(e)})}),this._events=[])},e.prototype.offEvent=function(e){this._eventHandlers=this._eventHandlers.filter(function(t){return t!==e})},e.prototype.getTickList=function(e,t,i){if(!this._tickList)return void setTimeout(function(){return i(null,null)},0);e=Math.max(e,this._tickList[0]),t=Math.min(t,this._tickList[1]);var r=this._tickList[2].filter(function(i){var r=i[0];return r>=e&&t>=r}),n=[e,t,r];setTimeout(function(){return i(null,n)},0)},e.prototype.putStartPoint=function(e,t){var i=this;setTimeout(function(){i._startPoints.push(e),t(null)},0)},e.prototype.getStartPoint=function(e,t){var i=this;setTimeout(function(){if(!i._startPoints||0===i._startPoints.length)return void t(new Error("no startpoint"));var r=0;if(null!=e.frame)for(var n=i._startPoints[0].frame,o=1;o<i._startPoints.length;++o){var s=i._startPoints[o].frame;s<=e.frame&&s>n&&(n=s,r=o)}else for(var a=i._startPoints[0].timestamp,o=1;o<i._startPoints.length;++o){var u=i._startPoints[o].timestamp;u<=e.timestamp&&u>a&&(a=u,r=o)}t(null,i._startPoints[r])},0)},e.prototype.putStorageData=function(e,t,i,r){var n=this;setTimeout(function(){try{n._putStorageDataSyncFunc(e,t,i),r(null)}catch(o){r(o)}},0)},e.prototype.getStorageData=function(e,t){var i=this;setTimeout(function(){try{var r=i._getStorageDataSyncFunc(e);t(null,r)}catch(n){t(n)}},0)},e.prototype.dropAfter=function(e){if(this._tickList){var t=this._tickList[0],i=this._tickList[1];t>=e?(this._tickList=null,this._startPoints=[]):i>=e&&(this._tickList[1]=e-1,this._tickList[2]=this._tickList[2].filter(function(i){var r=i[0];return r>=t&&e-1>=r}),this._startPoints=this._startPoints.filter(function(t){return t.frame<e}))}},e}());r.TOKEN_ACTIVE="mamfc-token:active",r.TOKEN_PASSIVE="mamfc-token:passive",i.MemoryAmflowClient=r},{"../EventIndex":4}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=(e("../EventIndex"),function(){function e(e){this._amflow=e.amflow,this._tickList=e.tickList,this._startPoints=e.startPoints}return e.prototype.dropAfter=function(e){if(this._tickList){var t=this._tickList[0],i=this._tickList[1],r=this._tickList[2];t>=e?(this._tickList=null,this._startPoints=[]):i>=e&&(this._tickList[1]=e-1,this._tickList[2]=this._sliceTicks(r,i,e-1),this._startPoints=this._startPoints.filter(function(t){return t.frame<e}))}},e.prototype.open=function(e,t){this._amflow.open(e,t)},e.prototype.close=function(e){this._amflow.close(e)},e.prototype.authenticate=function(e,t){this._amflow.authenticate(e,t)},e.prototype.sendTick=function(e){this._amflow.sendTick(e)},e.prototype.onTick=function(e){this._amflow.onTick(e)},e.prototype.offTick=function(e){this._amflow.offTick(e)},e.prototype.sendEvent=function(e){this._amflow.sendEvent(e)},e.prototype.onEvent=function(e){this._amflow.onEvent(e)},e.prototype.offEvent=function(e){this._amflow.offEvent(e)},e.prototype.getTickList=function(e,t,i){var r=this;if(!this._tickList)return void this._amflow.getTickList(e,t,i);var n=this._tickList[0],o=this._tickList[1],s=this._tickList[2],a=e>=n&&o>=e,u=t>=n&&o>=t;a&&u?setTimeout(function(){i(null,[e,t,r._sliceTicks(s,e,t)])},0):this._amflow.getTickList(e,t,function(c,h){if(c)return void i(c);if(h)if(a||u)if(a){var l=r._sliceTicks(s,e,t).concat(h[2]||[]);i(null,[e,h[1],l])}else{var l=(h[2]||[]).concat(r._sliceTicks(s,e,t));i(null,[h[0],t,l])}else if(n>t||e>o)i(null,h);else{var l=h[2];if(l){var f=r._sliceTicks(l,e,n-1),_=r._sliceTicks(l,o+1,t);l=f.concat(s,_)}else l=s;i(null,[e,t,l])}else a||u?a?i(null,[e,o,r._sliceTicks(s,e,t)]):i(null,[n,t,r._sliceTicks(s,e,t)]):n>t||e>o?i(null,h):i(null,[n,o,r._sliceTicks(s,e,t)])})},e.prototype.putStartPoint=function(e,t){this._amflow.putStartPoint(e,t)},e.prototype.getStartPoint=function(e,t){var i=this,r=0;if(this._startPoints.length>0)if(null!=e.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=e.frame&&s>n&&(n=s,r=o)}else for(var a=this._startPoints[0].timestamp,o=1;o<this._startPoints.length;++o){var u=this._startPoints[o].timestamp;u<=e.timestamp&&u>a&&(a=u,r=o)}var c=this._tickList?this._tickList[1]:-1;e.frame>c?this._amflow.getStartPoint(e,function(e,n){return e?void t(e):void(c<n.frame?t(null,n):t(null,i._startPoints[r]))}):setTimeout(function(){t(null,i._startPoints[r])},0)},e.prototype.putStorageData=function(e,t,i,r){this._amflow.putStorageData(e,t,i,r)},e.prototype.getStorageData=function(e,t){this._amflow.getStorageData(e,t)},e.prototype._sliceTicks=function(e,t,i){return e.filter(function(e){var r=e[0];return r>=t&&i>=r})},e}());i.ReplayAmflowProxy=r},{"../EventIndex":4}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("@akashic/akashic-engine"),n=function(){function e(t){this._interval=null!=t.interval?t.interval:e.DEFAULT_INTERVAL,null!=t.limit?this._limit=t.limit>=e.DEFAULT_LIMIT?t.limit:e.DEFAULT_LIMIT:this._limit=e.DEFAULT_LIMIT,this._calculateProfilerValueTrigger=new r.Trigger,t.getValueHandler&&this._calculateProfilerValueTrigger.handle(t.getValueHandlerOwner,t.getValueHandler),this._reset()}return e.prototype.time=function(e){this._beforeTimes[e]=this._getCurrentTime()},e.prototype.timeEnd=function(e){var t=this._getCurrentTime(),i=null!=this._beforeTimes[e]?t-this._beforeTimes[e]:0;this._values[e].push({time:t,value:i})},e.prototype.flush=function(){var t=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=t),this._beforeFlushTime+this._interval<t&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=t),this._values[1].length>this._limit)for(var i in this._values)this._values.hasOwnProperty(i)&&(this._values[i]=this._values[i].slice(-e.BACKUP_MARGIN))},e.prototype.setValue=function(e,t){this._values[e].push({time:this._getCurrentTime(),value:t})},e.prototype.getProfilerValue=function(e){var t=this._calculateProfilerValue(1,e);return{skippedFrameCount:this._calculateProfilerValue(0,e),rawFrameInterval:t,framePerSecond:{ave:1e3/t.ave,max:1e3/t.min,min:1e3/t.max},frameTime:this._calculateProfilerValue(2,e),renderingTime:this._calculateProfilerValue(3,e)}},e.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},e.prototype._calculateProfilerValue=function(e,t){for(var i=this._getCurrentTime()-t,r=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[e].length-1;a>=0&&!(n>0&&this._values[e][a].time<i);--a){var u=this._values[e][a].value;u>o&&(o=u),s>u&&(s=u),r+=u,++n}return{ave:r/n,max:o,min:s}},e.prototype._getCurrentTime=function(){return+new Date},e}();n.DEFAULT_INTERVAL=1e3,n.DEFAULT_LIMIT=1e3,n.BACKUP_MARGIN=100,i.SimpleProfiler=n},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],23:[function(e,t,i){},{}],24:[function(e,t,i){arguments[4][23][0].apply(i,arguments)},{dup:23}],25:[function(e,t,i){arguments[4][23][0].apply(i,arguments)},{dup:23}],26:[function(e,t,i){function r(e){for(var t in e)i.hasOwnProperty(t)||(i[t]=e[t])}r(e("./Tick")),r(e("./Event")),r(e("./StorageData"))},{"./Event":23,"./StorageData":24,"./Tick":25}],27:[function(e,t,i){(function(r,n){!function(e,r){"object"==typeof i&&"undefined"!=typeof t?t.exports=r():"function"==typeof define&&define.amd?define(r):e.ES6Promise=r()}(this,function(){"use strict";function t(e){return"function"==typeof e||"object"==typeof e&&null!==e}function i(e){return"function"==typeof e}function o(e){Y=e}function s(e){Z=e}function a(){return function(){return r.nextTick(f)}}function u(){return function(){z(f)}}function c(){var e=0,t=new $(f),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function h(){var e=new MessageChannel;return e.port1.onmessage=f,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(f,1)}}function f(){for(var e=0;W>e;e+=2){var t=ie[e],i=ie[e+1];t(i),ie[e]=void 0,ie[e+1]=void 0}W=0}function _(){try{var t=e,i=t("vertx");return z=i.runOnLoop||i.runOnContext,u()}catch(r){return l()}}function p(e,t){var i=arguments,r=this,n=new this.constructor(d);void 0===n[ne]&&C(n);var o=r._state;return o?!function(){var e=i[o-1];Z(function(){return F(o,n,e,r._result)})}():x(r,n,e,t),n}function g(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(d);return A(i,e),i}function d(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function T(e){try{return e.then}catch(t){return ue.error=t,ue}}function k(e,t,i,r){try{e.call(t,i,r)}catch(n){return n}}function y(e,t,i){Z(function(e){var r=!1,n=k(i,t,function(i){r||(r=!0,t!==i?A(e,i):b(e,i))},function(t){r||(r=!0,L(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&n&&(r=!0,L(e,n))},e)}function w(e,t){t._state===se?b(e,t._result):t._state===ae?L(e,t._result):x(t,void 0,function(t){return A(e,t)},function(t){return L(e,t)})}function E(e,t,r){t.constructor===e.constructor&&r===p&&t.constructor.resolve===g?w(e,t):r===ue?L(e,ue.error):void 0===r?b(e,t):i(r)?y(e,t,r):b(e,t)}function A(e,i){e===i?L(e,v()):t(i)?E(e,i,T(i)):b(e,i)}function P(e){e._onerror&&e._onerror(e._result),S(e)}function b(e,t){e._state===oe&&(e._result=t,e._state=se,0!==e._subscribers.length&&Z(S,e))}function L(e,t){e._state===oe&&(e._state=ae,e._result=t,Z(P,e))}function x(e,t,i,r){var n=e._subscribers,o=n.length;e._onerror=null,n[o]=t,n[o+se]=i,n[o+ae]=r,0===o&&e._state&&Z(S,e)}function S(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var r=void 0,n=void 0,o=e._result,s=0;s<t.length;s+=3)r=t[s],n=t[s+i],r?F(i,r,n,o):n(o);e._subscribers.length=0}}function M(){this.error=null}function R(e,t){try{return e(t)}catch(i){return ce.error=i,ce}}function F(e,t,r,n){var o=i(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if(s=R(r,n),s===ce?(c=!0,a=s.error,s=null):u=!0,
t===s)return void L(t,m())}else s=n,u=!0;t._state!==oe||(o&&u?A(t,s):c?L(t,a):e===se?b(t,s):e===ae&&L(t,s))}function O(e,t){try{t(function(t){A(e,t)},function(t){L(e,t)})}catch(i){L(e,i)}}function D(){return he++}function C(e){e[ne]=he++,e._state=void 0,e._result=void 0,e._subscribers=[]}function G(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[ne]||C(this.promise),K(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):L(this.promise,B())}function B(){return new Error("Array Methods must be provided an Array")}function I(e){return new G(this,e).promise}function N(e){var t=this;return new t(K(e)?function(i,r){for(var n=e.length,o=0;n>o;o++)t.resolve(e[o]).then(i,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function j(e){var t=this,i=new t(d);return L(i,e),i}function H(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function q(e){this[ne]=D(),this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&H(),this instanceof q?O(this,e):U())}function V(){var e=void 0;if("undefined"!=typeof n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=e.Promise;if(i){var r=null;try{r=Object.prototype.toString.call(i.resolve())}catch(t){}if("[object Promise]"===r&&!i.cast)return}e.Promise=q}var J=void 0;J=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var K=J,W=0,z=void 0,Y=void 0,Z=function(e,t){ie[W]=e,ie[W+1]=t,W+=2,2===W&&(Y?Y(f):re())},X="undefined"!=typeof window?window:void 0,Q=X||{},$=Q.MutationObserver||Q.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof r&&"[object process]"==={}.toString.call(r),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ie=new Array(1e3),re=void 0;re=ee?a():$?c():te?h():void 0===X&&"function"==typeof e?_():l();var ne=Math.random().toString(36).substring(16),oe=void 0,se=1,ae=2,ue=new M,ce=new M,he=0;return G.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===oe&&e>i;i++)this._eachEntry(t[i],i)},G.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,r=i.resolve;if(r===g){var n=T(e);if(n===p&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(i===q){var o=new i(d);E(o,e,n),this._willSettleAt(o,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},G.prototype._settledAt=function(e,t,i){var r=this.promise;r._state===oe&&(this._remaining--,e===ae?L(r,i):this._result[t]=i),0===this._remaining&&b(r,this._result)},G.prototype._willSettleAt=function(e,t){var i=this;x(e,void 0,function(e){return i._settledAt(se,t,e)},function(e){return i._settledAt(ae,t,e)})},q.all=I,q.race=N,q.resolve=g,q.reject=j,q._setScheduler=o,q._setAsap=s,q._asap=Z,q.prototype={constructor:q,then:p,"catch":function(e){return this.then(null,e)}},V(),q.polyfill=V,q.Promise=q,q})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:28}],28:[function(e,t,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){d&&p&&(d=!1,p.length?g=p.concat(g):v=-1,g.length&&u())}function u(){if(!d){var e=o(a);d=!0;for(var t=g.length;t;){for(p=g,g=[];++v<t;)p&&p[v].run();v=-1,t=g.length}p=null,d=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function h(){}var l,f,_=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var p,g=[],d=!1,v=-1;_.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];g.push(new c(e,t)),1!==g.length||d||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},_.title="browser",_.browser=!0,_.env={},_.argv=[],_.version="",_.versions={},_.on=h,_.addListener=h,_.once=h,_.off=h,_.removeListener=h,_.removeAllListeners=h,_.emit=h,_.binding=function(e){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(e){throw new Error("process.chdir is not supported")},_.umask=function(){return 0}},{}],"@akashic/game-driver":[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./EventIndex");i.EventIndex=r;var n=e("./LoopMode");i.LoopMode=n["default"];var o=e("./LoopRenderMode");i.LoopRenderMode=o["default"];var s=e("./ExecutionMode");i.ExecutionMode=s["default"];var a=e("./GameDriver");i.GameDriver=a.GameDriver;var u=e("./Game");i.Game=u.Game;var c=e("./auxiliary/ReplayAmflowProxy");i.ReplayAmflowProxy=c.ReplayAmflowProxy;var h=e("./auxiliary/MemoryAmflowClient");i.MemoryAmflowClient=h.MemoryAmflowClient;var l=e("./auxiliary/SimpleProfiler");i.SimpleProfiler=l.SimpleProfiler},{"./EventIndex":4,"./ExecutionMode":5,"./Game":6,"./GameDriver":7,"./LoopMode":10,"./LoopRenderMode":11,"./auxiliary/MemoryAmflowClient":19,"./auxiliary/ReplayAmflowProxy":20,"./auxiliary/SimpleProfiler":21}]},{},[]);	require=function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[a]={exports:{}};e[a][0].call(h.exports,function(t){var r=e[a][1][t];return i(r?r:t)},h,h.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({"@akashic/pdi-browser":[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./Platform");r.Platform=n.Platform;var i=t("./ResourceFactory");r.ResourceFactory=i.ResourceFactory;var o=t("@akashic/akashic-engine");r.g=o;var a=t("./plugin/AudioPluginRegistry");r.AudioPluginRegistry=a.AudioPluginRegistry;var s=t("./plugin/AudioPluginManager");r.AudioPluginManager=s.AudioPluginManager;var c=t("./plugin/HTMLAudioPlugin/HTMLAudioPlugin");r.HTMLAudioPlugin=c.HTMLAudioPlugin;var u=t("./plugin/WebAudioPlugin/WebAudioPlugin");r.WebAudioPlugin=u.WebAudioPlugin},{"./Platform":3,"./ResourceFactory":5,"./plugin/AudioPluginManager":34,"./plugin/AudioPluginRegistry":35,"./plugin/HTMLAudioPlugin/HTMLAudioPlugin":38,"./plugin/WebAudioPlugin/WebAudioPlugin":42,"@akashic/akashic-engine":"@akashic/akashic-engine"}],1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),i=t("./canvas/RenderingHelper"),o=t("./InputHandlerLayer"),a=function(){function t(){this.container=null,this.surface=null,this.inputHandlerLayer=null,this.rootView=null,this.defaultSize=null,this.useResizeForScaling=!1,this.pointEventTrigger=new n.Trigger,this._rendererReq=null,this._disablePreventDefault=!1}return t.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._disablePreventDefault=!!t.disablePreventDefault,this._loadView()},t.prototype.setRootView=function(t){var e=this;t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.handle(function(t){e.pointEventTrigger.fire(t)}))},t.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},t.prototype.fitToSize=function(t,e){var r=Math.min(t.width/this._rendererReq.primarySurfaceWidth,t.height/this._rendererReq.primarySurfaceHeight),n={width:Math.floor(this._rendererReq.primarySurfaceWidth*r),height:Math.floor(this._rendererReq.primarySurfaceHeight*r)},i={x:Math.floor((t.width-n.width)/2),y:Math.floor((t.height-n.height)/2)};this.changeScale(r,r),e&&this.inputHandlerLayer.setOffset(i)},t.prototype.revertSize=function(){this.fitToSize(this.defaultSize)},t.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changeCanvasSize(this.defaultSize.width*t,this.defaultSize.height*e):this.surface.changeCanvasScale(t,e,this.defaultSize),this.inputHandlerLayer._inputHandler.setScale(t,e)},t.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},t.prototype._loadView=function(){this.container=document.createDocumentFragment(),this.inputHandlerLayer=new o.InputHandlerLayer({width:this._rendererReq.primarySurfaceWidth,height:this._rendererReq.primarySurfaceHeight,disablePreventDefault:this._disablePreventDefault}),this.surface=i.RenderingHelper.createPrimarySurface(this._rendererReq.primarySurfaceWidth,this._rendererReq.primarySurfaceHeight,this._rendererReq.rendererCandidates),this.surface.setParentElement(this.inputHandlerLayer.view),this.container.appendChild(this.inputHandlerLayer.view),this.defaultSize={width:this.surface.width,height:this.surface.height}},t}();r.ContainerController=a},{"./InputHandlerLayer":2,"./canvas/RenderingHelper":16,"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),i=t("./handler/MouseHandler"),o=t("./handler/TouchHandler"),a=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new n.Trigger,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.enablePointerEvent=function(){var t=this;o.TouchHandler.isSupported()?this._inputHandler=new o.TouchHandler(this.view,this._disablePreventDefault):this._inputHandler=new i.MouseHandler(this.view,this._disablePreventDefault),this._inputHandler.pointTrigger.handle(function(e){t.pointEventTrigger.fire(e)}),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){this._inputHandler.stop()},t.prototype.setOffset=function(t){var e="position:relative; left:"+t.x+"px; top:"+t.y+"px";this._inputHandler.inputView.setAttribute("style",e),this._inputHandler.setOffset(t)},t.prototype.notifyViewMoved=function(){this._inputHandler.notifyViewMoved()},t.prototype._createInputView=function(t,e){var r=document.createElement("div");return r.setAttribute("tabindex","1"),r.className="input-handler",r.setAttribute("style","display:inline-block; outline:none;"),r.style.width=t+"px",r.style.height=e+"px",r},t}();r.InputHandlerLayer=a},{"./handler/MouseHandler":32,"./handler/TouchHandler":33,"@akashic/akashic-engine":"@akashic/akashic-engine"}],3:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./RafLooper"),i=t("./ResourceFactory"),o=t("./ContainerController"),a=t("./plugin/AudioPluginManager"),s=t("./plugin/AudioPluginRegistry"),c=t("./asset/XHRTextAsset"),u=function(){function t(t){this.containerView=t.containerView,this.containerController=new o.ContainerController,this.audioPluginManager=new a.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(s.AudioPluginRegistry.getRegisteredAudioPlugins()),this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new i.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this}),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return t.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll(this._platformEventHandler),this.containerController.pointEventTrigger.handle(t,t.onPointEvent)),this._platformEventHandler=t},t.prototype.loadGameConfiguration=function(t,e){var r=new c.XHRTextAsset("(game.json)",t);r._load({_onAssetLoad:function(t){e(null,JSON.parse(r.data))},_onAssetError:function(t,r){e(r,null)}})},t.prototype.getResourceFactory=function(){return this._resourceFactory},t.prototype.setRendererRequirement=function(t){if(!t)return void(this.containerController&&this.containerController.unloadView());this._rendererReq=t,this._resourceFactory._rendererCandidates=this._rendererReq.rendererCandidates,this.containerController.initialize({rendererRequirement:this._rendererReq,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.handle(this._platformEventHandler,this._platformEventHandler.onPointEvent);var e=this.containerView.parentElement;this.defaultViewMargin=e.style.margin,this.defaultViewPadding=e.style.padding,this.defaultViewOverflow=e.style.overflow},t.prototype.getPrimarySurface=function(){return this.containerController.surface},t.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},t.prototype.createLooper=function(t){return new n.RafLooper(t)},t.prototype.sendToExternal=function(t,e){},t.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},t.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},t.prototype.fitToWindow=function(t){if(this.containerController){var e=this.containerView.parentElement;e.style.margin="0px",e.style.padding="0px",e.style.overflow="hidden";var r={width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};this.containerController.fitToSize(r,t)}},t.prototype.revertViewSize=function(){var t=this.containerView.parentElement;t.style.margin=this.defaultViewMargin,t.style.padding=this.defaultViewPadding,t.style.overflow=this.defaultViewOverflow,this.containerController.revertSize()},t.prototype.notifyViewMoved=function(){this.containerController.inputHandlerLayer.notifyViewMoved()},t}();r.Platform=u},{"./ContainerController":1,"./RafLooper":4,"./ResourceFactory":5,"./asset/XHRTextAsset":11,"./plugin/AudioPluginManager":34,"./plugin/AudioPluginRegistry":35}],4:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t){this._fun=t,this._timerId=void 0,this._prev=0}return t.prototype.start=function(){var t=this,e=function(r){t._timerId=requestAnimationFrame(e),t._fun(r-t._prev),t._prev=r},r=function(r){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=r};this._timerId=requestAnimationFrame(r)},t.prototype.stop=function(){cancelAnimationFrame(this._timerId),this._timerId=void 0,this._prev=0},t}();r.RafLooper=n},{}],5:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./asset/HTMLImageAsset"),a=t("./asset/HTMLVideoAsset"),s=t("./asset/XHRTextAsset"),c=t("./asset/XHRScriptAsset"),u=t("./canvas/RenderingHelper"),h=t("./canvas/GlyphFactory"),p=t("./canvas/SurfaceAtlas"),l=function(t){function e(e){var r=t.call(this)||this;return r._audioPluginManager=e.audioPluginManager,r._platform=e.platform,r}return n(e,t),e.prototype.createAudioAsset=function(t,e,r,n,i,o){var a=this._audioPluginManager.getActivePlugin();return a.createAsset(t,e,r,n,i,o)},e.prototype.createAudioPlayer=function(t){var e=this._audioPluginManager.getActivePlugin();return e.createPlayer(t)},e.prototype.createImageAsset=function(t,e,r,n){return new o.HTMLImageAsset(t,e,r,n)},e.prototype.createVideoAsset=function(t,e,r,n,i,o,s){return new a.HTMLVideoAsset(t,e,r,n,i,o,s)},e.prototype.createTextAsset=function(t,e){return new s.XHRTextAsset(t,e)},e.prototype.createScriptAsset=function(t,e){return new c.XHRScriptAsset(t,e)},e.prototype.createSurface=function(t,e){return u.RenderingHelper.createBackSurface(t,e,this._platform,this._rendererCandidates)},e.prototype.createGlyphFactory=function(t,e,r,n,i,o,a,s){return new h.GlyphFactory(t,e,r,u.RenderingHelper.usedWebGL(this._rendererCandidates),n,i,o,a,s)},e.prototype.createSurfaceAtlas=function(t,e){return new p.SurfaceAtlas(this.createSurface(t,e))},e}(i.ResourceFactory);r.ResourceFactory=l},{"./asset/HTMLImageAsset":7,"./asset/HTMLVideoAsset":8,"./asset/XHRScriptAsset":10,"./asset/XHRTextAsset":11,"./canvas/GlyphFactory":15,"./canvas/RenderingHelper":16,"./canvas/SurfaceAtlas":19,"@akashic/akashic-engine":"@akashic/akashic-engine"}],6:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n;!function(t){function e(){return"pointerEnabled"in window.navigator}function r(){return"msPointerEnabled"in window.navigator}function n(){return"ontouchstart"in window}t.pointerEnabled=e,t.msPointerEnabled=r,t.touchEnabled=n}(n=r.RuntimeInfo||(r.RuntimeInfo={}))},{}],7:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=function(t){function e(e,r,n){return t.call(this,e,r,n)||this}return n(e,t),e.prototype.renderer=function(){throw i.ExceptionFactory.createAssertionError("ImageAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(i.Surface);r.ImageAssetSurface=o;var a=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.data=void 0,o._surface=void 0,o}return n(e,t),e.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._load=function(t){var e=this,r=new Image;r.onerror=function(){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},r.onload=function(){e.data=r,t._onAssetLoad(e)},r.src=this.path},e.prototype.asSurface=function(){if(!this.data)throw i.ExceptionFactory.createAssertionError("ImageAssetImpl#asSurface: not yet loaded.");return this._surface?this._surface:(this._surface=new o(this.width,this.height,this.data),this._surface)},e}(i.ImageAsset);r.HTMLImageAsset=a},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],8:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./HTMLVideoPlayer"),a=function(t){function e(e,r,n){return t.call(this,e,r,n,!0)||this}return n(e,t),e.prototype.renderer=function(){throw i.ExceptionFactory.createAssertionError("VideoAssetSurface cannot be rendered.")},e.prototype.isPlaying=function(){return!1},e}(i.Surface),s=function(t){function e(e,r,n,i,s,c,u){var h=t.call(this,e,r,n,i,s,c,u)||this;return h._player=new o.HTMLVideoPlayer,h._surface=new a(n,i,null),h}return n(e,t),e.prototype.inUse=function(){return!1},e.prototype._load=function(t){var e=this;setTimeout(function(){t._onAssetLoad(e)},0)},e.prototype.getPlayer=function(){return this._player},e.prototype.asSurface=function(){return this._surface},e}(i.VideoAsset);r.HTMLVideoAsset=s},{"./HTMLVideoPlayer":9,"@akashic/akashic-engine":"@akashic/akashic-engine"}],9:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=function(t){function e(e){var r=t.call(this,e)||this;return r.isDummy=!0,r}return n(e,t),e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}(i.VideoPlayer);r.HTMLVideoPlayer=o},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],10:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),a=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.script=void 0,n}return n(e,t),e.prototype._load=function(t){var e=this,r=new o.XHRLoader;r.get(this.path,function(r,n){return r?void t._onAssetError(e,r):(e.script=n+"\n",void t._onAssetLoad(e))})},e.prototype.execute=function(t){var e=this._wrap();return e(t),t.module.exports},e.prototype._wrap=function(){var t=new Function("g",e.PRE_SCRIPT+this.script+e.POST_SCRIPT);return t},e}(i.ScriptAsset);a.PRE_SCRIPT="(function(exports, require, module, __filename, __dirname) {",a.POST_SCRIPT="})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);",r.XHRScriptAsset=a},{"../utils/XHRLoader":43,"@akashic/akashic-engine":"@akashic/akashic-engine"}],11:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("../utils/XHRLoader"),a=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.data=void 0,n}return n(e,t),e.prototype._load=function(t){var e=this,r=new o.XHRLoader;r.get(this.path,function(r,n){return r?void t._onAssetError(e,r):(e.data=n,void t._onAssetLoad(e))})},e}(i.TextAsset);r.XHRTextAsset=a},{"../utils/XHRLoader":43,"@akashic/akashic-engine":"@akashic/akashic-engine"}],12:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t){t?this.matrix=new Float32Array(t.matrix):this.matrix=new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var r=this.matrix;return r[0]*=t,r[1]*=t,r[2]*=e,r[3]*=e,this},t.prototype.translate=function(t,e){var r=this.matrix;return r[4]+=r[0]*t+r[2]*e,r[5]+=r[1]*t+r[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,r=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],i=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],a=t[4]*e[0]+t[5]*e[2]+e[4],s=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=r,e[1]=n,e[2]=i,e[3]=o,e[4]=a,e[5]=s,this},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();r.AffineTransformer=n},{}],13:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./Context2DRenderer"),a=function(t){function e(e,r,n){var i=this,o=document.createElement("canvas");return i=t.call(this,e,r,o)||this,o.width=e,o.height=r,i._originalWidth=e,i._originalHeight=r,i.canvas=o,i._rendererCandidates=n,i._renderer=void 0,i._imageDataCache=void 0,i}return n(e,t),e.prototype.context=function(){return this.canvas.getContext("2d")},e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.Context2DRenderer(this)),this._renderer},e.prototype.destroy=function(){this._drawable=void 0,this._imageDataCache=void 0,t.prototype.destroy.call(this)},e.prototype.setParentElement=function(t){t.appendChild(this.canvas)},e.prototype.changeCanvasSize=function(t,e){var r=this.context();this.canvas.width=t,this.canvas.height=e,r.scale(t/this._originalWidth,e/this._originalHeight),this.width=t,this.height=e},e.prototype.changeCanvasScale=function(t,e,r){var n=this.canvas.style;"transform"in n?(n.transformOrigin="0 0",n.transform="scale("+t+","+e+")"):"webkitTransform"in n?(n.webkitTransformOrigin="0 0",n.webkitTransform="scale("+t+","+e+")"):(n.width=Math.floor(r.width*t)+"px",n.height=Math.floor(r.height*e)+"px")},e}(i.Surface);r.CanvasSurface=a},{"./Context2DRenderer":14,"@akashic/akashic-engine":"@akashic/akashic-engine"}],14:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./RenderingHelper"),a=function(t){function e(e){var r=t.call(this)||this;return r.surface=e,r.context=r.surface.context(),r}return n(e,t),e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.begin=function(){},e.prototype.end=function(){this.surface._drawable._texture=void 0},e.prototype.drawImage=function(t,e,r,n,i,o,a){this.context.drawImage(t._drawable,e,r,n,i,o,a,n,i)},e.prototype.drawSprites=function(t,e,r,n,i,o,a,s){for(var c=0;s>c;++c)this.drawImage(t,e[c],r[c],n[c],i[c],o[c],a[c])},e.prototype.drawSystemText=function(t,e,r,n,i,a,s,c,u,h,p,l){o.RenderingHelper.drawSystemTextByContext2D(this.context,t,e,r,n,i,a,s,c,u,h,p,l)},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform.apply(this.context,t)},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,r,n,i){var o=this.context.fillStyle;this.context.fillStyle=i,this.context.fillRect(t,e,r,n),this.context.fillStyle=o},e.prototype.setCompositeOperation=function(t){this.context.globalCompositeOperation=o.RenderingHelper.toTextFromCompositeOperation(t)},e}(i.Renderer);r.Context2DRenderer=a},{"./RenderingHelper":16,"@akashic/akashic-engine":"@akashic/akashic-engine"}],15:[function(t,e,r){"use strict";function n(t,e,r,n,i,o,a,s,c,u,l,d,_){var g=e<f._environmentMinimumFontSize?e/f._environmentMinimumFontSize:1,y=Math.ceil((e+2*i)*g),m=Math.ceil((e+2*o)*g),v=new p.CanvasSurface(y,m),E=v.canvas,x=E.getContext("2d"),A=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t),T=_===h.FontWeight.Bold?"bold ":"";x.save(),x.font=T+e+"px "+r,x.textAlign="left",x.textBaseline="alphabetic",x.lineJoin="bevel",1!==g&&x.scale(g,g),u>0&&(x.lineWidth=u,x.strokeStyle=l,x.strokeText(A,i,o+n)),d||(x.fillStyle=c,x.fillText(A,i,o+n));var R=x.measureText(A).width;x.restore();var w={surface:v,advanceWidth:R,imageData:a?x.getImageData(0,0,E.width,E.height):void 0};return s&&(v._imageDataCache=w.imageData),w}function i(t){for(var e=t.width,r=t.height,n=0,i=0,o=0,a=0,s=t.height;s>a;a=a+1|0)for(var c=0,u=t.width;u>c;c=c+1|0){var h=t.data[o+3];0!==h&&(e>c&&(e=c),c>n&&(n=c),r>a&&(r=a),a>i&&(i=a)),o+=4}var p=void 0;return p=e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:r,width:n-e+1,height:i-r+1}}function o(t){return 0===t.width||0===t.height}function a(t){switch(t){case h.FontFamily.Monospace:return"monospace";case h.FontFamily.Serif:return"serif";default:return"sans-serif"}}function s(t){return-1!==l.indexOf(t)?t:'"'+t+'"'}function c(t){return"number"==typeof t?a(t):"string"==typeof t?s(t):t.map(function(t){return"string"==typeof t?s(t):a(t)}).join(",")}var u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var h=t("@akashic/akashic-engine"),p=t("./CanvasSurface"),l=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],f=function(t){function e(r,n,i,o,s,u,p,l,f){var d=t.call(this,r,n,i,s,u,p,l,f)||this;d._cacheImageData=o,d._glyphAreas={},d._cssFontFamily=c(r);var _=a(h.FontFamily.SansSerif);return-1===d._cssFontFamily.indexOf(_)&&(d._cssFontFamily+=","+_),d._marginW=Math.ceil(.3*d.fontSize+d.strokeWidth/2),d._marginH=Math.ceil(.3*d.fontSize+d.strokeWidth/2),void 0===e._environmentMinimumFontSize&&(e._environmentMinimumFontSize=d.measureMinimumFontSize()),d}return u(e,t),e.prototype.create=function(t){var e,r=this._glyphAreas[t];return r||(e=n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this._cacheImageData,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight),r=i(e.imageData),r.advanceWidth=e.advanceWidth,this._glyphAreas[t]=r),o(r)?(e&&e.surface.destroy(),new h.Glyph(t,0,0,0,0,0,0,r.advanceWidth,void 0,!0)):(e||(e=n(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,this._cacheImageData,this._cacheImageData,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),new h.Glyph(t,r.x,r.y,r.width,r.height,r.x-this._marginW,r.y-this._marginH,r.advanceWidth,e.surface,!0))},e.prototype.measureMinimumFontSize=function(){var t=1,e="M",r=document.createElement("canvas"),n=r.getContext("2d");n.textAlign="left",n.textBaseline="alphabetic",n.lineJoin="bevel";var i;n.font=t+"px sans-serif";var o=n.measureText(e).width;do i=o,t+=1,n.font=t+"px sans-serif",o=n.measureText(e).width;while(i===o||t>50);return t},e}(h.GlyphFactory);r.GlyphFactory=f},{"./CanvasSurface":13,"@akashic/akashic-engine":"@akashic/akashic-engine"}],16:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=t("@akashic/akashic-engine"),o=t("./shims/SurfaceFactory");!function(t){function e(t){if(0!==(t&t-1)){for(var e=1;t>e;)e*=2;return e}return t}function r(t){return Math.min(Math.max(t,0),1)}function n(t){var e;switch(t){case i.CompositeOperation.SourceAtop:e="source-atop";break;case i.CompositeOperation.Lighter:e="lighter";break;case i.CompositeOperation.Copy:e="copy";break;default:e="source-over"}return e}function a(t){var e;switch(t){case"source-atop":e=i.CompositeOperation.SourceAtop;break;case"lighter":e=i.CompositeOperation.Lighter;break;case"copy":e=i.CompositeOperation.Copy;break;default:e=i.CompositeOperation.SourceOver}return e}function s(t,e,r,n,o,a,s,c,u,h,p,l,f){var d,_,g;switch(t.save(),h){case i.FontFamily.Monospace:d="monospace";break;case i.FontFamily.Serif:d="serif";break;default:d="sans-serif"}switch(t.font=a+"px "+d,s){case i.TextAlign.Right:_="right";break;case i.TextAlign.Center:_="center";break;default:_="left"}switch(t.textAlign=_,c){case i.TextBaseline.Top:g="top";break;case i.TextBaseline.Middle:g="middle";break;case i.TextBaseline.Bottom:g="bottom";break;default:g="alphabetic"}t.textBaseline=g,t.lineJoin="bevel",p>0&&(t.lineWidth=p,t.strokeStyle=l,"undefined"==typeof o?t.strokeText(e,r,n):t.strokeText(e,r,n,o)),f||(t.fillStyle=u,"undefined"==typeof o?t.fillText(e,r,n):t.fillText(e,r,n,o)),t.restore()}function c(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}function u(t,e){t[1]*=-1,t[3]*=-1,t[5]=-t[5]+e}function h(t,e,r){return o.SurfaceFactory.createPrimarySurface(t,e,r)}function p(t,e,r,n){return o.SurfaceFactory.createBackSurface(t,e,r,n)}t.toPowerOfTwo=e,t.clamp=r,t.toTextFromCompositeOperation=n,t.toCompositeOperationFromText=a,t.drawSystemTextByContext2D=s,t.usedWebGL=c,t.transformCoordinateSystem=u,t.createPrimarySurface=h,t.createBackSurface=p}(n=r.RenderingHelper||(r.RenderingHelper={}))},{"./shims/SurfaceFactory":30,"@akashic/akashic-engine":"@akashic/akashic-engine"}],17:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./AffineTransformer"),i=function(){function t(t){t?(this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer=new n.AffineTransformer(t.transformer)):(this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new n.AffineTransformer)}return t.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this},t.prototype.updateFrom=function(t){return this.globalAlpha*=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.transform(Array.prototype.slice.call(t.transformer.matrix)),this},t}();r.RenderingState=i},{"./AffineTransformer":12}],18:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./RenderingHelper"),a=t("./RenderingState"),s=function(t){function e(r){var n=t.call(this)||this;return n._stateStack=[],n._stateStackPointer=0,n._capacity=0,n._reallocation(r>0?r:e.DEFAULT_CAPACITY),n}return n(e,t),e.prototype.save=function(){this._pushState()},e.prototype.restore=function(){this._popState()},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},e.prototype.transform=function(t){this.currentState().transformer.transform(t)},e.prototype.opacity=function(t){this.currentState().globalAlpha*=t},e.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=o.RenderingHelper.toTextFromCompositeOperation(t)},e.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},e.prototype.capacity=function(){return this._capacity},e.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},e.prototype._popState=function(){if(!(this._stateStackPointer>0))throw i.ExceptionFactory.createAssertionError("StateHoldingRenderer#restore: state stack under-flow.");--this._stateStackPointer},e.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},e.prototype._reallocation=function(t){var e=this._capacity;if(t>e){2*e>t?this._capacity*=2:this._capacity=t;for(var r=e;r<this._capacity;++r)this._stateStack.push(new a.RenderingState)}},e}(i.Renderer);s.DEFAULT_CAPACITY=16,r.StateHoldingRenderer=s},{"./RenderingHelper":16,"./RenderingState":17,"@akashic/akashic-engine":"@akashic/akashic-engine"}],19:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.addSurface=function(e,r){var n=this._surface.renderer();if(e._imageDataCache&&n._subImage){var i=this._acquireSurfaceAtlasSlot(r.width,r.height);if(!i)return null;var o=n,a=e;return o._subImage(a._imageDataCache,r.x,r.y,r.width,r.height,i.x,i.y),i}return t.prototype.addSurface.call(this,e,r)},e}(i.SurfaceAtlas);r.SurfaceAtlas=o},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],20:[function(t,e,r){"use strict";function n(t){return t._systemTextOps}Object.defineProperty(r,"__esModule",{value:!0}),r.getSystemTextOperations=n},{}],21:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./WebGLBackSurfaceRenderer"),a=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;i._systemTextOps=[],i._webGLRenderer=n;var o=Math.ceil(e),a=Math.ceil(r),s=n.createTextureFrameBuffer(o,a);
return i._frameBuffer=s.frameBuffer,i._drawable={},i._drawable._texture=s.texture,i._drawable._textureOffsetX=0,i._drawable._textureOffsetY=0,i._drawable._textureWidth=o,i._drawable._textureHeight=a,i}return n(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLBackSurfaceRenderer(this)),this._renderer},e.prototype.destroy=function(){this._webGLRenderer.context.deleteFramebuffer(this._frameBuffer),this._frameBuffer=void 0,this._webGLRenderer._disposeTexture(this._drawable._texture),this._webGLRenderer.context.deleteTexture(this._drawable._texture),this._drawable._texture=void 0,t.prototype.destroy.call(this)},e}(i.Surface);r.WebGLBackSurface=a},{"./WebGLBackSurfaceRenderer":22,"@akashic/akashic-engine":"@akashic/akashic-engine"}],22:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./RenderingHelper"),a=t("./RenderingState"),s=t("./SystemText"),c=function(t){function e(e){var r=t.call(this)||this;return r._surface=e,r._renderer=e._webGLRenderer,r}return n(e,t),e.prototype.translate=function(t,e){this._renderer.translate(t,e)},e.prototype.transform=function(t){this._renderer.transform(t)},e.prototype.opacity=function(t){this._renderer.opacity(t)},e.prototype.save=function(){this._renderer.save()},e.prototype.restore=function(){this._renderer.restore()},e.prototype.setCompositeOperation=function(t){this._renderer.setCompositeOperation(t)},e.prototype.setTransform=function(t){this._renderer.setTransform(t)},e.prototype.setOpacity=function(t){this._renderer.setOpacity(t)},e.prototype.clear=function(){this._renderer.clear(),this._surface._systemTextOps=[]},e.prototype.begin=function(){t.prototype.begin.call(this),this._renderer.begin(),this._renderer.pushRenderTarget(this._surface)},e.prototype.end=function(){this._renderer.popRenderTarget(),this._renderer.end(),t.prototype.end.call(this)},e.prototype.drawSprites=function(t,e,r,n,i,o,a,s){this._renderer.drawSprites(t,e,r,n,i,o,a,s)},e.prototype.drawSystemText=function(t,e,r,n,i,s,c,u,h,p,l,f){var d={state:new a.RenderingState(this._renderer.currentState()),parameter:arguments};o.RenderingHelper.transformCoordinateSystem(d.state.transformer.matrix,this._surface.height),this._surface._systemTextOps.push(d)},e.prototype.drawImage=function(t,e,r,n,i,c,u){this._renderer._drawImageExcludingSystemText(t,e,r,n,i,c,u);var h=s.getSystemTextOperations(t);if(h)for(var p=0;p<h.length;p=p+1|0){var l={state:new a.RenderingState(this._renderer.currentState()).updateFrom(h[p].state),parameter:h[p].parameter};o.RenderingHelper.transformCoordinateSystem(l.state.transformer.matrix,this._surface.height),this._surface._systemTextOps.push(l)}},e.prototype.fillRect=function(t,e,r,n,i){this._renderer.fillRect(t,e,r,n,i)},e.prototype._subImage=function(t,e,r,n,i,o,a){for(var s=t.data,c=new Uint8Array(n*i*4),u=0,h=0;i>u;u++)for(var p=4*(t.width*(r+u)+e),l=0,f=4*n;f>l;l++)c[h++]=s[p++];var d=this._renderer.context;d.bindTexture(d.TEXTURE_2D,this._surface._drawable._texture),d.texSubImage2D(d.TEXTURE_2D,0,o,a,n,i,d.RGBA,d.UNSIGNED_BYTE,c),this._renderer.context.bindTexture(this._renderer.context.TEXTURE_2D,this._renderer._currentTexture)},e}(i.Renderer);r.WebGLBackSurfaceRenderer=c},{"./RenderingHelper":16,"./RenderingState":17,"./SystemText":20,"@akashic/akashic-engine":"@akashic/akashic-engine"}],23:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=t("./RenderingHelper");!function(t){function e(e){var r="string"==typeof e?t._toColor(e):[e[0],e[1],e[2],e[3]];return r[3]=i.RenderingHelper.clamp(r[3]),r[0]=i.RenderingHelper.clamp(r[0])*r[3],r[1]=i.RenderingHelper.clamp(r[1])*r[3],r[2]=i.RenderingHelper.clamp(r[2])*r[3],r}function r(t){var e=t[0]%360,r=t[1],n=t[2]>50?100-t[2]:t[2],i=t[3],o=n+n*r,a=n-n*r;return 60>e?[o,e/60*(o-a)+a,a,i]:120>e?[(120-e)/60*(o-a)+a,o,a,i]:180>e?[a,o,(e-120)/60*(o-a)+a,i]:240>e?[a,(240-e)/60*(o-a)+a,o,i]:300>e?[(e-240)/60*(o-a)+a,a,o,i]:[o,a,(360-e)/60*(o-a)+a,i]}function n(e){var r=e.toUpperCase().replace(/\s+/g,""),n=t.colorMap[r];if(n)return n;if(r.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(r.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(r.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(r.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(r.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),i.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),i.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(r.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),i.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),i.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+r)}t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=e,t._hsl2rgb=r,t._toColor=n}(n=r.WebGLColor||(r.WebGLColor={}))},{"./RenderingHelper":16}],24:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("./CanvasSurface"),o=t("./WebGLPrimarySurfaceRenderer"),a=function(t){function e(e,r,n){var o=t.call(this,e,r,["webgl"])||this;return o._upperSurface=new i.CanvasSurface(e,r),o.setCanvasStyle(n),o}return n(e,t),e.prototype.renderer=function(){return this._renderer||(this._renderer=new o.WebGLPrimarySurfaceRenderer(this)),this._renderer},e.prototype.setParentElement=function(e){t.prototype.setParentElement.call(this,e),e.appendChild(this._upperSurface.canvas)},e.prototype.changeCanvasSize=function(e,r){var n=e/this.width,i=r/this.height,o={width:this.width,height:this.height};t.prototype.changeCanvasScale.call(this,n,i,o),this._upperSurface.changeCanvasScale(n,i,o)},e.prototype.setCanvasStyle=function(t){this._upperSurface.canvas.style.position="absolute",this.canvas.style.position="absolute",t?(this.canvas.style.zIndex=t.base||"0",this._upperSurface.canvas.style.zIndex=t.upper||"1"):(this.canvas.style.zIndex="0",this._upperSurface.canvas.style.zIndex="1")},e}(i.CanvasSurface);r.WebGLPrimarySurface=a},{"./CanvasSurface":13,"./WebGLPrimarySurfaceRenderer":25}],25:[function(t,e,r){"use strict";function n(t,e){t.transform(Array.prototype.slice.call(e.transformer.matrix)),t.opacity(e.globalAlpha),t.setCompositeOperation(a.RenderingHelper.toCompositeOperationFromText(e.globalCompositeOperation))}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var o=t("./WebGLRenderer"),a=t("./RenderingHelper"),s=t("./SystemText"),c=function(t){function e(e){var r=t.call(this,e)||this;return r._upperRenderer=e._upperSurface.renderer(),r}return i(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._upperRenderer.clear()},e.prototype._drawImageExcludingSystemText=function(e,r,n,i,o,a,s){t.prototype.drawImage.call(this,e,r,n,i,o,a,s)},e.prototype.drawImage=function(e,r,i,o,a,c,u){t.prototype.drawImage.call(this,e,r,i,o,a,c,u);var h=s.getSystemTextOperations(e);if(h)for(var p=0;p<h.length;p=p+1|0){this._upperRenderer.save(),n(this._upperRenderer,this.currentState()),n(this._upperRenderer,h[p].state);var l=h[p].parameter;this._upperRenderer.drawSystemText.apply(this._upperRenderer,l),this._upperRenderer.restore()}},e.prototype.drawSystemText=function(t,e,r,i,o,a,s,c,u,h,p,l){this._upperRenderer.save(),n(this._upperRenderer,this.currentState()),this._upperRenderer.drawSystemText(t,e,r,i,o,a,s,c,u,h,p,l),this._upperRenderer.restore()},e}(o.WebGLRenderer);r.WebGLPrimarySurfaceRenderer=c},{"./RenderingHelper":16,"./SystemText":20,"./WebGLRenderer":26}],26:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./StateHoldingRenderer"),a=t("./RenderingHelper"),s=t("./WebGLColor"),c=t("./WebGLShaderProgram"),u=t("./WebGLTextureAtlas"),h=t("./RenderingState"),p=function(t){function e(e,r){var n=t.call(this)||this;return n.push({width:e,height:r,_frameBuffer:null}),n}return n(e,t),e.prototype.top=function(){return this[this.length-1]},e}(Array),l=function(t){function e(e){var r=t.call(this)||this;if(r.surface=e,r.context=e.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0}),!r.context)throw i.ExceptionFactory.createAssertionError("WebGLRenderer#constructor: could not initialize WebGLRenderingContext");return r._init(),r}return n(e,t),e.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this.save();var e=new h.RenderingState;a.RenderingHelper.transformCoordinateSystem(e.transformer.matrix,t.height),this.currentState().copyFrom(e),this.context.viewport(0,0,t.width,t.height),this._width=t.width,this._height=t.height,this.context.bindFramebuffer(this.context.FRAMEBUFFER,t._frameBuffer)},e.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this._renderTargetStack.top();this.context.bindFramebuffer(this.context.FRAMEBUFFER,t._frameBuffer),this._width=t.width,this._height=t.height,this.context.viewport(0,0,this._width,this._height),this.restore()},e.prototype.clear=function(){this.context.clear(this.context.COLOR_BUFFER_BIT)},e.prototype.begin=function(){++this._beginCount,1===this._beginCount&&(this._commitCount=0,this.clear(),this._program.use(),this._enableLighting?(this._program.set_uLightType(this._lightTypes),this._program.set_uLightColor(this._lightColors)):(this._program.set_uLightType(this._lightTypesDisabled),this._program.set_uLightColor(this._lightColorsDisabled)),this._program.set_uLightDirection(this._lightDirections),this._program.set_uLightPosition(this._lightPositions),this._program.set_uLightDistanceAttenuation(this._lightDistanceAttenuation),this._program.set_uLightAngleAttenuation(this._lightAngleAttenuation),this._inRendering=!0)},e.prototype.end=function(){--this._beginCount,0===this._beginCount&&(this._inRendering=!1,this._commit(),this._program.unuse())},e.prototype.setLighting=function(t){this._enableLighting=t,this._inRendering&&(this._commit(),t?(this._program.set_uLightType(this._lightTypes),this._program.set_uLightColor(this._lightColors)):(this._program.set_uLightType(this._lightTypesDisabled),this._program.set_uLightColor(this._lightColorsDisabled)))},e.prototype.setNullLight=function(t){0>t||t>=this._program.maxLightCount||(this._lightTypes[t]=0)},e.prototype.setAmbientLight=function(t,e){0>t||t>=this._program.maxLightCount||(this._lightTypes[t]=1,this._setLightColor(t,e))},e.prototype.setDirectionalLight=function(t,e,r){0>t||t>=this._program.maxLightCount||(this._lightTypes[t]=2,this._setLightColor(t,e),this._setLightDirection(t,r))},e.prototype.setPointLight=function(t,e,r,n,i,o){0>t||t>=this._program.maxLightCount||(this._lightTypes[t]=3,this._setLightColor(t,e),this._setLightPosition(t,r),this._setLightDistanceAttenuation(t,n,i,o))},e.prototype.setSpotLight=function(t,e,r,n,i,o,a,s,c,u){0>t||t>=this._program.maxLightCount||(this._lightTypes[t]=4,this._setLightColor(t,e),this._setLightPosition(t,r),this._setLightDirection(t,n),this._setLightDistanceAttenuation(t,i,o,a),this._setLightAngleAttenuation(t,s,c,u))},e.prototype.drawSprites=function(t,e,r,n,i,o,a,s){for(var c=0;s>c;++c)this.drawImage(t,e[c],r[c],n[c],i[c],o[c],a[c])},e.prototype.drawImage=function(t,e,r,n,o,a,s){if(!t._drawable)throw i.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable._texture instanceof WebGLTexture||this._textureAtlas._makeTextureForSurface(this,t),!t._drawable._texture)throw i.ExceptionFactory.createAssertionError("WebGLRenderer#drawImage: could not create a texture.");var c=t._drawable,u=1/c._textureWidth,h=1/c._textureHeight,p=c._textureOffsetX,l=c._textureOffsetY,f=u*(p+e+n),d=h*(l+r+o),_=u*(p+e),g=h*(l+r);this._drawImage(c._texture,a,s,n,o,[_,g,f,g,f,d,_,g,f,d,_,d],this._drawImageColor)},e.prototype.fillRect=function(t,e,r,n,i){this._drawImage(this._fillRectTexture,t,e,r,n,[0,0,1,0,1,1,0,0,1,1,0,1],s.WebGLColor.get(i))},e.prototype.createTextureFrameBuffer=function(t,e){var r=this.context,n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n);var i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),r.bindTexture(r.TEXTURE_2D,this._currentTexture);var o=this._renderTargetStack.top();return r.bindFramebuffer(r.FRAMEBUFFER,o._frameBuffer),{frameBuffer:n,texture:i}},e.prototype._makeTextureForSurface=function(t){var e=t._drawable,r=a.RenderingHelper.toPowerOfTwo(e.width),n=a.RenderingHelper.toPowerOfTwo(e.height);if(r!==e.width||n!==e.height){var i=document.createElement("canvas");i.width=r,i.height=n;var o=i.getContext("2d");o.globalCompositeOperation="copy",o.drawImage(e,0,0),e=o.getImageData(0,0,r,n)}t._drawable._texture=this._makeTexture(e),t._drawable._textureOffsetX=0,t._drawable._textureOffsetY=0,t._drawable._textureWidth=r,t._drawable._textureHeight=n},e.prototype._makeTextureRaw=function(t,e,r){void 0===r&&(r=null);var n=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,n),this.context.pixelStorei(this.context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,t,e,0,this.context.RGBA,this.context.UNSIGNED_BYTE,r),this.context.bindTexture(this.context.TEXTURE_2D,this._currentTexture),n},e.prototype._disposeTexture=function(t){this._currentTexture===t&&this._commit()},e.prototype._assignTexture=function(t,e,r,n){if(this.context.bindTexture(this.context.TEXTURE_2D,n),t instanceof HTMLVideoElement)throw i.ExceptionFactory.createAssertionError("WebGLRenderer#_assignTexture: HTMLVideoElement is not supported.");this.context.texSubImage2D(this.context.TEXTURE_2D,0,e,r,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.bindTexture(this.context.TEXTURE_2D,this._currentTexture)},e.prototype._clearTexture=function(t,e,r,n){this.context.bindTexture(this.context.TEXTURE_2D,n),this.context.texSubImage2D(this.context.TEXTURE_2D,0,0,0,e,r,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.bindTexture(this.context.TEXTURE_2D,this._currentTexture)},e.prototype._init=function(){this._width=this.surface.width,this._height=this.surface.height,this._renderTargetStack=new p(this._width,this._height),this._beginCount=0,this._program=new c.WebGLShaderProgram(this.context),this._textureAtlas=new u.WebGLTextureAtlas,this._fillRectTexture=this._makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._drawImageColor=s.WebGLColor.get("white"),this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._inRendering=!1,this._enableLighting=!1,this._lightTypesDisabled=new Int32Array([1,0,0,0]),this._lightColorsDisabled=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1]),this._lightTypes=new Int32Array([1,0,0,0]),this._lightColors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1]),this._lightDirections=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1]),this._lightPositions=new Float32Array([0,0,100,0,0,100,0,0,100,0,0,100]),this._lightDistanceAttenuation=new Float32Array([.1,.005,25e-6,.1,.005,25e-6,.1,.005,25e-6,.1,.005,25e-6]),this._lightAngleAttenuation=new Float32Array([Math.cos(Math.PI/4),Math.cos(Math.PI/2),Math.cos(Math.PI/4)-Math.cos(Math.PI/2),2,Math.cos(Math.PI/4),Math.cos(Math.PI/2),Math.cos(Math.PI/4)-Math.cos(Math.PI/2),2,Math.cos(Math.PI/4),Math.cos(Math.PI/2),Math.cos(Math.PI/4)-Math.cos(Math.PI/2),2,Math.cos(Math.PI/4),Math.cos(Math.PI/2),Math.cos(Math.PI/4)-Math.cos(Math.PI/2),2]);var t=this.currentState();this._currentTexture=this._fillRectTexture,this._currentColor=this._drawImageColor,this._currentAlpha=1,this._currentCompositeOperation=t.globalCompositeOperation,this._program.use();try{this._program.set_aVertex(this._vertices),this._program.set_uColor(this._currentColor),this._program.set_uAlpha(this._currentAlpha),this._program.set_uSampler(0),this._program.set_uLightType(this._lightTypesDisabled),this._program.set_uLightColor(this._lightColorsDisabled)}finally{this._program.unuse()}this.context.viewport(0,0,this.surface.width,this.surface.height),this.context.enable(this.context.BLEND),this.context.activeTexture(this.context.TEXTURE0),this.context.bindTexture(this.context.TEXTURE_2D,this._fillRectTexture),this._compositeOps={"source-atop":[this.context.DST_ALPHA,this.context.ONE_MINUS_SRC_ALPHA],"source-in":[this.context.DST_ALPHA,this.context.ZERO],"source-out":[this.context.ONE_MINUS_DST_ALPHA,this.context.ZERO],"source-over":[this.context.ONE,this.context.ONE_MINUS_SRC_ALPHA],"destination-atop":[this.context.ONE_MINUS_DST_ALPHA,this.context.SRC_ALPHA],"destination-in":[this.context.ZERO,this.context.SRC_ALPHA],"destination-out":[this.context.ZERO,this.context.ONE_MINUS_SRC_ALPHA],"destination-over":[this.context.ONE_MINUS_DST_ALPHA,this.context.ONE],lighter:[this.context.ONE,this.context.ONE],copy:[this.context.ONE,this.context.ZERO],xor:[this.context.ONE_MINUS_DST_ALPHA,this.context.ONE_MINUS_SRC_ALPHA]};var e=this._compositeOps[this._currentCompositeOperation];this.context.blendFunc(e[0],e[1])},e.prototype._setLightColor=function(t,e){this._lightColors[3*t+0]=e[0],this._lightColors[3*t+1]=e[1],this._lightColors[3*t+2]=e[2]},e.prototype._setLightDirection=function(t,e){this._lightDirections[3*t+0]=e[0],this._lightDirections[3*t+1]=-e[1],this._lightDirections[3*t+2]=e[2]},e.prototype._setLightPosition=function(t,e){this._lightPositions[3*t+0]=e[0],this._lightPositions[3*t+1]=this._height-e[1],this._lightPositions[3*t+2]=e[2]},e.prototype._setLightDistanceAttenuation=function(t,e,r,n){this._lightDistanceAttenuation[3*t+0]=e,this._lightDistanceAttenuation[3*t+1]=r,this._lightDistanceAttenuation[3*t+2]=n},e.prototype._setLightAngleAttenuation=function(t,e,r,n){var i=Math.cos(.5*e),o=Math.cos(.5*r);this._lightAngleAttenuation[4*t+0]=i,this._lightAngleAttenuation[4*t+1]=o,this._lightAngleAttenuation[4*t+2]=i-o,this._lightAngleAttenuation[4*t+3]=n},e.prototype._drawImage=function(t,e,r,n,i,o,a){this._numSprites>=this._maxSpriteCount&&this._commit(),this._currentTexture!==t&&(this._currentTexture=t,this._commit(),this.context.bindTexture(this.context.TEXTURE_2D,t)),this._currentColor[0]===a[0]&&this._currentColor[1]===a[1]&&this._currentColor[2]===a[2]&&this._currentColor[3]===a[3]||(this._currentColor=a,this._commit(),this._program.set_uColor(a));var s=this.currentState();if(this._currentAlpha!==s.globalAlpha&&(this._currentAlpha=s.globalAlpha,this._commit(),this._program.set_uAlpha(s.globalAlpha)),this._currentCompositeOperation!==s.globalCompositeOperation){this._currentCompositeOperation=s.globalCompositeOperation,this._commit();var c=this._compositeOps[this._currentCompositeOperation];this.context.blendFunc(c[0],c[1])}this._register(this._transformVertex(e,r,n,i,s.transformer),o)},e.prototype._transformVertex=function(t,e,r,n,i){var o=2/this._width,a=-2/this._height,s=i.matrix,c=o*r*s[0],u=a*r*s[1],h=o*n*s[2],p=a*n*s[3],l=o*(t*s[0]+e*s[2]+s[4])-1,f=a*(t*s[1]+e*s[3]+s[5])+1;return[l,f,c+l,u+f,c+h+l,u+p+f,l,f,c+h+l,u+p+f,h+l,p+f]},e.prototype._register=function(t,e){var r=6*this._numSprites;++this._numSprites;for(var n=0;6>n;++n)this._verticesCache[4*(n+r)+0]=t[2*n+0],this._verticesCache[4*(n+r)+1]=t[2*n+1],this._verticesCache[4*(n+r)+2]=e[2*n+0],this._verticesCache[4*(n+r)+3]=e[2*n+1]},e.prototype._commit=function(){this._numSprites>0&&(this.context.bindBuffer(this.context.ARRAY_BUFFER,this._vertices),this.context.bufferSubData(this.context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this.context.drawArrays(this.context.TRIANGLES,0,6*this._numSprites),this._numSprites=0,++this._commitCount)},e.prototype._makeTexture=function(t){var e=this.context.createTexture();return this.context.bindTexture(this.context.TEXTURE_2D,e),this.context.pixelStorei(this.context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_S,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_WRAP_T,this.context.CLAMP_TO_EDGE),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MAG_FILTER,this.context.NEAREST),this.context.texParameteri(this.context.TEXTURE_2D,this.context.TEXTURE_MIN_FILTER,this.context.NEAREST),t instanceof HTMLImageElement?this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t):t instanceof HTMLCanvasElement?this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t):t instanceof ImageData&&this.context.texImage2D(this.context.TEXTURE_2D,0,this.context.RGBA,this.context.RGBA,this.context.UNSIGNED_BYTE,t),this.context.bindTexture(this.context.TEXTURE_2D,this._currentTexture),e},e.prototype._makeBuffer=function(t){var e=this.context.createBuffer();return this.context.bindBuffer(this.context.ARRAY_BUFFER,e),this.context.bufferData(this.context.ARRAY_BUFFER,t,this.context.DYNAMIC_DRAW),e},e}(o.StateHoldingRenderer);r.WebGLRenderer=l},{"./RenderingHelper":16,"./RenderingState":17,"./StateHoldingRenderer":18,"./WebGLColor":23,"./WebGLShaderProgram":27,"./WebGLTextureAtlas":28,"@akashic/akashic-engine":"@akashic/akashic-engine"}],27:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(e){this.maxLightCount=4;var r="#version 100\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {gl_Position = vec4(aVertex.xy, 0.0, 1.0);vTexCoord = aVertex.zw;vColor = uColor * uAlpha;}",n="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform int uLightType[4];\nuniform vec3 uLightColor[4];\nuniform vec3 uLightDirection[4];\nuniform vec3 uLightPosition[4];\nuniform vec3 uLightDistanceAttenuation[4];\nuniform vec4 uLightAngleAttenuation[4];\nvoid main() {gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}";this._context=e,this._program=t._makeShaderProgram(e,r,n),this._aVertex=e.getAttribLocation(this._program,"aVertex"),this._uColor=e.getUniformLocation(this._program,"uColor"),this._uAlpha=e.getUniformLocation(this._program,"uAlpha"),this._uSampler=e.getUniformLocation(this._program,"uSampler"),this._uLightType=e.getUniformLocation(this._program,"uLightType"),this._uLightColor=e.getUniformLocation(this._program,"uLightColor"),this._uLightDirection=e.getUniformLocation(this._program,"uLightDirection"),this._uLightPosition=e.getUniformLocation(this._program,"uLightPosition"),this._uLightDistanceAttenuation=e.getUniformLocation(this._program,"uLightDistanceAttenuation"),this._uLightAngleAttenuation=e.getUniformLocation(this._program,"uLightAngleAttenuation")}return t._makeShader=function(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(n);throw t.deleteShader(n),new Error(i)}return n},t._makeShaderProgram=function(e,r,n){var i=e.createProgram(),o=t._makeShader(e,e.VERTEX_SHADER,r);e.attachShader(i,o),e.deleteShader(o);var a=t._makeShader(e,e.FRAGMENT_SHADER,n);if(e.attachShader(i,a),e.deleteShader(a),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){var s=e.getProgramInfoLog(i);throw e.deleteProgram(i),new Error(s)}return i},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.set_uLightType=function(t){this._context.uniform1iv(this._uLightType,t)},t.prototype.set_uLightColor=function(t){this._context.uniform3fv(this._uLightColor,t)},t.prototype.set_uLightDirection=function(t){this._context.uniform3fv(this._uLightDirection,t)},t.prototype.set_uLightPosition=function(t){this._context.uniform3fv(this._uLightPosition,t)},t.prototype.set_uLightDistanceAttenuation=function(t){this._context.uniform3fv(this._uLightDistanceAttenuation,t)},t.prototype.set_uLightAngleAttenuation=function(t){this._context.uniform4fv(this._uLightAngleAttenuation,t)},t.prototype.use=function(){this._context.useProgram(this._program)},t.prototype.unuse=function(){this._context.useProgram(null)},t}();r.WebGLShaderProgram=n},{}],28:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./WebGLTextureMap"),i=function(){function t(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(t.TEXTURE_SIZE*t.TEXTURE_SIZE*4);
}return t.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},t.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},t.prototype._makeTextureForSurface=function(e,r){var n=r._drawable;if(n&&!n._texture){var i=n.width,o=n.height;return i>=t.TEXTURE_SIZE||o>=t.TEXTURE_SIZE?void e._makeTextureForSurface(r):void this._assign(e,r,this._maps)}},t.prototype._assign=function(e,r,i){for(var o,a=0;a<i.length;++a)if(o=i[(a+this._insertPos)%i.length].insert(r))return this._register(e,o,r._drawable),void(this._insertPos=a);o=null,i.length>=t.TEXTURE_COUNT&&(o=i.shift(),e._disposeTexture(o.texture),o.dispose(),e._clearTexture(this.emptyTexturePixels,t.TEXTURE_SIZE,t.TEXTURE_SIZE,o.texture)),o||(o=new n.WebGLTextureMap(e._makeTextureRaw(t.TEXTURE_SIZE,t.TEXTURE_SIZE),0,0,t.TEXTURE_SIZE,t.TEXTURE_SIZE)),i.push(o),o=o.insert(r),this._register(e,o,r._drawable)},t.prototype._register=function(e,r,n){n._texture=r.texture,n._textureOffsetX=r.offsetX,n._textureOffsetY=r.offsetY,n._textureWidth=t.TEXTURE_SIZE,n._textureHeight=t.TEXTURE_SIZE,e._assignTexture(n,r.offsetX,r.offsetY,r.texture)},t}();i.TEXTURE_SIZE=1024,i.TEXTURE_COUNT=16,r.WebGLTextureAtlas=i},{"./WebGLTextureMap":29}],29:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e,r,n,i){this.texture=t,this.offsetX=e,this.offsetY=r,this._width=n,this._height=i}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable._texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var r=e._drawable,n=r.width+t.TEXTURE_MARGIN,i=r.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var a=this._right.insert(e);if(a)return a}return null}if(this._width<n||this._height<i)return null;var s=this._width-n,c=this._height-i;return c>=s?(this._left=new t(this.texture,this.offsetX+n,this.offsetY,s,i),this._right=new t(this.texture,this.offsetX,this.offsetY+i,this._width,c)):(this._left=new t(this.texture,this.offsetX,this.offsetY+i,n,c),this._right=new t(this.texture,this.offsetX+n,this.offsetY,s,this._height)),this._surface=e,this},t}();n.TEXTURE_MARGIN=1,r.WebGLTextureMap=n},{}],30:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i=t("../RenderingHelper"),o=t("../CanvasSurface"),a=t("../WebGLPrimarySurface"),s=t("../WebGLBackSurface");!function(t){function e(t,e,r){return i.RenderingHelper.usedWebGL(r)?new a.WebGLPrimarySurface(t,e):new o.CanvasSurface(t,e,r)}function r(t,e,r,n){if(i.RenderingHelper.usedWebGL(n)){var a=r.getPrimarySurface().renderer();return new s.WebGLBackSurface(t,e,a)}return new o.CanvasSurface(t,e,n)}t.createPrimarySurface=e,t.createBackSurface=r}(n=r.SurfaceFactory||(r.SurfaceFactory={}))},{"../CanvasSurface":13,"../RenderingHelper":16,"../WebGLBackSurface":21,"../WebGLPrimarySurface":24}],31:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),i=(t("@akashic/akashic-pdi"),function(){function t(e,r){if(Object.getPrototypeOf&&Object.getPrototypeOf(this)===t.prototype)throw new Error("InputAbstractHandler is abstract and should not be directly instantiated");this.inputView=e,this.pointerEventLock={},this._calculateOffsetForLazy=!0,this._xScale=1,this._yScale=1,this._offset={x:0,y:0},this._disablePreventDefault=!!r,this.pointTrigger=new n.Trigger}return t.isSupported=function(){return!1},t.prototype.start=function(){throw new Error("This method is abstract")},t.prototype.stop=function(){throw new Error("This method is abstract")},t.prototype.setOffset=function(t){this._offset=t},t.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},t.prototype.pointDown=function(t,e){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e)}),this.pointerEventLock[t]=!0},t.prototype.pointMove=function(t,e){t in this.pointerEventLock&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e)})},t.prototype.pointUp=function(t,e){t in this.pointerEventLock&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e)}),delete this.pointerEventLock[t])},t.prototype.getOffsetFromEvent=function(t){if(this._calculateOffsetForLazy){var e=this.inputView.getBoundingClientRect(),r={x:Math.round(window.pageXOffset+e.left),y:Math.round(window.pageYOffset+e.top)};this._offset=r,this._calculateOffsetForLazy=!1}return{x:(t.pageX-this._offset.x)/this._xScale,y:(t.pageY-this._offset.y)/this._yScale}},t.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},t.prototype.notifyViewMoved=function(){this._calculateOffsetForLazy=!0},t}());r.InputAbstractHandler=i},{"@akashic/akashic-engine":"@akashic/akashic-engine","@akashic/akashic-pdi":44}],32:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("./InputAbstractHandler"),o=function(t){function e(e,r){var n=t.call(this,e,r)||this,i=1;return n.onPointDown=function(t){0===t.button&&(n.pointDown(i,t),window.addEventListener("mousemove",n.onPointMove,!1),window.addEventListener("mouseup",n.onPointUp,!1),n._disablePreventDefault||(t.stopPropagation(),t.preventDefault()))},n.onPointMove=function(t){n.pointMove(i,t),n._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},n.onPointUp=function(t){n.pointUp(i,t),window.removeEventListener("mousemove",n.onPointMove,!1),window.removeEventListener("mouseup",n.onPointUp,!1),n._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},n}return n(e,t),e.isSupported=function(){return!0},e.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onPointDown,!1)},e.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onPointDown,!1)},e}(i.InputAbstractHandler);r.MouseHandler=o},{"./InputAbstractHandler":31}],33:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("./InputAbstractHandler"),o=t("../RuntimeInfo"),a=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.onPointDown=function(t){for(var e=t.changedTouches,r=0,i=e.length;i>r;r++){var o=e[r];n.pointDown(o.identifier,o)}n._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},n.onPointMove=function(t){for(var e=t.changedTouches,r=0,i=e.length;i>r;r++){var o=e[r];n.pointMove(o.identifier,o)}n._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},n.onPointUp=function(t){for(var e=t.changedTouches,r=0,i=e.length;i>r;r++){var o=e[r];n.pointUp(o.identifier,o)}n._disablePreventDefault||(t.stopPropagation(),t.preventDefault())},n}return n(e,t),e.isSupported=function(){return o.RuntimeInfo.touchEnabled()},e.prototype.start=function(){this.inputView.addEventListener("touchstart",this.onPointDown),this.inputView.addEventListener("touchmove",this.onPointMove),this.inputView.addEventListener("touchend",this.onPointUp)},e.prototype.stop=function(){this.inputView.removeEventListener("touchstart",this.onPointDown),this.inputView.removeEventListener("touchmove",this.onPointMove),this.inputView.removeEventListener("touchend",this.onPointUp)},e}(i.InputAbstractHandler);r.TouchHandler=a},{"../RuntimeInfo":6,"./InputAbstractHandler":31}],34:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(){this._activePlugin=void 0}return t.prototype.getActivePlugin=function(){return void 0===this._activePlugin?null:this._activePlugin},t.prototype.tryInstallPlugin=function(t){var e=this.findFirstAvailablePlugin(t);return!!e&&(this._activePlugin=new e,!0)},t.prototype.findFirstAvailablePlugin=function(t){for(var e=0,r=t.length;r>e;e++){var n=t[e];if(n.isSupported())return n}},t}();r.AudioPluginManager=n},{}],35:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=[];r.AudioPluginRegistry={addPlugin:function(t){-1===n.indexOf(t)&&n.push(t)},getRegisteredAudioPlugins:function(){return n},clear:function(){n=[]}}},{}],36:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._load=function(t){var r=this,n=new Audio,o=function(t,e){n.autoplay=!1,n.preload="none",n.src=t,r._attachAll(n,e),n.preload="auto",s(n,e),n.load()},a={success:function(){r._detachAll(n,a),r.data=n,t._onAssetLoad(r),window.clearInterval(r._intervalId)},error:function(){r._detachAll(n,a),r.data=n,t._onAssetError(r,i.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(r._intervalId)}},s=function(t,e){r._intervalCount=0,r._intervalId=window.setInterval(function(){4===t.readyState?e.success():(++r._intervalCount,600===r._intervalCount&&e.error())},100)};if(".mp4"===this.path.slice(-4)&&-1!==e.supportedFormats.indexOf("aac")){var c={success:a.success,error:function(){r._detachAll(n,c),window.clearInterval(r._intervalId);var t=r.path.slice(0,r.path.length-4)+".aac";o(t,a)}};return void o(this.path,c)}o(this.path,a)},e.prototype.createInstance=function(){var t=new Audio(this.data.src),r=new e(this.id,this.path,this.duration,this._system,this.loop,this.hint);return r.data=t,r},e.prototype._assetPathFilter=function(t){return-1!==e.supportedFormats.indexOf("ogg")?i.PathUtil.addExtname(t,"ogg"):-1!==e.supportedFormats.indexOf("mp4")?i.PathUtil.addExtname(t,"mp4"):void 0},e.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},e.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},e}(i.AudioAsset);r.HTMLAudioAsset=o},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],37:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=function(t){function e(e){var r=t.call(this,e)||this;return r._endedEventHandler=function(){r._onAudioEnded()},r}return n(e,t),e.prototype.play=function(e){this.currentAudio&&this.stop();var r=e.createInstance(),n=r.data;n.volume=this.volume,n.play(),n.loop=e.loop,n.addEventListener("ended",this._endedEventHandler,!1),this._audioInstance=n,t.prototype.play.call(this,e)},e.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._audioInstance.pause(),this._audioInstance.currentTime=0,t.prototype.stop.call(this))},e.prototype.changeVolume=function(e){this.currentAudio&&(this._audioInstance.volume=e),t.prototype.changeVolume.call(this,e)},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1)},e}(i.AudioPlayer);r.HTMLAudioPlayer=o},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],38:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./HTMLAudioAsset"),i=t("./HTMLAudioPlayer"),o=function(){function t(){this._supportedFormats=this._detectSupportedFormats(),n.HTMLAudioAsset.supportedFormats=this.supportedFormats}return t.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(r){}return e},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,n.HTMLAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,r,i,o,a){return new n.HTMLAudioAsset(t,e,r,i,o,a)},t.prototype.createPlayer=function(t){return new i.HTMLAudioPlayer(t)},t.prototype._detectSupportedFormats=function(){var t=document.createElement("audio"),e=[];try{for(var r=["ogg","mp4","aac"],n=0,i=r.length;i>n;n++){var o=r[n],a="no"!==t.canPlayType("audio/"+o)&&""!==t.canPlayType("audio/"+o);a&&e.push(o)}}catch(s){}return e},t}();r.HTMLAudioPlugin=o},{"./HTMLAudioAsset":36,"./HTMLAudioPlayer":37}],39:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("../../utils/XHRLoader"),a=t("./WebAudioHelper"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._load=function(t){var e=this,r=function(r){e.data=r,t._onAssetLoad(e)},n=function(){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},s=function(t){var e=a.getAudioContext();e.decodeAudioData(t,r,n)},c=new o.XHRLoader,u=function(t,e,r){c.getArrayBuffer(t,function(t,n){t?r(t):e(n)})};return".mp4"===this.path.slice(-4)?void u(this.path,s,function(t){var r=e.path.slice(0,e.path.length-4)+".aac";u(r,function(t){e.path=r,s(t)},n)}):void u(this.path,s,n)},e.prototype._assetPathFilter=function(t){if(-1!==e.supportedFormats.indexOf("ogg"))return i.PathUtil.addExtname(t,"ogg");if(-1!==e.supportedFormats.indexOf("mp4"))return i.PathUtil.addExtname(t,"mp4");throw new Error("not available ogg or aac, The UA supported formats are "+e.supportedFormats)},e}(i.AudioAsset);s.supportedFormats=[],r.WebAudioAsset=s},{"../../utils/XHRLoader":43,"./WebAudioHelper":40,"@akashic/akashic-engine":"@akashic/akashic-engine"}],40:[function(t,e,r){(function(t){"use strict";var r,n=t.AudioContext||t.webkitAudioContext,i=null;!function(t){function e(){return i||(i=new n),i}function r(t){return t.createGain?t.createGain():t.createGainNode()}function o(t){var e=t.createBufferSource();return e.start?e:(e.start=e.noteOn,e.stop=e.noteOff,e)}t.getAudioContext=e,t.createGainNode=r,t.createBufferNode=o}(r||(r={})),e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],41:[function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=t("@akashic/akashic-engine"),o=t("./WebAudioHelper"),a=function(t){function e(e){var r=t.call(this,e)||this;return r._audioContext=o.getAudioContext(),r._gainNode=o.createGainNode(r._audioContext),r._gainNode.connect(r._audioContext.destination),r._gainNode.gain.value=e.volume,r._sourceNode=void 0,r._endedEventHandler=function(){r._onAudioEnded()},r}return n(e,t),e.prototype.changeVolume=function(e){this._gainNode.gain.value=e,t.prototype.changeVolume.call(this,e)},e.prototype.play=function(e){this.currentAudio&&this.stop();var r=o.createBufferNode(this._audioContext);r.loop=e.loop,r.buffer=e.data,r.connect(this._gainNode),this._sourceNode=r,this._sourceNode.onended=this._endedEventHandler,this._sourceNode.start(0),t.prototype.play.call(this,e)},e.prototype.stop=function(){this.currentAudio&&(this._clearEndedEventHandler(),this._sourceNode.stop(0),t.prototype.stop.call(this))},e.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},e.prototype._clearEndedEventHandler=function(){this._sourceNode.onended=null},e}(i.AudioPlayer);r.WebAudioPlayer=a},{"./WebAudioHelper":40,"@akashic/akashic-engine":"@akashic/akashic-engine"}],42:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("./WebAudioAsset"),i=t("./WebAudioPlayer"),o=function(){function t(){this.supportedFormats=this._detectSupportedFormats()}return t.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,n.WebAudioAsset.supportedFormats=t},enumerable:!0,configurable:!0}),t.prototype.createAsset=function(t,e,r,i,o,a){return new n.WebAudioAsset(t,e,r,i,o,a)},t.prototype.createPlayer=function(t){return new i.WebAudioPlayer(t)},t.prototype._detectSupportedFormats=function(){var t=document.createElement("audio"),e=[];try{for(var r=["ogg","mp4","aac"],n=0,i=r.length;i>n;n++){var o=r[n],a="no"!==t.canPlayType("audio/"+o)&&""!==t.canPlayType("audio/"+o);a&&e.push(o)}}catch(s){}return e},t}();r.WebAudioPlugin=o},{"./WebAudioAsset":39,"./WebAudioPlayer":41}],43:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t("@akashic/akashic-engine"),i=function(){function t(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return t.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},t.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},t.prototype._getRequestObject=function(t,e){var r=new XMLHttpRequest;r.open("GET",t.url,!0),r.responseType=t.responseType,r.timeout=this.timeout,r.addEventListener("timeout",function(){e(n.ExceptionFactory.createAssetLoadError("loading timeout"))},!1),r.addEventListener("load",function(){if(r.status>=200&&r.status<300){var i="text"===t.responseType?r.responseText:r.response;e(null,i)}else e(n.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.addEventListener("error",function(){e(n.ExceptionFactory.createAssetLoadError("loading error. status: "+r.status))},!1),r.send()},t}();r.XHRLoader=i},{"@akashic/akashic-engine":"@akashic/akashic-engine"}],44:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}]},{},[]);</script>

<script>
if (! ("optionProps" in window)) {
	window.optionProps = {};
}
window.optionProps.magnify = true
window.g = require("@akashic/akashic-engine");
</script>
<script>
if (! ("gLocalAssetContainer" in window)) {
	window.gLocalAssetContainer = {};
}

			window.gLocalAssetContainer["game.json"] = "{%0A%09%22width%22: 512,%0A%09%22height%22: 384,%0A%09%22fps%22: 30,%0A%09%22assets%22: {%0A%09%09%22mainScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/mainScene.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22font16%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 256,%0A%09%09%09%22height%22: 96,%0A%09%09%09%22path%22: %22image/font16.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22glyph_area%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22text/glyph_area.json%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22alphaEnemy%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/alphaEnemy.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22ball%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 16,%0A%09%09%09%22height%22: 16,%0A%09%09%09%22path%22: %22image/ball.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22betaEnemy%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/betaEnemy.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item01%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item01.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item02%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item02.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item03%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item03.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item04%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item04.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item05%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item05.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22item06%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 24,%0A%09%09%09%22height%22: 24,%0A%09%09%09%22path%22: %22image/item06.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22missle%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 8,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/missle.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22particle%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 16,%0A%09%09%09%22height%22: 16,%0A%09%09%09%22path%22: %22image/particle.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22player%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 32,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/player.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22returnButton%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 48,%0A%09%09%09%22path%22: %22image/returnButton.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22shield%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 16,%0A%09%09%09%22height%22: 16,%0A%09%09%09%22path%22: %22image/shield.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22star01%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 2,%0A%09%09%09%22height%22: 8,%0A%09%09%09%22path%22: %22image/star01.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22star02%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 2,%0A%09%09%09%22height%22: 4,%0A%09%09%09%22path%22: %22image/star02.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22startButton%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 128,%0A%09%09%09%22height%22: 48,%0A%09%09%09%22path%22: %22image/startButton.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22title%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 416,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22path%22: %22image/title.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22gameover%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 384,%0A%09%09%09%22height%22: 80,%0A%09%09%09%22path%22: %22image/gameover.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22gammaEnemy%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 64,%0A%09%09%09%22height%22: 64,%0A%09%09%09%22path%22: %22image/gammaEnemy.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22enemyMissile%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 12,%0A%09%09%09%22height%22: 32,%0A%09%09%09%22path%22: %22image/enemyMissile.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22sparkle%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 26,%0A%09%09%09%22height%22: 26,%0A%09%09%09%22path%22: %22image/sparkle.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22ScreenEffector%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/ScreenEffector.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22titleScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/titleScene.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Math%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Math.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22EntityType%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/EntityType.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Player%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Player.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22gameScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/gameScene.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Global%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Global.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22ItemType%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/ItemType.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Shield%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Shield.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Bullet%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Bullet.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Particle%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Particle.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22emmitDamageEffect%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/emmitDamageEffect.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Enemy%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Enemy.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Item%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Item.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22ItemGaugeTray%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/ItemGaugeTray.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22AlphaEnemy%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/AlphaEnemy.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22BetaEnemy%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/BetaEnemy.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22GammaEnemy%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/GammaEnemy.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22EnemyManager%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/EnemyManager.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22Background%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/Background.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22GameCore%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/GameCore.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22GameOverLogo%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/GameOverLogo.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22PlayerStatus%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/PlayerStatus.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22akashic%22: {%0A%09%09%09%22type%22: %22image%22,%0A%09%09%09%22width%22: 179,%0A%09%09%09%22height%22: 128,%0A%09%09%09%22path%22: %22image/akashic.png%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22bootScene%22: {%0A%09%09%09%22type%22: %22script%22,%0A%09%09%09%22path%22: %22script/bootScene.js%22,%0A%09%09%09%22global%22: true%0A%09%09},%0A%09%09%22version%22: {%0A%09%09%09%22type%22: %22text%22,%0A%09%09%09%22path%22: %22text/version.txt%22%0A%09%09}%0A%09},%0A%09%22environment%22: {%0A%09%09%22sandbox-runtime%22: %221%22%0A%09}%0A}";
				window.gLocalAssetContainer["mainScene"] = function(g) {
			!function(e,a,t,o,n){var l=a("Global"),r=a("bootScene");t.exports=function(){return l.bmpFont=new g.BitmapFont({src:g.game.assets.font16,map:JSON.parse(g.game.assets.glyph_area.data),defaultGlyphWidth:16,defaultGlyphHeight:16}),r()}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["ScreenEffector"] = function(g) {
			!function(e,t,r,i,h){function s(e){g.E.prototype.constructor.call(this,e),this.backSurface=a.resourceFactory.createSurface(Math.ceil(this.width),Math.ceil(this.height)),this.backRenderer=this.backSurface.renderer(),this.filterSurface=a.resourceFactory.createSurface(Math.ceil(this.width),Math.ceil(this.height)),this.filterRenderer=this.filterSurface.renderer(),this.mosaicLevel=e.mosaicLevel||1,this.blurEffect=!1,this.cntr=0}var a=g.game;s.prototype=Object.create(g.E.prototype),s.prototype.startMosaic=function(e){this.cntr=0,this.mosaicLevel=e},s.prototype.startBlur=function(){this.cntr=0,this.blurEffect=!0},s.prototype.renderSelf=function(e,t){var r=this.children;if(this.mosaicLevel>1){this.backRenderer.begin();for(var i=0;i<r.length;++i)r[i].render(this.backRenderer,t);this.backRenderer.end();var h=1/this.mosaicLevel;this.filterRenderer.begin(),this.filterRenderer.save(),this.filterRenderer.fillRect(0,0,this.width,this.height,"#101080"),this.filterRenderer.transform([h,0,0,h,0,0]),this.filterRenderer.drawImage(this.backSurface,0,0,this.width,this.height,0,0),this.filterRenderer.restore(),this.filterRenderer.end(),h=1/h,e.save(),e.transform([h,0,0,h,0,0]),e.drawImage(this.filterSurface,0,0,this.width,this.height,0,0),e.restore()}else if(this.blurEffect){this.backRenderer.begin();for(var i=0;i<r.length;++i)r[i].render(this.backRenderer,t);if(this.cntr>0){this.backRenderer.save(),this.backRenderer.opacity(.8),this.backRenderer.setCompositeOperation(g.CompositeOperation.Lighter);var s=1.075,n=2*Math.PI/a.fps*this.cntr*.01;this.backRenderer.transform([1,0,0,1,this.width/2,this.height/2]),this.backRenderer.transform([s*Math.cos(n),s*-Math.sin(n),s*Math.sin(n),s*Math.cos(n),0,0]),this.backRenderer.transform([1,0,0,1,-this.width/2,-this.height/2]),this.backRenderer.drawImage(this.filterSurface,0,0,this.width,this.height,0,0),this.backRenderer.restore()}this.backRenderer.end(),this.filterRenderer.begin(),this.filterRenderer.save(),this.filterRenderer.drawImage(this.backSurface,0,0,this.width,this.height,0,0),this.filterRenderer.restore(),this.filterRenderer.end(),e.save(),e.drawImage(this.backSurface,0,0,this.width,this.height,0,0),e.restore()}else{e.begin();for(var i=0;i<r.length;++i)r[i].render(e,t);e.end()}return this.cntr++,!1},r.exports=s}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["titleScene"] = function(g) {
			!function(e,t,n,i,h){function a(e,t){for(var n=e[(t+2)%3],i=e[(t+1)%3],h=e[(t+0)%3],a=.25,r=0;r<n.length;r++)for(var o=0;o<n[r].length;o++){var s=Math.max(0,r-1),l=Math.min(n.length-1,r+1),c=Math.max(0,o-1),g=Math.min(n[r].length-1,o+1);n[r][o]=2*i[r][o]+a*(i[r][c]+i[r][g]+i[s][o]+i[l][o]-4*i[r][o])-h[r][o],n[r][o]*=.95}return n}function r(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var h=Math.min(1,Math.max(0,(t[n][i]+1)/2)),a=e[n][i],r=16+16*h|0,o=16+16*h|0,s=255*h|0;a.cssColor="#"+("000000"+(r<<16|o<<8|s).toString(16)).slice(-6),a.modified()}}function o(e,t,n){for(var i=[],h=0;h<m.height/n;h++){for(var a=[],r=0;r<m.width/n;r++){var o=new g.FilledRect({scene:e,cssColor:"#000020",width:n,height:n,x:n*r,y:n*h});a.push(o),t.append(o)}i.push(a)}return i}function s(e){heights=[];for(var t=0;3>t;t++){var n=[];for(j=0;j<m.height/e;j++)n.push(Array(m.width/e).fill(0));heights.push(n)}return heights}function l(){var e=new g.Scene({game:m,assetIds:["version"]});return e.loaded.handle(function(){var t=new d({scene:e,width:m.width,height:m.height,touchable:!0,mosaicLevel:60});e.append(t);var n=16;this.cells=o(e,t,n),this.heights=s(n);var i=m.assets.title,h=new g.Sprite({scene:e,src:i,x:(m.width-i.width)/2,y:(m.height-i.height)/3*1,touchable:!0});t.append(h);var l=m.assets.startButton,p=new g.Sprite({scene:e,src:l,x:(m.width-l.width)/2,y:(m.height-l.height)/4*3,touchable:!0});p.pointDown.handle(function(){t.mosaicLevel>1||(p.x+=4,p.y+=4,p.modified())}),p.pointUp.handle(function(){t.mosaicLevel>1||(p.x-=4,p.y-=4,p.touchable=!1,p.modified(),t.startBlur(),e.setTimeout(1e3,function(){m.replaceScene(f())}))}),t.append(p);var v=0,w=!1;e.update.handle(function(){if(t.mosaicLevel>1)t.mosaicLevel--;else{if(!w){t.append(new g.Label({scene:e,text:"HI "+("00000"+c.hiScore).slice(-6),font:c.bmpFont,fontSize:16,x:m.width-148,y:4}));var n="ver "+e.assets.version.data.replace(/[\r\n]/g,"");t.append(new g.Label({scene:e,text:n,font:c.bmpFont,fontSize:16,x:m.width-(16*n.length+4),y:m.height-20})),w=!0}if(u.random()<.025){var i=this.cells[0].length*u.random()|0,h=this.cells.length*u.random()|0;this.heights[(v+1)%3][h][i]=2}}r(this.cells,a(this.heights,v)),v++})}),e}var c=t("Global"),d=t("ScreenEffector"),f=t("gameScene"),u=t("Math"),m=g.game;n.exports=l}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Math"] = function(g) {
			!function(e,t,r,n,i){function o(e,t){return e.x<=t.x+t.width&&e.x+e.width>=t.x&&e.y<=t.y+t.height&&e.y+e.height>=t.y}function u(){return g.game.random[0].get(0,65535)/65535}r.exports.intersectArea=o,r.exports.random=u}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["EntityType"] = function(g) {
			!function(E,e,L,o,g){L.exports={PLAYER:0,ENEMY:1,PLAYER_BULLET:2,ENEMY_BULLET:3,EFFECT:4,ITEM:5,OBSTACLE:6}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Player"] = function(g) {
			!function(t,e,i,r,h){function n(){this.reset(),this.obstacles=[o.ENEMY,o.ENEMY_BULLET,o.ITEM],this.spr=new g.Sprite({scene:p.gameCore.scene,src:m.assets.player,x:this.pos.x,y:this.pos.y}),p.gameCore.gameLayer.append(this.spr)}var p=e("Global"),o=e("EntityType"),a=e("ItemType"),l=e("Shield"),C=e("Bullet"),u=e("emmitDamageEffect"),m=g.game;n.MAX_HP=15,n.prototype.onCollision=function(t){if(t.type===o.ITEM){t.hp=0;var e,i=10*m.fps,r=this;switch(t.itemType){case a.SHIELD:if(this.shieldCntr<=0){for(var h=0;8>h;h++)p.gameCore.entities.push(s=new l(h,8));e=function(){return r.shieldCntr}}this.shieldCntr=i;break;case a.HOMING:this.homingCntr<=0&&(e=function(){return r.homingCntr}),this.homingCntr=i;break;case a.PIERCING:this.piercingCntr<=0&&(e=function(){return r.piercingCntr}),this.piercingCntr=i;break;case a.RAPIDFIRE:this.rapidFireCntr<=0&&(e=function(){return r.rapidFireCntr}),this.rapidFireCntr=i;break;case a.BULLETSPEED:this.bulletSpeedCntr<=0&&(e=function(){return r.bulletSpeedCntr}),this.bulletSpeedCntr=i;break;case a.RECOVER:this.hp<n.MAX_HP&&this.hp++}e&&p.gameCore.itemGaugeTray.addItem(t.itemType,i,e),p.gameCore.itemGaugeTray.showItemName(t.itemType)}else{p.gameCore.vibrationCntr=10;for(var h=0;3>h;h++)u(this)}},n.prototype.reset=function(){this.type=o.PLAYER,this.pos={x:(m.width-m.assets.player.width)/2,y:m.height-2*m.assets.player.height},this.hp=n.MAX_HP,this.score=0,this.bulletCntr=0,this.bulletInterval=10,this.shieldCntr=0,this.homingCntr=0,this.rapidFireCntr=0,this.bulletSpeedCntr=0,this.piercingCntr=0},n.prototype.move=function(t,e){this.pos.x+=t,this.pos.y+=e,this.pos.x=Math.max(0,Math.min(m.width-this.spr.width,this.pos.x)),this.pos.y=Math.max(0,Math.min(m.height-this.spr.height,this.pos.y))},n.prototype.update=function(){if(this.hp<=0)return!1;var t=this.rapidFireCntr>0?this.bulletInterval/2:this.bulletInterval,e=this.bulletSpeedCntr>0?16:8,i=this.piercingCntr>0?3:1,s=this.homingCntr>0;if(this.bulletCntr%t===0){var r=new C(o.PLAYER_BULLET,[o.ENEMY],{x:this.pos.x+this.spr.width/2,y:this.pos.y},{x:0,y:-e},i,s,m.assets.missle);p.gameCore.entities.push(r)}return this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.bulletCntr++,this.shieldCntr>0&&this.shieldCntr--,this.homingCntr>0&&this.homingCntr--,this.rapidFireCntr>0&&this.rapidFireCntr--,this.bulletSpeedCntr>0&&this.bulletSpeedCntr--,this.piercingCntr>0&&this.piercingCntr--,!0},n.prototype.destroy=function(){this.spr.destroy()},i.exports=n}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["gameScene"] = function(g) {
			!function(e,t,n,o,a){function r(){var e=new g.Scene({game:l});return e.loaded.handle(function(){i.gameCore=new p(e);var n=!1;e.pointDownCapture.handle(function(){n=!0}),e.pointMoveCapture.handle(function(e){n&&i.gameCore.player.move(e.prevDelta.x,e.prevDelta.y)}),e.pointUpCapture.handle(function(){n=!1});var o=!1;e.update.handle(function(){i.gameCore.update(),!o&&i.gameCore.player.hp<=0&&(e.pointDownCapture.removeAll(),e.pointMoveCapture.removeAll(),e.pointUpCapture.removeAll(),e.setTimeout(1e3,function(){var n=new u;i.gameCore.entities.push(n);var o=l.assets.returnButton,a=new g.Sprite({scene:e,src:o,x:(l.width-o.width)/2,y:(l.height-o.height)/4*3,touchable:!0});a.pointDown.handle(function(){a.x+=4,a.y+=4,a.modified()}),a.pointUp.handle(function(){a.x-=4,a.y-=4,a.touchable=!1,a.modified(),n.playBackwards(),e.setTimeout(n.cntr/l.fps*1e3+500,function(){var e=t("titleScene");l.replaceScene(e())})}),e.append(a)}),o=!0)}),i.gameCore.start()}),e}var i=t("Global"),p=(t("Math"),t("EntityType"),t("titleScene"),t("GameCore")),u=t("GameOverLogo"),l=g.game;n.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Global"] = function(g) {
			!function(e,o,l,m,n){l.exports={gameCore:null,bmpFont:null,hiScore:0}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["ItemType"] = function(g) {
			!function(e,E,o,I,g){o.exports={SHIELD:0,HOMING:1,RAPIDFIRE:2,BULLETSPEED:3,PIERCING:4,RECOVER:5}}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Shield"] = function(g) {
			!function(t,e,s,i,r){function o(t,e){this.type=h.OBSTACLE,this.obstacles=[h.ENEMY_BULLET],this.pos={x:0,y:0},this.idx=t,this.numFellow=e,this.hp=9999,this.cntr=0,this.spr=new g.Sprite({scene:p.gameCore.scene,src:a.assets.shield}),p.gameCore.gameLayer.append(this.spr),this.update()}var p=e("Global"),h=e("EntityType"),a=g.game;o.prototype.update=function(){if(p.gameCore.player.shieldCntr<=0)return!1;var t=40,e=4*this.cntr+2*Math.PI*(this.idx/this.numFellow),s=p.gameCore.player.spr.x+p.gameCore.player.spr.width/2,i=p.gameCore.player.spr.y+p.gameCore.player.spr.height/2;return this.pos.x=s+Math.cos(e)*t-this.spr.width/2,this.pos.y=i+Math.sin(e)*t-this.spr.height/2,this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.cntr++,!0},o.prototype.onCollision=function(t){t.hp--},o.prototype.destroy=function(){this.spr.destroy()},s.exports=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Bullet"] = function(g) {
			!function(t,s,i,h,e){function o(t,s,i,h,e,o,r,a,n){this.type=t,this.obstacles=s,this.pos={x:i.x,y:i.y},this.prevPos={x:i.x,y:i.y},this.vel={x:h.x,y:h.y},this.hp=e,this.homing=o,this.th=n?n:0,this.life=a,this.point=0,this.pos.x-=l/2,this.spr=new g.E({scene:p.gameCore.scene,width:l,height:x,x:this.pos.x,y:this.pos.y}),this.spr.append(new g.Sprite({scene:p.gameCore.scene,src:r,x:(l-r.width)/2})),p.gameCore.gameLayer.append(this.spr)}function r(t,s){this.entity=t,this.dir=s,this.cntr=0,this.life=3}var p=s("Global"),a=s("Math"),n=s("EntityType"),y=s("Particle"),d=g.game,l=8,x=8;o.prototype.update=function(){if(this.hp<=0)return!1;if(this.prevPos.x=this.pos.x,this.prevPos.y=this.pos.y,this.homing){var t=this.type===n.PLAYER_BULLET?p.gameCore.findEnemy():p.gameCore.player;if(t&&t.hp>0){for(var s=t.pos.x+t.spr.width/2-this.pos.x,i=t.pos.y+t.spr.height/2-this.pos.y,h=Math.atan2(-i,s)-Math.PI/2,e=h-this.th;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;var o=Math.PI*(5/180);e=Math.max(-o,Math.min(o,e)),this.th+=e}var r=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y),a=Math.cos(this.th),y=Math.sin(this.th);this.pos.x+=-y*r,this.pos.y-=a*r,this.life<=0&&(this.homing=!1,this.vel.x=-y*r*2.5,this.vel.y=-a*r*2.5)}else this.pos.x+=this.vel.x,this.pos.y+=this.vel.y;return this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.angle=-this.th/Math.PI*180,this.spr.modified(),this.life--,!(this.pos.x<-this.spr.width||this.pos.x>d.width||this.pos.y<-this.spr.height||this.pos.y>d.height)},o.prototype.onCollision=function(t){this.hp--,t.hp--;var s=null;t.hp>0&&(s={x:this.pos.x-this.prevPos.x,y:this.pos.y-this.prevPos.y}),p.gameCore.entities.push(new r(t,s)),0===t.hp&&t.point&&(p.gameCore.player.score+=t.point,p.hiScore<p.gameCore.player.score&&(p.hiScore=p.gameCore.player.score))},o.prototype.destroy=function(){this.spr.destroy()},r.prototype.update=function(){for(var t=0;4>t;t++){var s=100+200*a.random(),i=a.random()*Math.PI*2,h=null;if(this.dir){var e=Math.sqrt(this.dir.x*this.dir.x+this.dir.y*this.dir.y);if(e>0){var o=this.dir.x/e,r=this.dir.y/e,n=(a.random()+a.random()+a.random())/3,i=-Math.PI/4+Math.PI/2*n;h={x:(Math.cos(i)*o-Math.sin(i)*r)*s,y:(Math.sin(i)*o+Math.cos(i)*r)*s}}}h=h||{x:s*Math.cos(i),y:s*Math.sin(i)};var l=new y({pos:{x:this.entity.pos.x+this.entity.spr.width/2,y:this.entity.pos.y+this.entity.spr.height/2},vel:h,drag:0,grav:0,life:d.fps,cssColor:a.random()<.33?"Yellow":a.random()<.5?"Red":"White",width:2,height:4,onUpdate:function(t){var s=t.life-t.cntr;8>s&&(t.spr.opacity=.7*s/8),t.spr.angle+=180/d.fps,t.spr.modified()}});l.spr.angle=180*a.random(),l.spr.opacity=.7,p.gameCore.entities.push(l)}return this.cntr++,this.cntr<this.life},r.prototype.destroy=function(){},i.exports=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Particle"] = function(g) {
			!function(s,t,e,i,h){function r(s){this.type=p.EFFECT,this.cntr=0,this.pos={x:s.pos.x,y:s.pos.y},this.vel=s.vel?{x:s.vel.x,y:s.vel.y}:{x:0,y:0},this.drag=s.drag||0,this.grav=s.grav||0,this.life=s.life,this.onUpdate=s.onUpdate,s.asset?this.spr=new g.Sprite({scene:o.gameCore.scene,src:s.asset,x:this.pos.x,y:this.pos.y,width:s.width||s.asset.width,height:s.height||s.asset.height,srcX:s.srcX||0,srcY:s.srcY||0}):this.spr=new g.FilledRect({scene:o.gameCore.scene,cssColor:s.cssColor,width:s.width,height:s.height,x:this.pos.x,y:this.pos.y}),this.spr.compositeOperation=g.CompositeOperation.Lighter,o.gameCore.gameLayer.append(this.spr)}var o=t("Global"),p=t("EntityType"),a=g.game;r.prototype.update=function(){if(this.cntr===this.life)return!1;var s=1/a.fps,t={x:-this.vel.x*this.drag,y:-this.vel.y*this.drag+this.grav};return this.vel.x+=t.x*s,this.vel.y+=t.y*s,this.pos.x+=this.vel.x*s,this.pos.y+=this.vel.y*s,this.onUpdate&&this.onUpdate(this),this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.cntr++,!0},r.prototype.destroy=function(){this.spr.destroy()},e.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["emmitDamageEffect"] = function(g) {
			!function(e,s,a,r,t){function i(e){var s=p.random()*Math.PI*2,a=750,r=l.assets.particle,t=new n({pos:{x:e.pos.x+e.spr.width/2,y:e.pos.y+e.spr.height/2},vel:{x:a*Math.cos(s),y:a*Math.sin(s)},drag:4,grav:500,life:l.fps,asset:r,onUpdate:function(e){if(e.vel.y>0&&(e.spr.opacity*=.9),e.cntr%3===0){var s=new n({pos:e.pos,vel:{x:0,y:0},drag:0,grav:0,life:8,asset:r,onUpdate:function(e){e.spr.opacity*=.9,e.spr.modified()}});s.spr.opacity=e.spr.opacity,o.gameCore.entities.push(s)}}});t.spr.scaleX=2,t.spr.scaleY=2,t.spr.modified(),o.gameCore.entities.push(t)}var o=s("Global"),p=s("Math"),n=s("Particle"),l=g.game;a.exports=i}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Enemy"] = function(g) {
			!function(t,e,i,o,s){function n(t,e,i,o,s){this.type=h.ENEMY,this.cntr=0,this.pos={x:t.x,y:t.y},this.obstacles=[h.PLAYER],this.hp=e,this.point=i,this.itemTypes=o,this.spr=s,p.gameCore.gameLayer.append(this.spr)}var p=e("Global"),r=e("Math"),h=e("EntityType"),a=(e("ItemType"),e("Item"));g.game;n.prototype.onUpdate=function(){return!0},n.prototype.onDied=function(){if(this.itemTypes&&0!==this.itemTypes.length){var t=this.itemTypes[Math.floor(r.random()*this.itemTypes.length)],e=new a(this.pos,t);p.gameCore.entities.push(e)}},n.prototype.update=function(){if(this.hp<=0)return this.onDied(),!1;var t=this.onUpdate(this);return this.cntr++,t},n.prototype.onCollision=function(t){t.hp--},n.prototype.destroy=function(){this.spr.destroy()},i.exports=n}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Item"] = function(g) {
			!function(t,e,s,i,o){function p(t,e){this.type=h.ITEM,this.itemType=e,this.originX=t.x,this.pos={x:t.x,y:t.y},this.cntr=0,this.hp=1,this.spr=new g.Sprite({scene:r.gameCore.scene,src:m.assets[p.itemImageNames[e]],x:this.pos.x,y:this.pos.y}),r.gameCore.gameLayer.append(this.spr)}var r=e("Global"),h=e("EntityType"),m=g.game;p.itemImageNames=["item01","item02","item03","item04","item05","item06"],p.prototype.update=function(){return this.hp<=0?!1:(this.pos.x=this.originX+48*Math.sin(Math.PI*this.cntr/18),this.pos.y+=3,this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.cntr++,!0)},p.prototype.destroy=function(){this.spr.destroy()},s.exports=p}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["ItemGaugeTray"] = function(g) {
			!function(t,e,s,i,r){function h(t,e,s,i,r){this.pos={x:t.x,y:t.y},this.type=n.EFFECT,this.itemType=e,this.max=s,this.getter=i,this.tray=r;var h=d.assets[p.itemImageNames[e]];this.spr=new g.Sprite({scene:o.gameCore.scene,src:h,x:t.x,y:t.y}),o.gameCore.hudLayer.append(this.spr),this.bar=new g.FilledRect({scene:o.gameCore.scene,cssColor:"#FFB0B0",width:h.width,height:m,x:0,y:h.height+2}),this.spr.append(this.bar)}function a(){this.cntr=0,this.gauges=[],this.spr=new g.Label({scene:o.gameCore.scene,text:"",font:o.bmpFont,fontSize:16,x:4,y:d.height-(d.assets.item01.height+m+20)}),o.gameCore.hudLayer.append(this.spr)}var o=e("Global"),n=e("EntityType"),p=e("Item"),d=g.game,m=4,u=["SHIELD","HOMING","RAPIDFIRE","BULLETSPEED","PIERCING","RECOVER"];h.prototype.update=function(){var t=this.getter()/this.max;return 0>=t?!1:(this.bar.width=16*t,this.bar.modified(),!0)},h.prototype.destroy=function(){this.tray&&this.tray.remove(this),this.spr.destroy()},a.prototype.addItem=function(t,e,s){var i=new h({x:d.width,y:d.height-(d.assets.item01.height+m+4)},t,e,s,this);o.gameCore.entities.push(i),this.gauges.push(i)},a.prototype.showItemName=function(t){this.spr.text=u[t],this.spr.invalidate(),this.cntr=0},a.prototype.update=function(){for(var t=4,e=t,s=0;s<this.gauges.length;s++){var i=this.gauges[s];if(i.spr.x>e){var r=.85*(i.spr.x-e);i.spr.x=e+(r>1?r:0),i.spr.modified()}e+=i.spr.width+t}return this.cntr>=90&&(this.spr.text="",this.spr.invalidate()),this.cntr++,!0},a.prototype.remove=function(t){var e=this.gauges.indexOf(t);-1!==e&&this.gauges.splice(e,1)},a.prototype.destroy=function(){},s.exports=a}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["AlphaEnemy"] = function(g) {
			!function(t,s,e,i,o){function r(){var t=m.assets.alphaEnemy,s={x:h.random()*(m.width-t.width),y:-32*h.random()-32},e=[n.RECOVER];l.call(this,s,4,20,e,new g.Sprite({scene:p.gameCore.scene,src:t,x:s.x,y:s.y})),this.targetPosition=null}var p=s("Global"),h=s("Math"),a=s("EntityType"),n=s("ItemType"),y=s("Bullet"),l=s("Enemy"),m=g.game;r.prototype=Object.create(l.prototype),r.prototype.onUpdate=function(){return this.cntr<m.fps?this.pos.y+=4:this.cntr<3*m.fps?(this.cntr===m.fps&&(this.targetPosition={x:p.gameCore.player.pos.x,y:p.gameCore.player.pos.y}),this.cntr%3===0&&this.fire(this.targetPosition)):this.pos.y+=8,this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.pos.y<m.height},r.prototype.fire=function(t){var s=m.assets.alphaEnemy,e=t.x-this.pos.x,i=t.y-this.pos.y,o=Math.sqrt(e*e+i*i);if(o>0){e/=o,i/=o;var r=new y(a.ENEMY_BULLET,[a.PLAYER],{x:this.pos.x+s.width/2,y:this.pos.y+s.height},{x:8*e,y:8*i},2,!1,m.assets.ball);p.gameCore.entities.push(r)}},e.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["BetaEnemy"] = function(g) {
			!function(t,s,i,e,o){function h(){var t=d.assets.betaEnemy,s=r.random()*(d.width-t.width),i=-40,e=[p.SHIELD,p.HOMING,p.RAPIDFIRE,p.BULLETSPEED,p.PIERCING];m.call(this,{x:s,y:i},1,10,e,new g.Sprite({scene:n.gameCore.scene,src:t,x:s,y:i})),this.dropPointY=r.random()*(d.height/3)+32,this.origin={x:this.pos.x,y:this.pos.y},this.cntrOffset=30*r.random()|0,this.moveDown=!0}var n=s("Global"),r=s("Math"),a=s("EntityType"),p=s("ItemType"),y=s("Bullet"),m=s("Enemy"),d=g.game;h.prototype=Object.create(m.prototype),h.prototype.onUpdate=function(){var t=d.assets.betaEnemy;this.moveDown&&(this.origin.y+=8,this.pos.y>=this.dropPointY&&(this.moveDown=!1));var s=this.cntr+this.cntrOffset;if(this.pos.x=this.origin.x+80*Math.sin(s/45*Math.PI),this.pos.y=this.origin.y+24*Math.sin(s/20*Math.PI),this.cntr%3===0&&r.random()<.1){var i=new y(a.ENEMY_BULLET,[a.PLAYER],{x:this.pos.x+t.width/2,y:this.pos.y+t.height},{x:0,y:8},2,!1,d.assets.ball);n.gameCore.entities.push(i)}return this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.cntr++,!0},i.exports=h}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["GammaEnemy"] = function(g) {
			!function(s,t,e,i,a){function r(){var s=l.assets.gammaEnemy,t=s.width,e=s.height,i=(l.width-t)/2,a=-e;c.call(this,{x:i,y:a},9999,100,[],new g.Sprite({scene:o.gameCore.scene,src:s,x:i,y:a})),r.numInstance++}var o=t("Global"),h=t("Math"),p=t("EntityType"),n=(t("ItemType"),t("Bullet")),c=t("Enemy"),y=t("Particle"),m=t("emmitDamageEffect"),l=g.game;r.numInstance=0,r.prototype=Object.create(c.prototype),r.prototype.onDied=function(){c.prototype.onDied.call(this);for(var s=l.assets.gammaEnemy,t=8,e=s.width/t,i=s.height/t,a=0;t>a;a++)for(var r=i*a,p=0;t>p;p++){var n=150+250*h.random(),d=h.random()*Math.PI*2,f=e*p,u=2*Math.PI*h.random(),x=1+h.random(),M=new y({pos:{x:this.pos.x+f,y:this.pos.y+r},vel:{x:n*Math.cos(d),y:n*Math.sin(d)},life:1.2*l.fps|0,asset:s,width:e,height:i,srcX:f,srcY:r,onUpdate:function(s){var t=2*Math.PI/l.fps*s.cntr+u;s.spr.scaleX=x*Math.cos(t),s.spr.scaleY=x*Math.sin(t);var e=s.life-s.cntr;8>e&&(s.spr.opacity=e/8),s.spr.modified()}});M.spr.compositeOperation=g.CompositeOperation.SourceOver,a%2===0&&(M.spr.scaleX=4,M.spr.scaleY=4),o.gameCore.entities.push(M),m(M)}},r.prototype.onUpdate=function(){var s=50;if(this.cntr<s)this.pos.y+=4;else{this.cntr===s&&(this.hp=16);var t=(this.cntr-s)%540;if(180>t){if(t%3===0){var e=2*Math.PI/180*t,i=new n(p.ENEMY_BULLET,[p.PLAYER],{x:this.pos.x+this.spr.width/2,y:this.pos.y+this.spr.height/2},{x:8*Math.sin(e),y:8*Math.cos(e)},2,!1,l.assets.ball);o.gameCore.entities.push(i),e=-e;var i=new n(p.ENEMY_BULLET,[p.PLAYER],{x:this.pos.x+this.spr.width/2,y:this.pos.y+this.spr.height/2},{x:8*Math.sin(e),y:8*Math.cos(e)},2,!1,l.assets.ball);o.gameCore.entities.push(i)}}else if(360>t&&t%60===0){var i=new n(p.ENEMY,[p.PLAYER],{x:this.pos.x+this.spr.width/8,y:this.pos.y},{x:0,y:4},1,!0,l.assets.enemyMissile,5*l.fps,Math.PI/4);o.gameCore.entities.push(i);var i=new n(p.ENEMY,[p.PLAYER],{x:this.pos.x+this.spr.width/8*7,y:this.pos.y},{x:0,y:4},1,!0,l.assets.enemyMissile,5*l.fps,-Math.PI/4);o.gameCore.entities.push(i)}}return this.spr.x=this.pos.x,this.spr.y=this.pos.y,this.spr.modified(),this.cntr++,!0},r.prototype.destroy=function(){r.numInstance--,c.prototype.destroy.call(this)},e.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["EnemyManager"] = function(g) {
			!function(e,t,n,r,i){function o(){this.cntr=0}var s=t("Global"),a=t("Math"),m=t("EntityType"),p=t("AlphaEnemy"),u=t("BetaEnemy"),f=t("GammaEnemy"),h=g.game;o.prototype.countEnemy=function(){for(var e=0,t=0;t<s.gameCore.entities.length;t++){var n=s.gameCore.entities[t];n&&n.type===m.ENEMY&&e++}return e},o.prototype.update=function(){if(this.cntr===3*h.fps)for(var e=0;4>e;e++)s.gameCore.entities.push(new u);else if(this.cntr===18*h.fps)for(var e=0;4>e;e++)s.gameCore.entities.push(new p);else if(this.cntr===23*h.fps)s.gameCore.entities.push(new u),s.gameCore.entities.push(new p),s.gameCore.entities.push(new u),s.gameCore.entities.push(new p);else if(this.cntr>=30*h.fps){var t=this.countEnemy();if(2>t||5>t&&a.random()<.5){var n=a.random(),r=null;.05>n?r=0===f.numInstance&&.025>n?new f:new u:.1>n&&(r=new p),r&&s.gameCore.entities.push(r)}}return this.cntr++,!0},o.prototype.destroy=function(){},n.exports=o}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["Background"] = function(g) {
			!function(t,e,r,i,s){function n(){this.type=a.EFFECT,this.cntr=0,this.rgb={r:0,g:191/255,b:32/255},this.spr=new g.FilledRect({scene:o.gameCore.scene,cssColor:"#1E90FF",width:d.width,height:d.height}),o.gameCore.backgroundLayer.append(this.spr)}var o=e("Global"),h=e("Math"),a=e("EntityType"),d=g.game;n.prototype.update=function(){if(this.cntr<=60){var t=Math.min(1,this.cntr/60),e=Math.round(0*t+30*(1-t)),r=Math.round(0*t+144*(1-t)),i=Math.round(32*t+255*(1-t));this.spr.cssColor="#"+("000000"+(e<<16|r<<8|i).toString(16)).slice(-6),this.spr.modified()}if(this.cntr%4===0&&h.random()<.5){var s=h.random()<.25,n=d.assets[s?"star01":"star02"],a=new g.Sprite({scene:o.gameCore.scene,src:n,x:h.random()*(d.width-n.width),y:-n.height});a.modified();var c=this;a.update.handle(function(){var t=Math.min(1,c.cntr/60),e=s?8:4;e+=2.5*e*(1-t),a.y+=e,a.modified(),a.y>=d.height&&a.destroy()}),this.spr.append(a)}return this.cntr++,!0},n.prototype.destroy=function(){this.spr.destroy()},r.exports=n}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["GameCore"] = function(g) {
			!function(t,e,i,s,n){function r(t){this.scene=t,this.cntr=0,this.vibrationCntr=0,this.entities=[],this.background=null,this.player=null,this.itemGaugeTray=null,this.playerStatus=null,this.enemyManager=null,this.hudLayer=new g.E({scene:this.scene}),this.backgroundLayer=new g.E({scene:this.scene}),this.gameLayer=new g.E({scene:this.scene}),this.scene.append(this.backgroundLayer),this.scene.append(this.gameLayer),this.scene.append(this.hudLayer),y.numInstance=0}var a=(e("Global"),e("Math")),h=e("EntityType"),o=e("Player"),u=e("ItemGaugeTray"),p=e("EnemyManager"),y=e("GammaEnemy"),l=e("Background"),c=e("PlayerStatus");r.prototype.start=function(){this.background=new l,this.entities.push(this.background),this.itemGaugeTray=new u,this.entities.push(this.itemGaugeTray),this.player=new o,this.entities.push(this.player),this.playerStatus=new c,this.entities.push(this.playerStatus),this.enemyManager=new p,this.entities.push(this.enemyManager)},r.prototype.update=function(){this.vibrationCntr>=5?(this.gameLayer.x=32*a.random()/2-16,this.gameLayer.y=32*a.random()/2-16):(this.gameLayer.x=0,this.gameLayer.y=0),this.gameLayer.modified(),0<this.vibrationCntr&&this.vibrationCntr<5||(this.collisionDetection(),this.updateEntities()),this.entities=this.entities.filter(function(t){return!!t}),this.vibrationCntr>0&&this.vibrationCntr--,this.cntr++},r.prototype.updateEntities=function(){for(var t=this.entities.length,e=0;t>e;e++){var i=this.entities[e];i&&(i.update()||(i.destroy(),this.entities[e]=null))}},r.prototype.findEnemy=function(){for(var t=null,e=this.entities.length,i=Number.MAX_VALUE,s=0;e>s;s++){var n=this.entities[s];if(n&&n.type==h.ENEMY){var r=n.pos.x-this.player.pos.x,a=n.pos.y-this.player.pos.y,o=r*r+a*a;i>o&&(i=o,t=n)}}return t},r.prototype.collisionDetection=function(){for(var t=this.entities.length,e=0;t>e;e++){var i=this.entities[e];i&&i.spr&&i.obstacles&&i.onCollision&&this.intersect(i)}},r.prototype.intersect=function(t){for(var e=this.entities.length,i=0;e>i;i++){var s=this.entities[i];s&&s!==t&&s.spr&&-1!==t.obstacles.indexOf(s.type)&&a.intersectArea(t.spr,s.spr)&&t.onCollision(s)}},i.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["GameOverLogo"] = function(g) {
			!function(t,s,e,n,i){function r(){this.cntr=0,this.span=a.fps,this.pulses=[],this.countDown=!1;var t=a.assets.gameover;this.spr=new g.E({scene:h.gameCore.scene,x:(a.width-t.width)/2,y:(a.height-t.height)/3*1});for(var s=0;s<t.height;s++){var e=new g.Sprite({scene:h.gameCore.scene,src:t,x:0,y:s,width:t.width,height:1,srcY:s});this.spr.append(e)}this.update(),h.gameCore.scene.append(this.spr)}var h=s("Global"),o=s("Math"),a=g.game;r.prototype.playBackwards=function(){this.countDown=!0,this.cntr=this.span},r.prototype.glitch=function(){var t={cntr:0,life:Math.floor(2+4*o.random()),pos:Math.floor(a.assets.gameover.height*o.random()),len:Math.floor(4+16*o.random()),amp:10+70*o.random(),mov:o.random()<.5?o.random()<.5?2:-2:0};this.pulses.push(t)},r.prototype.update=function(){this.cntr>this.span+1.5*a.fps&&o.random()<.1&&this.glitch();for(var t=this.spr.children,s=Math.max(0,(this.span-this.cntr)/this.span),e=0;e<t.length;e++){var n=t[e],i=4*Math.PI*e/t.length+Math.PI*s*2,r=90*s;n.x=r*Math.sin(i),n.opacity=Math.min(1,3*(1-s)),n.modified()}for(var e=0;e<this.pulses.length;e++){for(var h=this.pulses[e],s=h.cntr/h.life,p=h.pos;p<Math.min(h.pos+h.len,t.length);p++)if(!(0>p)){var c=(p-h.pos)/h.len,i=2*Math.PI*c,l=Math.sin(i)*h.amp*Math.sin(Math.PI*s),n=t[p];n.x+=l,n.modified()}h.cntr++,h.pos+=h.mov,h.cntr>=h.life&&(this.pulses[e]=null)}return this.pulses=this.pulses.filter(function(t){return!!t}),this.countDown?(this.cntr--,this.cntr<0&&(this.cntr=0)):this.cntr++,!0},r.prototype.destroy=function(){this.spr.destroy()},e.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["PlayerStatus"] = function(g) {
			!function(e,t,a,o,r){function i(){this.scoreLabel=new g.Label({scene:h.gameCore.scene,text:"",font:h.bmpFont,fontSize:16,x:4,y:4}),h.gameCore.hudLayer.append(this.scoreLabel),this.hiScoreLabel=new g.Label({scene:h.gameCore.scene,text:"",font:h.bmpFont,fontSize:16,x:n.width-148,y:4}),h.gameCore.hudLayer.append(this.hiScoreLabel),this.hpGauge=new g.E({scene:h.gameCore.scene});var e=this.hpGauge.getMatrix()._matrix;this.hpGauge.angle=.001;var t=-Math.PI/6;e[0]=Math.cos(t),e[1]=0,e[2]=Math.sin(t),e[3]=1,this.hpGauge.getMatrix().update=function(){};for(var a=28,o=0;o<s.MAX_HP;o++){var r=new g.FilledRect({scene:h.gameCore.scene,width:8,height:16,x:a,y:24,cssColor:"Yellow"});a+=r.width+4,this.hpGauge.append(r)}h.gameCore.hudLayer.append(this.hpGauge)}var h=t("Global"),s=t("Player"),n=g.game;i.prototype.update=function(){this.scoreLabel.text="SCORE "+("00000"+h.gameCore.player.score).slice(-6),this.scoreLabel.invalidate(),this.hiScoreLabel.text="HI "+("00000"+h.hiScore).slice(-6),this.hiScoreLabel.invalidate();for(var e=this.hpGauge.children,t=0;t<e.length;t++){var a=e[t];a.cssColor=t<h.gameCore.player.hp?"Yellow":"Red",a.modified()}return!0},i.prototype.destroy=function(){this.scoreLabel.destroy(),this.hpLabel.destroy(),this.hpGauge.destroy()},a.exports=i}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["bootScene"] = function(g) {
			!function(e,t,i,s,a){function h(e){g.E.prototype.constructor.call(this,e),this.surface=g.Util.asSurface(e.src),this.backSurface=n.resourceFactory.createSurface(n.width,n.height),this.cntr=0,this.seg=0,this.maxLineScale=8,this.lineScale=this.maxLineScale,this.opacity=0}function r(){var e=new g.Scene({game:n});return e.loaded.handle(function(){var t=n.assets.akashic,i=new h({scene:e,src:t,width:t.width,height:t.height});i.update.handle(function(){i.modified()}),e.append(i)}),e}var c=t("titleScene"),n=g.game;h.prototype=Object.create(g.E.prototype),h.prototype.__update=function(){var e=this.maxLineScale/(2*n.fps);0===this.seg?(this.lineScale-=e,this.lineScale<-3&&this.seg++):1===this.seg?(this.lineScale+=e/2,this.lineScale>0&&(this.lineScale=0,this.seg++)):2===this.seg&&(this.scene.setTimeout(2e3,function(){n.replaceScene(c())}),this.seg++),this.opacity=Math.min(1,this.opacity+1/(3*n.fps)),this.cntr++},h.prototype.lineLoop=function(e){for(var t=1*Math.PI/this.height,i=Math.PI/n.fps*this.cntr,s=0,a=0;a<this.height;a++){var h=t*a+i,r=1+(Math.cos(h)+1)/2*this.lineScale;e&&e(r,s,a),s+=r}return s},h.prototype.renderSelf=function(e,t){var i=this.backSurface.renderer();i.begin(),i.fillRect(0,0,this.backSurface.width,this.backSurface.height,"White"),i.save();var s=this.lineLoop(),a=(n.width-this.width)/2,h=(n.height-s)/2;return this.lineLoop(function(e,t,s){i.save(),i.transform([1,0,0,2*e,a,t+h]),i.drawImage(this.surface,0,s,this.width,1,0,0),i.restore()}.bind(this)),i.restore(),i.end(),e.save(),e.drawImage(this.backSurface,0,0,this.backSurface.width,this.backSurface.height,0,0),e.restore(),this.__update(),!0},h.prototype.destroy=function(){this.backSurface.destroy(),g.E.prototype.destroy.call(this)},i.exports=r}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);		};
				window.gLocalAssetContainer["glyph_area"] = "{%0A  %2232%22: {%0A    %22x%22: 0,%0A    %22y%22: 0%0A  },%0A  %2233%22: {%0A    %22x%22: 16,%0A    %22y%22: 0%0A  },%0A  %2234%22: {%0A    %22x%22: 32,%0A    %22y%22: 0%0A  },%0A  %2235%22: {%0A    %22x%22: 48,%0A    %22y%22: 0%0A  },%0A  %2236%22: {%0A    %22x%22: 64,%0A    %22y%22: 0%0A  },%0A  %2237%22: {%0A    %22x%22: 80,%0A    %22y%22: 0%0A  },%0A  %2238%22: {%0A    %22x%22: 96,%0A    %22y%22: 0%0A  },%0A  %2239%22: {%0A    %22x%22: 112,%0A    %22y%22: 0%0A  },%0A  %2240%22: {%0A    %22x%22: 128,%0A    %22y%22: 0%0A  },%0A  %2241%22: {%0A    %22x%22: 144,%0A    %22y%22: 0%0A  },%0A  %2242%22: {%0A    %22x%22: 160,%0A    %22y%22: 0%0A  },%0A  %2243%22: {%0A    %22x%22: 176,%0A    %22y%22: 0%0A  },%0A  %2244%22: {%0A    %22x%22: 192,%0A    %22y%22: 0%0A  },%0A  %2245%22: {%0A    %22x%22: 208,%0A    %22y%22: 0%0A  },%0A  %2246%22: {%0A    %22x%22: 224,%0A    %22y%22: 0%0A  },%0A  %2247%22: {%0A    %22x%22: 240,%0A    %22y%22: 0%0A  },%0A  %2248%22: {%0A    %22x%22: 0,%0A    %22y%22: 16%0A  },%0A  %2249%22: {%0A    %22x%22: 16,%0A    %22y%22: 16%0A  },%0A  %2250%22: {%0A    %22x%22: 32,%0A    %22y%22: 16%0A  },%0A  %2251%22: {%0A    %22x%22: 48,%0A    %22y%22: 16%0A  },%0A  %2252%22: {%0A    %22x%22: 64,%0A    %22y%22: 16%0A  },%0A  %2253%22: {%0A    %22x%22: 80,%0A    %22y%22: 16%0A  },%0A  %2254%22: {%0A    %22x%22: 96,%0A    %22y%22: 16%0A  },%0A  %2255%22: {%0A    %22x%22: 112,%0A    %22y%22: 16%0A  },%0A  %2256%22: {%0A    %22x%22: 128,%0A    %22y%22: 16%0A  },%0A  %2257%22: {%0A    %22x%22: 144,%0A    %22y%22: 16%0A  },%0A  %2258%22: {%0A    %22x%22: 160,%0A    %22y%22: 16%0A  },%0A  %2259%22: {%0A    %22x%22: 176,%0A    %22y%22: 16%0A  },%0A  %2260%22: {%0A    %22x%22: 192,%0A    %22y%22: 16%0A  },%0A  %2261%22: {%0A    %22x%22: 208,%0A    %22y%22: 16%0A  },%0A  %2262%22: {%0A    %22x%22: 224,%0A    %22y%22: 16%0A  },%0A  %2263%22: {%0A    %22x%22: 240,%0A    %22y%22: 16%0A  },%0A  %2264%22: {%0A    %22x%22: 0,%0A    %22y%22: 32%0A  },%0A  %2265%22: {%0A    %22x%22: 16,%0A    %22y%22: 32%0A  },%0A  %2266%22: {%0A    %22x%22: 32,%0A    %22y%22: 32%0A  },%0A  %2267%22: {%0A    %22x%22: 48,%0A    %22y%22: 32%0A  },%0A  %2268%22: {%0A    %22x%22: 64,%0A    %22y%22: 32%0A  },%0A  %2269%22: {%0A    %22x%22: 80,%0A    %22y%22: 32%0A  },%0A  %2270%22: {%0A    %22x%22: 96,%0A    %22y%22: 32%0A  },%0A  %2271%22: {%0A    %22x%22: 112,%0A    %22y%22: 32%0A  },%0A  %2272%22: {%0A    %22x%22: 128,%0A    %22y%22: 32%0A  },%0A  %2273%22: {%0A    %22x%22: 144,%0A    %22y%22: 32%0A  },%0A  %2274%22: {%0A    %22x%22: 160,%0A    %22y%22: 32%0A  },%0A  %2275%22: {%0A    %22x%22: 176,%0A    %22y%22: 32%0A  },%0A  %2276%22: {%0A    %22x%22: 192,%0A    %22y%22: 32%0A  },%0A  %2277%22: {%0A    %22x%22: 208,%0A    %22y%22: 32%0A  },%0A  %2278%22: {%0A    %22x%22: 224,%0A    %22y%22: 32%0A  },%0A  %2279%22: {%0A    %22x%22: 240,%0A    %22y%22: 32%0A  },%0A  %2280%22: {%0A    %22x%22: 0,%0A    %22y%22: 48%0A  },%0A  %2281%22: {%0A    %22x%22: 16,%0A    %22y%22: 48%0A  },%0A  %2282%22: {%0A    %22x%22: 32,%0A    %22y%22: 48%0A  },%0A  %2283%22: {%0A    %22x%22: 48,%0A    %22y%22: 48%0A  },%0A  %2284%22: {%0A    %22x%22: 64,%0A    %22y%22: 48%0A  },%0A  %2285%22: {%0A    %22x%22: 80,%0A    %22y%22: 48%0A  },%0A  %2286%22: {%0A    %22x%22: 96,%0A    %22y%22: 48%0A  },%0A  %2287%22: {%0A    %22x%22: 112,%0A    %22y%22: 48%0A  },%0A  %2288%22: {%0A    %22x%22: 128,%0A    %22y%22: 48%0A  },%0A  %2289%22: {%0A    %22x%22: 144,%0A    %22y%22: 48%0A  },%0A  %2290%22: {%0A    %22x%22: 160,%0A    %22y%22: 48%0A  },%0A  %2291%22: {%0A    %22x%22: 176,%0A    %22y%22: 48%0A  },%0A  %2292%22: {%0A    %22x%22: 192,%0A    %22y%22: 48%0A  },%0A  %2293%22: {%0A    %22x%22: 208,%0A    %22y%22: 48%0A  },%0A  %2294%22: {%0A    %22x%22: 224,%0A    %22y%22: 48%0A  },%0A  %2295%22: {%0A    %22x%22: 240,%0A    %22y%22: 48%0A  },%0A  %2296%22: {%0A    %22x%22: 0,%0A    %22y%22: 64%0A  },%0A  %2297%22: {%0A    %22x%22: 16,%0A    %22y%22: 64%0A  },%0A  %2298%22: {%0A    %22x%22: 32,%0A    %22y%22: 64%0A  },%0A  %2299%22: {%0A    %22x%22: 48,%0A    %22y%22: 64%0A  },%0A  %22100%22: {%0A    %22x%22: 64,%0A    %22y%22: 64%0A  },%0A  %22101%22: {%0A    %22x%22: 80,%0A    %22y%22: 64%0A  },%0A  %22102%22: {%0A    %22x%22: 96,%0A    %22y%22: 64%0A  },%0A  %22103%22: {%0A    %22x%22: 112,%0A    %22y%22: 64%0A  },%0A  %22104%22: {%0A    %22x%22: 128,%0A    %22y%22: 64%0A  },%0A  %22105%22: {%0A    %22x%22: 144,%0A    %22y%22: 64%0A  },%0A  %22106%22: {%0A    %22x%22: 160,%0A    %22y%22: 64%0A  },%0A  %22107%22: {%0A    %22x%22: 176,%0A    %22y%22: 64%0A  },%0A  %22108%22: {%0A    %22x%22: 192,%0A    %22y%22: 64%0A  },%0A  %22109%22: {%0A    %22x%22: 208,%0A    %22y%22: 64%0A  },%0A  %22110%22: {%0A    %22x%22: 224,%0A    %22y%22: 64%0A  },%0A  %22111%22: {%0A    %22x%22: 240,%0A    %22y%22: 64%0A  },%0A  %22112%22: {%0A    %22x%22: 0,%0A    %22y%22: 80%0A  },%0A  %22113%22: {%0A    %22x%22: 16,%0A    %22y%22: 80%0A  },%0A  %22114%22: {%0A    %22x%22: 32,%0A    %22y%22: 80%0A  },%0A  %22115%22: {%0A    %22x%22: 48,%0A    %22y%22: 80%0A  },%0A  %22116%22: {%0A    %22x%22: 64,%0A    %22y%22: 80%0A  },%0A  %22117%22: {%0A    %22x%22: 80,%0A    %22y%22: 80%0A  },%0A  %22118%22: {%0A    %22x%22: 96,%0A    %22y%22: 80%0A  },%0A  %22119%22: {%0A    %22x%22: 112,%0A    %22y%22: 80%0A  },%0A  %22120%22: {%0A    %22x%22: 128,%0A    %22y%22: 80%0A  },%0A  %22121%22: {%0A    %22x%22: 144,%0A    %22y%22: 80%0A  },%0A  %22122%22: {%0A    %22x%22: 160,%0A    %22y%22: 80%0A  },%0A  %22123%22: {%0A    %22x%22: 176,%0A    %22y%22: 80%0A  },%0A  %22124%22: {%0A    %22x%22: 192,%0A    %22y%22: 80%0A  },%0A  %22125%22: {%0A    %22x%22: 208,%0A    %22y%22: 80%0A  },%0A  %22126%22: {%0A    %22x%22: 224,%0A    %22y%22: 80%0A  }%0A}%0A";
				window.gLocalAssetContainer["version"] = "1.0.0-d%0A";
	</script>

<script>
	var __extends=this&&this.__extends||function(t,o){function e(){this.constructor=t}for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n]);t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)},LocalScriptAsset=function(t){function o(o,e){var n=t.call(this,o,e)||this;return n.func=window.gLocalAssetContainer[o],n}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.func?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load script asset"))},0)},o.prototype.execute=function(t){return this.func(t),t.module.exports},o}(g.ScriptAsset);	var __extends=this&&this.__extends||function(t,o){function e(){this.constructor=t}for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n]);t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)},LocalTextAsset=function(t){function o(o,e){var n=t.call(this,o,e)||this;return n.data=decodeURIComponent(window.gLocalAssetContainer[o]),n}return __extends(o,t),o.prototype._load=function(t){var o=this;void 0!==this.data?setTimeout(function(){t._onAssetLoad(o)},0):setTimeout(function(){t._onAssetError(o,g.ExceptionFactory.createAssetLoadError("can not load text asset"))},0)},o}(g.TextAsset);	!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.gameStorage=e()}}(function(){return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=e("@akashic/akashic-engine"),o=e("./validator"),i="akst:",a=function(){function e(e,t){this._localStorage=e,this._metaData=t}return e.prototype.set=function(e,t,r){o.validateStorageKey(e),this.expandVariables(e);var i=this.storageKeyToStringKey(e),a=this.getValue(i),u=null;switch(e.region){case n.StorageRegion.Values:u=this.createValuesValue(a,t,r);break;case n.StorageRegion.Counts:u=this.createCountsValue(a,t,r);break;case n.StorageRegion.Scores:u=this.createScoresValue(a,t,r);break;case n.StorageRegion.Slots:throw new Error("Slots is not supported.");default:throw new Error("Unknown region.")}if(u){var s=null,c=new Date;s=a?{data:u.data,tag:u.tag,createdAt:a.createdAt,updatedAt:c}:{data:u.data,tag:u.tag,createdAt:c,updatedAt:c},this.setValue(i,s)}},e.prototype.load=function(e){var t=this,r={};Object.keys(this._localStorage).forEach(function(e){if(0===e.indexOf(i)){var n=e.slice(i.length);r[n]=t.getValue(n)}});var n=[];return e.forEach(function(e){o.validateStorageReadKey(e),t.expandVariables(e);var i=[];if(-1!==e.regionKey.indexOf("*")||"*"===e.userId){var a=t.storageReadKeyToRegExp(e);Object.keys(r).forEach(function(e){if(a.test(e)){var n=r[e],o={data:n.data,storageKey:t.stringKeyToStorageKey(e)};null!=n.tag&&(o.tag=n.tag),i.push(o)}}),e.option&&(void 0!==e.option.valueOrder&&t.sortByValue(i,e.option.valueOrder),void 0!==e.option.keyOrder&&t.sortByRegionKey(i,e.option.keyOrder))}else{var u=t.storageKeyToStringKey(e),s=r[u];if(s){var c={data:s.data,storageKey:{region:e.region,regionKey:e.regionKey,userId:e.userId,gameId:e.gameId}};null!=s.tag&&(c.tag=s.tag),i.push(c)}}n.push(i)}),n},e.prototype.clearAll=function(){var e=this;Object.keys(this._localStorage).forEach(function(t){0===t.indexOf(i)&&e._localStorage.removeItem(t)})},e.prototype.createValuesValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data){if(r.condition!==n.StorageCondition.Equal)throw new Error("Invalid condition.");if(e.data!==r.comparisonValue)return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createScoresValue=function(e,t,r){if(!t)return null;if(r&&null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}var o={data:t.data};return null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsIncrDecrValue=function(e,t,r){var o={data:0},i=0;if(e&&(i=Number(e.data)),null!=r.condition&&null!=r.comparisonValue)switch(r.condition){case n.StorageCondition.Equal:if(i!==r.comparisonValue)return e?null:o;break;case n.StorageCondition.GreaterThan:if(!(i>r.comparisonValue))return e?null:o;break;case n.StorageCondition.LessThan:if(!(i<r.comparisonValue))return e?null:o}if(r.operation===n.StorageCountsOperation.Incr)t&&null!=t.data?o.data=i+Number(t.data):o.data=i+1;else{if(r.operation!==n.StorageCountsOperation.Decr)throw new Error("Unknown StorageCountsOperation");t&&null!=t.data?o.data=i-Number(t.data):o.data=i-1}return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.createCountsValue=function(e,t,r){if(r){if(r.operation===n.StorageCountsOperation.Incr||r.operation===n.StorageCountsOperation.Decr)return this.createCountsIncrDecrValue(e,t,r);if(null!=r.condition&&null!=r.comparisonValue&&e&&null!=e.data)switch(r.condition){case n.StorageCondition.Equal:if(e.data!==r.comparisonValue)return null;break;case n.StorageCondition.GreaterThan:if(!(e.data>r.comparisonValue))return null;break;case n.StorageCondition.LessThan:if(!(e.data<r.comparisonValue))return null}}var o={data:t.data};return t&&null!=t.tag?o.tag=t.tag:e&&null!=e.tag&&(o.tag=e.tag),o},e.prototype.setValue=function(e,t){this._localStorage.setItem(""+i+e,JSON.stringify(t))},e.prototype.getValue=function(e){var t=JSON.parse(this._localStorage.getItem(""+i+e));return t},e.prototype.storageKeyToStringKey=function(e){var t=e.region||"",r=null!=e.gameId?String(e.gameId):"",n=null!=e.userId?String(e.userId):"",o=e.regionKey||"";return t+"/"+r+"/"+n+"/"+o},e.prototype.stringKeyToStorageKey=function(e){var t=e.split("/"),r={region:Number(t[0]),regionKey:t[3]};return t[1]&&(r.gameId=t[1]),t[2]&&(r.userId=t[2]),r},e.prototype.storageReadKeyToRegExp=function(e){var t=e.region||"",r=null!=e.gameId?String(e.gameId):"",n=null!=e.userId?String(e.userId):"",o="";if("*"===n&&(n="[0-9]+"),-1!==e.regionKey.indexOf("*")){var i=e.regionKey.split(".");i.forEach(function(e,t){o+="*"===e?"[.a-z0-9]*":-1!==e.indexOf("*")?e.replace("*","[a-z0-9]*"):e,t!==i.length-1&&(o+=".")})}else o=e.regionKey.replace(".",".");return new RegExp("^"+t+"/"+r+"/"+n+"/"+o+"$")},e.prototype.sortByValue=function(e,t){e.sort(function(e,r){var o=e.data,i=r.data;if(t===n.StorageOrder.Asc){if(i>o)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(i>o)return 1;if(o>i)return-1}return 0})},e.prototype.sortByRegionKey=function(e,t){e.sort(function(e,r){var o=e.storageKey.regionKey,i=r.storageKey.regionKey;if(t===n.StorageOrder.Asc){if(i>o)return-1;if(o>i)return 1}else if(t===n.StorageOrder.Desc){if(i>o)return 1;if(o>i)return-1}return 0})},e.prototype.expandVariables=function(e){e.gameId&&-1!==e.gameId.indexOf("$gameId")&&this._metaData.gameId&&(e.gameId=e.gameId.replace(/\$gameId/g,this._metaData.gameId))},e}();r.GameStorage=a},{"./validator":3,"@akashic/akashic-engine":"@akashic/akashic-engine"}],2:[function(e,t,r){"use strict";var n=e("./GameStorage");r.GameStorage=n.GameStorage},{"./GameStorage":1}],3:[function(e,t,r){"use strict";function n(e,t){u(e.length>0,"regionKey is empty.");var r=e.split(".");u(r.length<=c,"The maximum number of layers in the region key is "+c+".");for(var n=!1,o=0;o<r.length;++o)t?"*"===r[o]?(u(!n,"The only one layer of the region key for reading consists of a wildcard character."),n=!0):u(/^(\*|[a-z])[a-z0-9]{0,31}\*?$/.test(r[o]),"The layer of the region key for reading must match '^(*|[a-z])[a-z0-9]{0,31}*?$'."):u(/^[a-z][a-z0-9]{0,31}$/.test(r[o]),"The layer of the region key for writing must match '^[a-z][a-z0-9]{0,31}$'.")}function o(e,t){void 0===t&&(t=!1),u(e.region===s.StorageRegion.Counts||e.region===s.StorageRegion.Scores||e.region===s.StorageRegion.Values,"Invalid region."),u(e.regionKey,"regionKey must be set."),n(e.regionKey,t),u(e.gameId||e.userId,"StorageKey must have any one at least from gameId and userId."),null!=e.gameId&&(u.equal(typeof e.gameId,"string","gameId must be a string type."),u(e.gameId.length>0,"gameId is empty.")),null!=e.userId&&(u.equal(typeof e.userId,"string","userId must be a string type."),u(e.userId.length>0,"userId is empty."),t?"*"===e.userId&&(u(e.gameId,'gameId for reading must be set when userId is "*".'),u(-1===e.regionKey.indexOf("*"),'regionKey for reading must not include "*" when userId is "*".')):u("*"!==e.userId,'userId for writing must not include "*".'))}function i(e){if(o(e,!0),null!=e.option){var t=e.option;null!=t.keyOrder&&u(t.keyOrder===s.StorageOrder.Asc||t.keyOrder===s.StorageOrder.Desc,"Invalid keyOrder."),null!=t.valueOrder&&u(t.valueOrder===s.StorageOrder.Asc||t.valueOrder===s.StorageOrder.Desc,"Invalid valueOrder.")}}function a(e){}var u=e("assert"),s=e("@akashic/akashic-engine"),c=4;r.validateRegionKey=n,r.validateStorageKey=o,r.validateStorageReadKey=i,r.validateStorageWriteOption=a},{"@akashic/akashic-engine":"@akashic/akashic-engine",assert:4}],4:[function(e,t,r){(function(r){"use strict";function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);i>o;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return n>r?-1:r>n?1:0}function o(e){return r.Buffer&&"function"==typeof r.Buffer.isBuffer?r.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function a(e){return!o(e)&&"function"==typeof r.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}function u(e){if(b.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(I);return r&&r[1]}}function s(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!b.isFunction(e))return b.inspect(e);var t=u(e),r=t?": "+t:"";return"[Function"+r+"]"}function l(e){return s(c(e.actual),128)+" "+e.operator+" "+s(c(e.expected),128)}function f(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function g(e,t){e||f(e,!0,t,"==",x.ok)}function p(e,t,r,u){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(b.isDate(e)&&b.isDate(t))return e.getTime()===t.getTime();if(b.isRegExp(e)&&b.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(a(e)&&a(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;u=u||{actual:[],expected:[]};var s=u.actual.indexOf(e);return-1!==s&&s===u.expected.indexOf(t)||(u.actual.push(e),u.expected.push(t),y(e,t,r,u))}return r?e===t:e==t}function d(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(b.isPrimitive(e)||b.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=d(e),i=d(t);if(o&&!i||!o&&i)return!1;if(o)return e=O.call(e),t=O.call(t),p(e,t,r);var a,u,s=k(e),c=k(t);if(s.length!==c.length)return!1;for(s.sort(),c.sort(),u=s.length-1;u>=0;u--)if(s[u]!==c[u])return!1;for(u=s.length-1;u>=0;u--)if(a=s[u],!p(e[a],t[a],r,n))return!1;return!0}function h(e,t,r){p(e,t,!0)&&f(e,t,r,"notDeepStrictEqual",h)}function m(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(r){}return!Error.isPrototypeOf(t)&&t.call({},e)===!0}function v(e){var t;try{e()}catch(r){t=r}return t}function S(e,t,r,n){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),o=v(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!o&&f(o,r,"Missing expected exception"+n);var i="string"==typeof n,a=!e&&b.isError(o),u=!e&&o&&!r;if((a&&i&&m(o,r)||u)&&f(o,r,"Got unwanted exception"+n),e&&o&&r&&!m(o,r)||!e&&o)throw o}var b=e("util/"),w=Object.prototype.hasOwnProperty,O=Array.prototype.slice,E=function(){return"foo"===function(){}.name}(),x=t.exports=g,I=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=l(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=u(t),i=n.indexOf("\n"+o);if(i>=0){var a=n.indexOf("\n",i+1);n=n.substring(a+1)}this.stack=n}}},b.inherits(x.AssertionError,Error),x.fail=f,x.ok=g,x.equal=function(e,t,r){e!=t&&f(e,t,r,"==",x.equal)},x.notEqual=function(e,t,r){e==t&&f(e,t,r,"!=",x.notEqual)},x.deepEqual=function(e,t,r){p(e,t,!1)||f(e,t,r,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(e,t,r){p(e,t,!0)||f(e,t,r,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){p(e,t,!1)&&f(e,t,r,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=h,x.strictEqual=function(e,t,r){e!==t&&f(e,t,r,"===",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&f(e,t,r,"!==",x.notStrictEqual)},x["throws"]=function(e,t,r){S(!0,e,t,r)},x.doesNotThrow=function(e,t,r){S(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var k=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"util/":8}],5:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===o||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function u(){h&&d&&(h=!1,d.length?y=d.concat(y):m=-1,y.length&&s())}function s(){if(!h){var e=i(u);h=!0;for(var t=y.length;t;){for(d=y,y=[];++m<t;)d&&d[m].run();m=-1,t=y.length}d=null,h=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var f,g,p=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{g="function"==typeof clearTimeout?clearTimeout:o}catch(e){g=o}}();var d,y=[],h=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];y.push(new c(e,t)),1!==y.length||h||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],6:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],7:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],8:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:a};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),s(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function a(e,t){return e}function u(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function s(e,t,n){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return S(o)||(o=s(e,o,n)),o}var i=c(e,t);if(i)return i;var a=Object.keys(t),y=u(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),I(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(k(t)){var h=t.name?": "+t.name:"";return e.stylize("[Function"+h+"]","special")}if(O(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return e.stylize(Date.prototype.toString.call(t),"date");if(I(t))return l(t)}var m="",v=!1,b=["{","}"];if(d(t)&&(v=!0,b=["[","]"]),k(t)){var w=t.name?": "+t.name:"";m=" [Function"+w+"]"}if(O(t)&&(m=" "+RegExp.prototype.toString.call(t)),x(t)&&(m=" "+Date.prototype.toUTCString.call(t)),I(t)&&(m=" "+l(t)),0===a.length&&(!v||0==t.length))return b[0]+m+b[1];if(0>n)return O(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var E;return E=v?f(e,t,n,y,a):a.map(function(r){return g(e,t,n,y,r,v)}),e.seen.pop(),p(E,m,b)}function c(e,t){if(w(t))return e.stylize("undefined","undefined");if(S(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return v(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,o){for(var i=[],a=0,u=t.length;u>a;++a)D(t,String(a))?i.push(g(e,t,r,n,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(g(e,t,r,n,o,!0))}),i}function g(e,t,r,n,o,i){var a,u,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special")),D(n,o)||(a="["+o+"]"),u||(e.seen.indexOf(c.value)<0?(u=h(r)?s(e,c.value,null):s(e,c.value,r-1),u.indexOf("\n")>-1&&(u=i?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),w(a)){if(i&&o.match(/^\d+$/))return u;a=JSON.stringify(""+o),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+u}function p(e,t,r){var n=0,o=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function h(e){return null===e}function m(e){return null==e}function v(e){return"number"==typeof e}function S(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function w(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===K(e)}function E(e){return"object"==typeof e&&null!==e}function x(e){return E(e)&&"[object Date]"===K(e)}function I(e){return E(e)&&("[object Error]"===K(e)||e instanceof Error)}function k(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function K(e){return Object.prototype.toString.call(e)}function j(e){return 10>e?"0"+e.toString(10):e.toString(10)}function V(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var A=/%[sdj%]/g;r.format=function(e){if(!S(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,a=String(e).replace(A,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}),u=n[r];i>r;u=n[++r])a+=h(u)||!E(u)?" "+u:" "+o(u);return a},r.deprecate=function(e,o){function i(){if(!a){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return i};var z,q={};r.debuglog=function(e){if(w(z)&&(z=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!q[e])if(new RegExp("\\b"+e+"\\b","i").test(z)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=y,r.isNull=h,r.isNullOrUndefined=m,r.isNumber=v,r.isString=S,r.isSymbol=b,r.isUndefined=w,r.isRegExp=O,r.isObject=E,r.isDate=x,r.isError=I,r.isFunction=k,r.isPrimitive=T,r.isBuffer=e("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",V(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!E(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}]},{},[2])(2)});	function enableLogger(e){function o(e){if(!(e.level>l)){var o=e.level in g.LogLevel?"["+g.LogLevel[e.level].toUpperCase()+"]	":"",c=n[e.level]?n[e.level]:console.log;c.call(console,o+e.message),e.cause&&c.call(console,e.cause)}}!1 in window&&(window.console={log:function(e){},error:function(e){},info:function(e){},warn:function(e){}});var l=g.LogLevel.Debug,n={};n[g.LogLevel.Debug]=console.log,n[g.LogLevel.Warn]=console.warn,n[g.LogLevel.Info]=console.info,n[g.LogLevel.Error]=console.error,e.logger.logging.handle(o)}	window.addEventListener("load",function(){function e(e){var o=e,n={id:"9999",name:"sandbox-player"},r="sandboxDummyPlayId",a=new gameStorage.GameStorage(window.localStorage,{gameId:o}),t=require("@akashic/pdi-browser"),i=require("@akashic/game-driver"),d=new i.MemoryAmflowClient({playId:r,putStorageDataSyncFunc:a.set.bind(a),getStorageDataSyncFunc:function(e){var o=a.load(e);return e.map(function(e,n){return{readKey:e,values:o[n]}})}}),c=new t.Platform({amflow:d,containerView:document.getElementById("container"),audioPlugins:[t.HTMLAudioPlugin]});c.loadGameConfiguration=function(e,o){try{var n=window.gLocalAssetContainer["game.json"];n=decodeURIComponent(n),o(null,JSON.parse(n))}catch(r){o(r,null)}},c._resourceFactory.createScriptAsset=function(e,o){return new LocalScriptAsset(e,o)},c._resourceFactory.createTextAsset=function(e,o){return new LocalTextAsset(e,o)},driver=new i.GameDriver({platform:c,player:n,errorHandler:function(e){console.log("ERRORHANDLER:",e)}}),driver.gameCreatedTrigger.handle(function(){window.optionProps.magnify&&c.fitToWindow(!0)}),driver.initialize({configurationUrl:"game.json",assetBase:"./",driverConfiguration:{playId:r,playToken:"dummyToken",executionMode:i.ExecutionMode.Active},loopConfiguration:{loopMode:i.LoopMode.Realtime}},function(e){if(e)throw e;driver.startGame()})}e("exportHTML")});	window.g=require("@akashic/akashic-engine"),"gLocalAssetContainer"in window||(window.gLocalAssetContainer={});</script>
<link rel="stylesheet" href="../common-demo.css">
</head>
<body>
<div id="container"></div>
</body>
</html>