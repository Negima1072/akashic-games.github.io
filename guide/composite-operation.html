<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>CompositeOperationの利用 - Akashic Engine</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"><link rel="stylesheet" href="../main.css"><link rel="shortcut icon" href="../favicon.ico" type="image/vnd.microsoft.icon"><link rel="icon" href="../favicon.ico" type="image/vnd.microsoft.icon"></head><body><div class="container"><nav class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"></div></div><button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href=".." class="navbar-brand"></a></nav><h1>CompositeOperationの利用</h1><h2><a name="これは"></a> これは</h2><p><code>E#compositeOpration</code> の利用方法を記述したドキュメントです。
対象バージョンはakashic-engine@0.6.0以降です。</p>
<h2><a name="compositeOperationとは"></a> compositeOperationとは</h2><p><code>E#compositeOperation</code> とは、エンティティを描画する際の合成方法を指定するプロパティです。</p>
<p>以下の値を指定可能です。</p>
<ul>
<li><code>CompositeOpration.SourceOver</code></li>
<li><code>CompositeOpration.SourceAtop</code></li>
<li><code>CompositeOpration.Lighter</code></li>
<li><code>CompositeOpration.Copy</code></li>
<li>未指定（<code>undefined</code>）</li>
</ul>
<h2><a name="SourceOver"></a> SouceOver</h2><p>先に描画された領域の上に重ねて描画します。これがデフォルトの合成方法となります。</p>
<p>以下は、緑色、赤色、青色の <code>FilledRect</code> を重ねて描画する例です。</p>
<p><img src="images/source-over.png" alt="source-over"></p>
<pre><code class="language-javascript">var green = new g.FilledRect({scene: scene, x: 50, width: 100, height: 100, cssColor: &quot;green&quot;});
green.compositeOperation = g.CompositeOperation.SourceOver;
var red = new g.FilledRect({scene: scene, y: 20, width: 100, height: 100, cssColor: &quot;red&quot;});
red.compositeOperation = g.CompositeOperation.SourceOver;
var blue = new g.FilledRect({scene: scene, x: 75, y: 50, width: 100, height: 100, cssColor: &quot;blue&quot;});
blue.compositeOperation = g.CompositeOperation.SourceOver;
scene.append(green);
scene.append(red);
scene.append(blue);
</code></pre>
<h2><a name="SourceAtop"></a> SourceAtop</h2><p>先に描画された領域と重なった部分のみを描画します。</p>
<p>以下の例では、赤色と青色の <code>FilledRect</code> に <code>SourceAtop</code> 指定し、緑色の <code>FilledRect</code> と重なった部分だけ描画する例です。</p>
<p><img src="images/source-atop.png" alt="source-atop"></p>
<pre><code class="language-javascript">red.compositeOperation = g.CompositeOperation.SourceAtop;
blue.compositeOperation = g.CompositeOperation.SourceAtop;
</code></pre>
<h2><a name="Lighter"></a> Lighter</h2><p>先に描画された領域と重なった部分の色を加算して描画します。</p>
<p>以下の例では、赤色と青色の <code>FilledRect</code> に <code>Lighter</code> 指定したものです。</p>
<p><img src="images/lighter.png" alt="lighter"></p>
<pre><code class="language-javascript">red.compositeOperation = g.CompositeOperation.Lighter;
blue.compositeOperation = g.CompositeOperation.Lighter;
</code></pre>
<h2><a name="Copy"></a> Copy</h2><p>先に描画された領域の状態に関わらず、全て上書きして描画します。
描画内容が透明な場合、描画先の内容にかかわらず透明な画像が上書き描画されます。</p>
<p><img src="images/copy.png" alt="copy"></p>
<pre><code class="language-javascript">blue.compositeOperation = g.CompositeOperation.SourceOver;
character.compositeOperation = g.CompositeOperation.Copy;
</code></pre>
<h2><a name="未指定（undefined）"></a> 未指定（undefined）</h2><p><code>E#compositeOperation</code> はデフォルトで未指定（ <code>undefined</code> ）ですが、この時の合成方法は親エンティティの <code>compositeOperation</code> によって変わってきます。</p>
<ul>
<li><p>親エンティティの <code>compositeOperation</code> が未指定（ <code>undefined</code> )</p>
<p>デフォルトの合成方法である <code>SourceOver</code> で合成されます。</p>
</li>
<li><p>親エンティティの <code>compositeOperation</code> が指定されている</p>
<p>親エンティティの <code>compositeOperation</code> で合成されます。</p>
</li>
</ul>
<h2><a name="Paneの利用"></a> Paneの利用</h2><p><code>SourceAtop</code> や <code>Lighter</code> を利用する際に、<code>Pane</code> を利用することで、先に描画された領域を合成対象に含めないようにすることが出来ます。</p>
<p>例えば、以下のように背景（灰色の <code>FilledRect</code>）が存在する場合に、<code>SourceAtop</code> を使って赤色と青色の <code>FilledRect</code> のうち、緑色の <code>FilledRect</code> と重なる部分のみを描画したいケースを考えます。</p>
<p><img src="images/source-atop-bg.png" alt="source-atop-bg"></p>
<pre><code class="language-javascript">var bg = new g.FilledRect({scene: scene, width: game.width, height: game.height, cssColor: &quot;lightgray&quot;});
scene.append(bg);
var green = new g.FilledRect({scene: scene, x: 50, width: 100, height: 100, cssColor: &quot;green&quot;});
var red = new g.FilledRect({scene: scene, y: 20, width: 100, height: 100, cssColor: &quot;red&quot;});
var blue = new g.FilledRect({scene: scene, x: 75, y: 50, width: 100, height: 100, cssColor: &quot;blue&quot;});
scene.append(green);
scene.append(red);
scene.append(blue);
</code></pre>
<p>単純に、</p>
<pre><code>red.compositeOperation = g.CompositeOperation.SourceOver;
blue.compositeOperation = g.CompositeOperation.SourceOver;
</code></pre><p>としても、合成対象に背景が含まれてしまうので、赤色と青色の <code>FilledRect</code> はそのまま描画されます。</p>
<p>このような場合に <code>Pane</code> を利用します。</p>
<p><code>Pane</code> は内部に描画キャッシュを持ち、 子エンティティは描画キャッシュに描画されます。</p>
<p>つまり、 <code>Pane</code> の子エンティティの合成対象に <code>Pane</code> 外のエンティティは含まれなくなります。</p>
<p>以下の例では、緑色、赤色、青色の <code>FilledRect</code> を <code>Pane</code> に追加しています。</p>
<p><img src="images/source-atop-pane.png" alt="source-atop-pane"></p>
<pre><code class="language-javascript">var bg = new g.FilledRect({scene: scene, width: game.width, height: game.height, cssColor: &quot;lightgray&quot;});
var green = new g.FilledRect({scene: scene, x: 50, width: 100, height: 100, cssColor: &quot;green&quot;});
var red = new g.FilledRect({scene: scene, y: 20, width: 100, height: 100, cssColor: &quot;red&quot;});
red.compositeOperation = g.CompositeOperation.SourceAtop;
var blue = new g.FilledRect({scene: scene, x: 75, y: 50, width: 100, height: 100, cssColor: &quot;blue&quot;});
blue.compositeOperation = g.CompositeOperation.SourceAtop;
var pane = new g.Pane({scene: scene, width: 175, height: 150});
pane.append(green);
pane.append(red);
pane.append(blue);
scene.append(bg);
scene.append(pane);
</code></pre><hr><div class="footer"><a rel="license" href="http://creativecommons.org/licenses/by/2.1/jp/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by/2.1/jp/80x15.png" class="license"></a>このサイトの画像は、<a rel="license" href="http://creativecommons.org/licenses/by/2.1/jp/">クリエイティブ・コモンズ 表示 2.1 日本 ライセンスの下に提供されています。</a></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script></body></html>