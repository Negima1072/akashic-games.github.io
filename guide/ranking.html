<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<meta name="viewport"    content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="description" content="Akashic EngineはJavaScriptで動作する、無償利用が可能なマルチプラットフォーム対応ゲーム開発エンジンです">
<meta name="theme-color" content="#0F1F26">
<title>ニコニコ新市場対応コンテンツ作成ガイド</title>
<link rel="icon"       href="/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="stylesheet" href="/css/common.css?1540369236245">
<link rel="stylesheet" href="/css/header.css?1540369236245">
<link rel="stylesheet" href="/css/footer.css?1540369236245">


<link rel="stylesheet" href="/css/asset.css?1540369236245">

<link rel="stylesheet" href="/css/akashic-document.css?1540369236245">

<link rel="stylesheet" href="/css/railscasts.css?1540369236245">


<script src="/lib/jquery-3.2.1.min.js"></script>
<script src="/lib/common.js?1540369236245"></script>


<script src="/lib/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="head--spacer"></div>
<div class="SP--head--menu--show"></div>
<div class="SP--head--menu--hide"></div>

<div class="head--menu--outer">
	<ul class="head--menu">
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/tutorial/v2/">Akashic Engine入門 v2</a></li>
				<li><a href="/tutorial/tutorial.html">Akashic Engine入門 v1(deprecated)</a></li>
			</ul>
		</li>
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/guide/akashic-cli.html">akashic-cli利用ガイド</a></li>
				<li><a href="/guide/game-json.html">game.jsonの仕様</a></li>
				<li><a href="/guide/asset-recommended-spec.html">素材の推奨仕様</a></li>
				<li><a href="/guide/composite-operation.html">CompositeOperationの利用</a></li>
				<li><a href="/guide/storage.html">ストレージについて</a></li>
				<li><a href="/guide/asset-load-error.html">アセットロードエラーについて</a></li>
				<li><a href="/guide/atsumaru.html">RPGアツマール投稿ガイド</a></li>
				<li><a href="/guide/template-guide.html">akashic initテンプレート利用ガイド</a></li>
				<li><a href="/guide/shader.html">シェーダの利用</a></li>
				<li><a href="/guide/ranking.html">ニコニコ新市場対応コンテンツ作成ガイド</a></li>
				<li><a href="/guide/export-atsumaru.html">ニコニコ新市場対応コンテンツの投稿方法</a></li>
			</ul>
		</li>
		<li class="head--menu--item"><a class="head--logo" href="/" title="ホーム"></a></li>
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/reference/akashic-engine-v1/modules/_lib_main_d_.g.html">akashic-engine v1.x(deprecated)</a></li>
				<li><a href="/reference/akashic-engine-v2/modules/_lib_main_d_.g.html">akashic-engine v2.x</a></li>
				<li><a href="/reference/akashic-timeline/">akashic-timeline</a></li>
				<li><a href="/reference/akashic-animation/">akashic-animation</a></li>
				<li><a href="/reference/akashic-label/">akashic-label</a></li>
				<li><a href="/reference/akashic-tile/">akashic-tile</a></li>
				<li><a href="/reference/akashic-box2d/">akashic-box2d</a></li>
			</ul>
		</li>
		<li class="head--menu--item">
			<p class="head--menu--item--tab"></p>
			<ul class="head--menu--item--list">
				<li><a href="/demo/?title=helloworld">Hello World</a></li>
				<li><a href="/demo/?title=scale-rotate-opacity">拡縮・回転・透明度</a></li>
				<li><a href="/demo/?title=bitmap-font">ビットマップフォント</a></li>
				<li><a href="/demo/?title=framesprite">フレームアニメーション</a></li>
				<li><a href="/demo/?title=demo-touchevent">タッチイベント</a></li>
				<li><a href="/demo/?title=demo-tile">タイル</a></li>
				<li><a href="/demo/?title=simpleShot">アブストラクトシューティング</a></li>
				<li><a href="/demo/?title=HoppingWitch">HOPPING WITCH</a></li>
				<li><a href="/demo/?title=GalaxyWars">GALAXY WARS</a></li>
				<li><a href="/demo/?title=cannontv">いくぜ！ 超会議</a></li>
				<li><a href="/asset/material.html">サンプルデモの素材</a></li>
			</ul>
		</li>
	</ul>
</div>

<header id="akashic-page-header">
	<div class="SP--head--logo--box"><a class="head--logo" href="/" title="ホーム"></a></div>
</header>

<div id="BodyInner">
	<section class="akashic--document safearea--LR">
		<div class="inner responsive--width">
			<h1>ニコニコ新市場対応コンテンツ作成ガイド</h1>
<h2><a name="これは"></a> これは</h2>
<p>Akashic Engineで <a href="http://blog.nicovideo.jp/niconews/81617.html">実験放送</a> に対応するゲーム(ニコニコ新市場対応コンテンツ)の作り方を解説します。
実際に作成したゲームを実験放送に投稿する方法については、 <a href="/guide/export-atsumaru">こちら</a> を参照してください。</p>
<h2><a name="ニコニコ新市場対応コンテンツ"></a> ニコニコ新市場対応コンテンツ</h2>
<p>Akashic Engineでは、実験放送内で遊べるゲーム(<strong>ニコニコ新市場対応コンテンツ</strong>)を作成することができます。
これには次の手順が必要です。</p>
<ol>
<li>適切な解像度とFPSでゲームを作成</li>
<li>対応するモードを <code>game.json</code> に記述</li>
<li>(ランキングモードに対応する場合) プログラム内で「スコア」を設定する</li>
</ol>
<h2><a name="解像度とFPS"></a> 解像度とFPS</h2>
<p>次の値である必要があります。</p>
<ul>
<li><strong>画面解像度</strong>: 1280x720以下 (16:9を推奨)</li>
<li><strong>FPS</strong>: 1以上60以下 (30または60を推奨)</li>
</ul>
<p>実験放送内のゲームは放送画面に合うよう自動的に拡縮されます。
放送画面上で縦横に余白なく表示できるよう、アスペクト比16:9を推奨します。
公開されているいくつかのサンプルコンテンツ(<a href="https://github.com/akashic-contents/thiefBuster">泥棒バスター</a>など))は、640x360で作成されています。</p>
<p>FPSは30または60を推奨します。
低い方が負荷は低いので、演出上必要がなければ30にしておくと、より広い環境でストレスなく遊べる可能性があります。</p>
<p>解像度やFPSは、 <code>akashic</code> コマンドでゲームを生成する時点で入力を求められるので、そこで指定することができます。</p>
<pre><code class="lang-shell">$ akashic init
(中略)
prompt: width:  (320) 640
prompt: height:  (320) 360
prom pt: fps:  (30) 30
INFO: Done!
</code></pre>
<p>生成済みのゲームの場合は、 <code>game.json</code> の <code>width</code>, <code>height</code>, <code>fps</code> プロパティをそれぞれ編集してください。</p>
<pre><code class="lang-json">{
  &quot;width&quot;: 640,
  &quot;height&quot;: 360,
  &quot;fps&quot;: 30,
  &quot;...&quot;: &quot;(その他の値)&quot;
}
</code></pre>
<h2><a name="対応するモードを指定"></a> 対応するモードを指定</h2>
<p>放送内での遊び方には、いくつかの種類があります。</p>
<ul>
<li><strong>ランキングモード</strong> (<code>&quot;ranking&quot;</code>): 一人プレイのゲームを、放送者と各視聴者がそれぞれ遊び、スコアを競う</li>
<li><strong>ひとりで遊ぶモード</strong> (<code>&quot;single&quot;</code>): 一人プレイのゲームを放送者が遊び、視聴者はその様子を見る</li>
<li><strong>みんなで遊ぶモード</strong> (N/A): 放送者と選ばれた視聴者など、複数人で遊ぶ</li>
</ul>
<p>Akashic Engineでは2018年10月現在、ランキングモードとひとりで遊ぶモードのゲームを作成することができます。
ニコニコ新市場対応コンテンツは、この中から対応するモードを指定する必要があります。</p>
<p><code>game.json</code> に <code>environment.niconico.supportedModes</code> プロパティを加え、ゲームが対応するモードを(配列で)全て列挙してください。
実験放送には、ここで列挙されたそれぞれのモードで起動できるように登録されます。</p>
<p>次の例は、ランキングモードとひとりで遊ぶモードの両方に対応する game.json の記述例です。</p>
<pre><code class="lang-json">{
  &quot;environment&quot;: {
    &quot;niconico&quot;: {
      &quot;supportedModes&quot;: [&quot;single&quot;, &quot;ranking&quot;]
    }
  }
}
</code></pre>
<p>ひとりで遊ぶモード(<code>&quot;single&quot;</code>)は常に指定することができます。
一方でランキングモード(<code>&quot;ranking&quot;</code>)は、後述の条件を満たすゲームでのみ指定してください。</p>
<h2><a name="ランキング対応ゲーム"></a> ランキング対応ゲーム</h2>
<p><code>supportedModes</code> に <code>&quot;ranking&quot;</code> を指定するゲーム(ランキング対応ゲーム)は、次の条件を満たすものでなければなりません。</p>
<ul>
<li>一人プレイである</li>
<li>タイムアタック(一定時間内のスコアを競うゲーム)である</li>
<li>0〜99999点のスコアを特定の変数に代入するようになっている</li>
</ul>
<p>死ぬまでずっと遊べるタイプのゲームは扱えません(「時間内に死んでしまったら継続不能」というものは扱えます)。
マイナスや10万点以上のスコアはカウンターストップ扱いになります。</p>
<h3><a name="スコア"></a> スコア</h3>
<p>ランキング対応ゲームは、ゲームの進行中、次の変数に <strong>スコア</strong> を代入しなければなりません。</p>
<pre><code class="lang-javascript">g.game.vars.gameState.score
</code></pre>
<p>スコアは0以上99999以下の整数である必要があります。</p>
<p><code>g.game.vars</code> は、ゲーム開発者が自由に使える領域として、(ランキングとは関係なく)Akashic Engineが提供している変数です。
初期値として <code>{}</code> が代入されています。
ランキングでは <code>g.game.vars.gameState.score</code> の値をスコアとして扱い、
ゲームの終了後、このスコアに基づいてランキングの順位が決定されます。</p>
<p>以下は、クリックした回数がスコアになるゲームのコードです。</p>
<pre><code class="lang-javascript">var scene = new g.Scene({ game: g.game });
scene.loaded.add(function () {
  g.game.vars.gameState = { score: 0 };
  scene.pointDownCapture.add(function () {
    g.game.vars.gameState.score += 1;
  });
});
</code></pre>
<p>ゲーム中画面には何も表示されませんが、画面内の任意の場所でクリックした回数がスコアに代入されます。
つまり(画面に適切な演出を加えれば)クリック数を競うゲームになります。</p>
<h3><a name="プレイ閾値"></a> プレイ閾値</h3>
<p>ランキングでは、放送者・各視聴者でのゲームプレイ終了後にスコアが集計され、上位者の名前や得点が表示されます。</p>
<p>ゲームに参加した人数が少ない場合、スコアが0点でもこの上位者に入ってしまうことがあります。
そうすると「全くプレイしていないのにランキングに名前が出ることがある」という違和感のある挙動になってしまいます。</p>
<p>このような状況を避けるため、ランキング対応ゲームでは <strong>プレイ閾値</strong> を定めることができます。
プレイ閾値以下のスコアは「プレイしなかったもの」として扱われ、ランキング上位者として表示されなくなります。</p>
<p>プレイ閾値は、次の変数に代入された値です。</p>
<pre><code class="lang-javascript">g.game.vars.gameState.playThreshold
</code></pre>
<p>値は整数でなければなりません。
この変数に値が代入されていない場合、プレイ閾値は0として取り扱われます。</p>
<p>生存期間に応じてスコアが入るなど、プレイヤーが何も操作しなくてもスコアが0より大きくなってしまうゲームでは、この値を適切に設定してください。</p>
<h3><a name="クリア閾値"></a> クリア閾値</h3>
<p>同様に「ゲームをクリアしたとみなすか」にも閾値(クリア閾値)を定めることができます。</p>
<pre><code class="lang-javascript">g.game.vars.gameState.clearThreshold
</code></pre>
<p>この値は将来の拡張のために予約される値です。現在のところ参照されません。</p>
<h3><a name="制限時間と難易度設定"></a> 制限時間と難易度設定</h3>
<p>ランキング対応ゲームは、起動からある時間が経過すると自動的に終了されます。
ゲーム開発者は終了のタイミングを制御することはできませんし、終了のための処理を記述する必要もありません。</p>
<p>ただしゲームには、補助的な情報として「何秒間遊ぶ設定で起動されたか」という値(<strong>制限時間</strong>)が与えられます。
ゲーム開発者は、この値を参照してゲームの内容を調整することができます。
たとえば「終了時間が近づいたらクリア画面かゲームオーバー画面を表示する」といった演出が考えられます。
(もちろんそのような演出をしなくても問題はありません)</p>
<p>この制限時間の値は、あくまでも目安であることに注意してください。
ゲーム起動後、厳密にこの時間で終了されることを保証するものではありません。
これはゲームリソースのダウンロード時間のばらつきや、
スコア送信時の通信遅れを救済するためのサーバ側の多少のマージンなど、
いくつかの要因で微妙な調整を行なう必要があるためです。</p>
<p>制限時間の値は、ゲーム開始直後に <code>g.MessageEvent</code> で与えられます。
通知された <code>MessageEvent</code> を <code>e</code> とすると、 <code>(e.data.type === &quot;start&quot;)</code> である時、 <code>e.data.parameters.gameTimeLimit</code> の値が制限時間(秒)です。</p>
<p>Akashic Engineでは通常、イベントはシーンのロードタイミング(<code>g.Scene#loaded</code>)より後に受信されます。
そのため、この制限時間の情報を扱うためには、 <code>loaded</code> ではなく <code>message</code> トリガーを監視してゲーム開始を行う必要がある点に注意してください。</p>
<p>次のコードは、制限時間情報を取得する例です。</p>
<pre><code class="lang-javascript">var scene = new g.Scene({ game: g.game });

scene.loaded.add(function () {
    // 通常はここでゲームの初期化処理を行うが、何もしない
});

scene.message.add(function (msg) {
    if (msg.data &amp;&amp; msg.data.type === &quot;start&quot;) {
        // 制限時間を通知するイベントを受信した時点で初期化する
        onLoad(msg.data.parameters);
    }
});

function onLoad(parameters) {
    // 制限時間は `gameTimeLimit` 秒
    var gameTimeLimit = parameters.gameTimeLimit;

    // 以下、通常のゲームとしての初期化処理
    // ...
}
</code></pre>
<p>この <code>MessageEvent</code> で与えられる情報には、他に <strong>難易度設定</strong> の値があります。</p>
<p>難易度設定は1以上10以下の整数で、ゲームに対して「この難易度でゲームを行なって欲しい」という要望を通知するものです。
ゲーム開発者はこの値を見てゲームの難易度を調整することができます。これは必須ではありません。</p>
<p>難易度設定の値は、上の例では <code>parameters.difficulty</code> を参照することで取得できます。</p>
<p>(ただし、現時点ではゲーム起動時に難易度を選択する方法がありません。
したがってこれは現在のところ「将来的な対応に備えて利用することができる値」ということになります。)</p>
<h2><a name="投稿する"></a> 投稿する</h2>
<p>以上の手順で実際に作成したゲームを、実験放送に投稿する方法については <a href="/guide/export-atsumaru">こちら</a> を参照してください。</p>

		</div>
	</section>
	<footer class="safearea--LR">
	<div class="responsive--width">

		<ul class="foot--menu cfix">
			<li class="foot--menu--item">
				<p class="foot--menu--item--tab">入門</p>
				<ul class="foot--menu--item--list">
					<li><a href="/tutorial/v2/">Akashic Engine入門 v2</a></li>
					<li><a href="/tutorial/tutorial.html">Akashic Engine入門 v1(deprecated)</a></li>
				</ul>
			</li>
			<li class="foot--menu--item">
				<p class="foot--menu--item--tab">ガイド</p>
				<ul class="foot--menu--item--list">
					<li><a href="/guide/akashic-cli.html">akashic-cli利用ガイド</a></li>
					<li><a href="/guide/game-json.html">game.jsonの仕様</a></li>
					<li><a href="/guide/asset-recommended-spec.html">素材の推奨仕様</a></li>
					<li><a href="/guide/composite-operation.html">CompositeOperationの利用</a></li>
					<li><a href="/guide/storage.html">ストレージについて</a></li>
					<li><a href="/guide/asset-load-error.html">アセットロードエラーについて</a></li>
					<li><a href="/guide/atsumaru.html">RPGアツマール投稿ガイド</a></li>
					<li><a href="/guide/template-guide.html">akashic initテンプレート利用ガイド</a></li>
					<li><a href="/guide/shader.html">シェーダの利用</a></li>
					<li><a href="/guide/ranking.html">ニコニコ新市場対応コンテンツ作成ガイド</a></li>
					<li><a href="/guide/export-atsumaru.html">ニコニコ新市場対応コンテンツの投稿方法</a></li>
				</ul>
			</li>
			<li class="foot--menu--item">
				<p class="foot--menu--item--tab">リファレンス</p>
				<ul class="foot--menu--item--list">
					<li><a href="/reference/akashic-engine-v1/modules/_lib_main_d_.g.html">akashic-engine v1.x(deprecated)</a></li>
					<li><a href="/reference/akashic-engine-v2/modules/_lib_main_d_.g.html">akashic-engine v2.x</a></li>
					<li><a href="/reference/akashic-timeline/">akashic-timeline</a></li>
					<li><a href="/reference/akashic-animation/">akashic-animation</a></li>
					<li><a href="/reference/akashic-label/">akashic-label</a></li>
					<li><a href="/reference/akashic-tile/">akashic-tile</a></li>
					<li><a href="/reference/akashic-box2d/">akashic-box2d</a></li>
				</ul>
			</li>
			<li class="foot--menu--item">
				<p class="foot--menu--item--tab">サンプルデモ</p>
				<ul class="foot--menu--item--list">
					<li><a href="/demo/?title=helloworld">Hello World</a></li>
					<li><a href="/demo/?title=scale-rotate-opacity">拡縮・回転・透明度</a></li>
					<li><a href="/demo/?title=bitmap-font">ビットマップフォント</a></li>
					<li><a href="/demo/?title=framesprite">フレームアニメーション</a></li>
					<li><a href="/demo/?title=demo-touchevent">タッチイベント</a></li>
					<li><a href="/demo/?title=demo-tile">タイル</a></li>
					<li><a href="/demo/?title=simpleShot">アブストラクトシューティング</a></li>
					<li><a href="/demo/?title=HoppingWitch">HOPPING WITCH</a></li>
					<li><a href="/demo/?title=GalaxyWars">GALAXY WARS</a></li>
					<li><a href="/demo/?title=cannontv">いくぜ！ 超会議</a></li>
					<li><a href="/asset/material.html">サンプルデモの素材</a></li>
				</ul>
			</li>
		</ul>

		<ul class="foot--creativecommons">
			<li class="foot--creativecommons--ban"><a href="http://creativecommons.org/licenses/by/2.1/jp/" target="_blank"><img alt="クリエイティブ・コモンズ・ライセンス" src="https://i.creativecommons.org/l/by/2.1/jp/80x15.png"></a></li>
			<li class="foot--creativecommons--txt">このサイトの画像は<br><a rel="license" href="http://creativecommons.org/licenses/by/2.1/jp/" target="_blank">クリエイティブ・コモンズ 表示 2.1 日本 ライセンス</a><br>の下に提供されています</li>
		</ul>

		<ul class="foot--license">
			<li class="foot--license--akashic"><a href="https://akashic-games.github.io"></a></li>
			<li class="foot--license--dwango"><a href="http://dwango.co.jp" target="_blank">&copy; dwango</a></li>
		</ul>

	</div>
</footer>

</div>
<div class="page--top"></div>
<div class="window--dark"></div>
</body>
</html>