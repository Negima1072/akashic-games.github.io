---
layout: default
---
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport"    content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="description" content="AkashicEngineはJavaScriptで動作するマルチプラットフォーム対応ゲーム開発エンジンです">
<meta name="theme-color" content="#0F1F26">
<title>akashic-cli利用ガイド - Akashic</title>
<link rel="icon"       href="/favicon.ico" type="image/vnd.microsoft.icon">
<link rel="stylesheet" href="/css/reset.css?{% include file-update.html %}">
<link rel="stylesheet" href="/css/common.css?{% include file-update.html %}">
<link rel="stylesheet" href="/css/header.css?{% include file-update.html %}">
<link rel="stylesheet" href="/css/akashic-document.css?{% include file-update.html %}">
<link rel="stylesheet" href="/css/styles/railscasts.css">
<link rel="stylesheet" href="/css/footer.css?{% include file-update.html %}">
<script src="/lib/jquery-3.2.1.min.js"></script>
<script src="/lib/header.js?{% include file-update.html %}"></script>
<script src="/lib/common.js?{% include file-update.html %}"></script>
<script src="/lib/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="OuterBox">
<!--↓ヘッダ↓-->
{% include header.html %}
<!--↑ヘッダ↑-->
<!--↓ボディ↓-->
<section class="page--body">
<div class="akashic--document responsive--width">

<h1>akashic-cli利用ガイド</h1>

<h2 id="これは" name="これは">これは</h2>

<p>Akashicでのゲーム開発を補助するコマンドラインツール、akashicコマンドの仕様と利用法を解説します。akashicコマンドはakashic-cliをインストールして使用することができます。akashicの対象バージョンは1.0.1以降です。</p>
<p>斜体は検討中の箇所です。</p>

<h2 id="インストール方法" name="インストール方法">インストール方法</h2>

<p>akashicコマンドは、Node.js v0.12.0以降で動作します。各プラットフォームで、適当な方法でNode.jsをインストールしてください。</p>
<p>WindowsやMacのユーザであれば、<a href="https://nodejs.org/download/" target="_blank">Node.js公式Webサイト</a>から適切なパッケージをダウンロードし、インストールすることができます。</p>

<pre><code class="lang-sh">npm install -g @akashic/akashic-cli</code></pre>

<h2 id="使い方" name="使い方">使い方</h2>

<p>無事にインストールができていれば、以下のコマンドが実行できるようになっています。実行すると、akashicコマンドの簡単なヘルプが表示されます。</p>

<pre><code>$ akashic</code></pre>

<p><code>akashic</code>は以下のコマンドを持ちます。</p>

<ul>
<li class="arrow sample3-4">akashic init
	<ul>
	<li>Akashic のゲームとして最低限動作するスクリプトやディレクトリを生成します。</li>
	</ul>
</li>
<li>akashic modify
	<ul>
	<li>game.jsonに記述されている、ゲームの各種メタ情報を更新します。</li>
	</ul>
</li>
<li>akashic scan
	<ul>
	<li>game.jsonに記述されている、ゲームのアセットや各種ライブラリ情報を更新します。</li>
	</ul>
</li>
<li>akashic install
	<ul>
	<li>npm installを行い、追加されたファイルのリストをgame.jsonに加えます。</li>
	</ul>
</li>
<li>akashic uninstall
	<ul>
	<li>npm uninstallを行い、削除されたファイルをgame.jsonのリストから取り除きます。</li>
	</ul>
</li>
<li>akashic update
	<ul>
	<li>npm updateを行い、 node_modules以下のnpmパッケージを更新し、ファイルに変更があればgame.jsonに加えます。</li>
	</ul>
</li>
<li>akashic export zip
	<ul>
	<li>ゲームをzip形式に変換して出力します。</li>
	</ul>
</li>
<li>akashic export html
	<ul>
	<li>ゲームを単独で実行可能なHTMLファイル(と画像など)を含むディレクトリを生成します。</li>
	</ul>
</li>
<li>akashic stat
	<ul>
	<li>ゲームに関する情報を収集して出力します。</li>
	</ul>
</li>
</ul>

<p>init 以外のコマンドは、initによって生成されるgame.jsonを操作・出力します。したがって通常、ゲーム開発時にはまずakashic initを実行し、その後必要に応じて他コマンドを実行することになります。</p>

<h2 id="init" name="init">init</h2>

<pre><code class="lang-sh">akashic init [--type &lt;type&gt;]</code></pre>

<p>新しくAkashicで動作するゲームをカレントディレクトリに生成します。</p>
<p>このコマンドを実行すると、以下のような対話型のインターフェースが表示され、ゲーム画面の幅・高さおよびゲームのFPSを入力できます。</p>

<pre><code>$ npm install -g @akashic/akashic-cli
$ cd GAME_HOME
$ akashic init
width: (320)
height: (320)
fps: (30)</code></pre>

<p>入力後、カレントディレクトリには--typeオプションに指定した値に応じてディレクトリ・ファイルが生成されます。</p>
<p>また、本コマンドは、カレントディレクトリの内容が空の状態で実行することを推奨します。</p>

<h3 id="--typeオプション" name="--typeオプション">--typeオプション</h3>

<p>&lt;type&gt; に指定できる値は、<code>JavaScript</code>または<code>TypeScript</code>です。指定しない場合、<code>JavaScript</code>が指定されたものとして扱われます。</p>

<h4 id="JavaScript" name="JavaScript">JavaScript</h4>

<p>下記のディレクトリ、ファイルが生成されます。これらはこの時点で最低限Akashicで動作するゲームになっています。</p>

<pre><code>GAME_HOME
 +- image/
 +- text/
 +- audio/
 +- script/
  +- main.js
 +- game.json
 +- package.json</code></pre>

<p>これらのファイルの詳細は<a href="#initで作られるファイル">initで作られるファイル</a>の節を参照してください。</p>

<h4>TypeScript</h4>

<p>TypeScriptで書かれたゲームと、ビルドに必要なディレクトリ・ファイルが生成されます。これらをビルドすることで、gameディレクトリ以下に最低限Akashicで動作するゲームを生成します。ゲームの内容は、--typeオプションにJavaScriptを指定した場合に生成されるゲームと同一です。</p>
<p>ビルドの方法は、生成されるREADME.mdを参照してください。</p>

<h2 id="modify" name="modify">modify</h2>

<pre><code>akashic modify &lt;target&gt;</code></pre>

<p>game.jsonに記述されている各種メタ情報を更新します。&lt;target&gt; に指定できる文字列は以下のとおりです:</p>
<ul>
<li>width &lt;new_width&gt;
	<ul>
	<li>game.jsonに記述されたゲーム画面の幅を &lt;new_width&gt; の値(数値)で更新します。</li>
	</ul>
</li>
<li>height &lt;new_height&gt;
	<ul>
	<li>game.jsonに記述されたゲーム画面の高さを &lt;new_height&gt; の値(数値)で更新します。</li>
	</ul>
</li>
<li>fps &lt;new_fps&gt;
	<ul>
	<li>game.jsonに記述されたゲーム画面のFPSを &lt;new_fps&gt; の値(数値)で更新します。</li>
	</ul>
</li>
</ul>

<h2 id="scan" name="scan">scan</h2>

<pre><code>akashic scan &lt;target&gt;</code></pre>

<p>game.jsonに記述されているゲームのアセットや各種ライブラリ情報を更新します。&lt;target&gt; に指定できる文字列は以下のとおりです:</p>

<ul>
<li>asset &lt;subtarget&gt;
	<ul>
	<li>game.jsonに記述されたアセット情報を更新します。(&lt;subtarget&gt; の内容は後述)</li>
	</ul>
</li>
<li>globalScripts
	<ul>
	<li>カレントディレクトリの node_modules/ 以下のファイル一覧を game.jsonに加えます。</li>
	<li>通常使用する必要はありません。akashic install や uninstall を利用してください。</li>
	</ul>
</li>
</ul>

<p>game.jsonのアセット情報を更新するscan assetコマンドは、もう一つの引数 &lt;subtarget&gt; によって更新する情報を制御することができます。</p>

<pre><code>akashic scan asset &lt;subtarget&gt;</code></pre>

<p>&lt;subtarget&gt; に指定できる文字列とそれぞれの動作は次のとおりです:</p>

<ul>
<li>image
	<ul>
	<li>image/ ディレクトリ以下の画像素材を列挙し、アセット情報を更新します。</li>
	</ul>
</li>
<li>text
	<ul>
	<li>text/ ディレクトリ以下のテキスト素材を列挙し、アセット情報を更新します。</li>
	</ul>
</li>
<li>audio
	<ul>
	<li>audio/ ディレクトリ以下の音素材を列挙し、アセット情報を更新します。</li>
	</ul>
</li>
<li>script
	<ul>
	<li>script/ ディレクトリ以下のスクリプト素材を列挙し、アセット情報を更新します。</li>
	</ul>
</li>
<li>(なし)
	<ul>
	<li>上記すべてを行います。</li>
	</ul>
</li>
</ul>

<p>game.jsonの管理しているアセット情報には、ファイルパスだけでなく以下のような情報も含まれます。素材の増減時だけでなく、これらの変更時にもscan assetコマンドを実行してください。</p>

<ul>
<li>画像素材の幅・高さ</li>
<li>(将来のバージョンにおいて) 音素材の再生時間</li>
</ul>

<p>またscan assetコマンドは新たに追加するアセット定義に対し、typeに応じて以下の初期値を与えます(値の詳細は<a href="/guide/game-json.html">game.jsonの仕様</a>を参照してください)。</p>

<ul>
<li>&quot;type&quot;: &quot;script&quot;
	<ul>
	<li>&quot;global&quot;: true</li>
	</ul>
</li>
<li>&quot;type&quot;: &quot;audio&quot;
	<ul>
	<li>&quot;systemId&quot;: &quot;sound&quot;</li>
	</ul>
</li>
</ul>

<p>scan asset コマンドによる素材の列挙は、ディレクトリを再帰的に検索します。つまり、image/のサブディレクトリに置かれた画像素材なども、列挙されアセット情報に登録されます。</p>
<p>各素材をアセットとして使用するには、アセットを識別するID(アセットID)が必要になります。scan assetコマンドは、アセットIDとして「ファイル名から拡張子を取り除いたもの」を設定します(このため、audio/title.oggとscript/title.jsは、同じ &quot;title&quot; というIDとなって衝突し、エラーになります)。また、ファイル名は以下の条件を全て満たす必要があります。</p>

<ul>
<li>半角英数字、アンダースコア &quot;_&quot;、ドル記号 &quot;$&quot; のみで構成されている</li>
<li>英字で始まっている</li>
</ul>

<p>ユーザはgame.jsonを直接編集して、アセットIDを任意に変更することができます。akashicコマンドはファイルパスを基準に操作を行うため、たとえば画像素材のIDを変更した後にその画像のサイズを変更しても、適切にgame.jsonの幅・高さ情報を更新します。</p>

<h2 id="install" name="install">install</h2>

<pre><code>akashic install [&lt;module&gt;]</code></pre>

<p><code>npm install</code>のラッパーコマンドです。</p>
<p><code>&lt;module&gt;</code>を与えた場合、<code>npm install --save &lt;module&gt;</code>と<code>npm shrinkwrap</code>を行い、また導入されたファイルの一覧をgame.jsonに加えます。
すなわち次のコマンドと概ね等価な振る舞いをします。</p>

<pre><code>npm install --save &lt;module&gt;
npm shrinkwrap
akashic scan globalScripts</code></pre>

<p>@akashic-extension/で提供されるAkashic向けの拡張機能の他、任意のnpmパッケージをゲームに導入することができます。</p>

<blockquote>
<p>注意: AkashicはNode.jsのコアモジュール(<code>http</code>,<code>path</code>など)をサポートしていません。コアモジュールに依存しているパッケージを導入した場合、エラーメッセージが表示されます。この場合、<code>npm install</code>は行われ、game.jsonも更新されますが、ゲームとして実行しようとするとエラーになります。</p>
<p>またブラウザ固有の機能や、ECMAScriptの一部機能 (<code>Math.random()</code>のような内部状態を持つ機能など) は、Akashicのゲームとしてはサポートされていません。それらの機能を用いるnpmパッケージを導入しないでください(akashicコマンド はこれにエラーを出すことはできません)。</p>
</blockquote>

<p>このコマンドは<code>npm install</code>を行うため、game.jsonと同じディレクトリにpackage.jsonという名前のファイルが存在する必要があります。事前に<code>npm init</code>を行うなどの方法で作成してください(<code>akashic init</code>が提供するビルトインのテンプレートには含まれています)。</p>
<p><code>&lt;module&gt;</code>を省略した場合、単に<code>npm install</code>を行います(package.json に依存生が記録されたパッケージが導入されます)。game.jsonは更新されません。npm-shrinkwrap.json がない場合、利用しないでください(意図しないバージョンのパッケージが導入される可能性があります)。</p>

<h2 id="uninstall" name="uninstall">uninstall</h2>

<pre><code>akashic uninstall &lt;module&gt;</code></pre>

<p><code>npm uninstall --save &lt;module&gt;</code>を行い、<code>npm shrinkwrap</code>して、削除されたファイルをgame.jsonから取り除きます。</p>
<p>(installコマンド同様、game.jsonと同じディレクトリにpackage.jsonという名前のファイルが存在する必要があります)</p>

<h2 id="update" name="update">update</h2>

<pre><code>akashic update &lt;module&gt;</code></pre>

<p><code>npm update &lt;module&gt;</code>を行い、./node_modules 以下のnpmパッケージを更新します。ファイルの変更はgame.jsonに反映されます。</p>
<p>(installコマンド同様、game.jsonと同じディレクトリにpackage.jsonという名前のファイルが存在する必要があります)</p>

<p><code>&lt;module&gt;</code>を指定しなかった場合、全てのnpmパッケージを更新します。npm updateの詳細は<a href="https://docs.npmjs.com/cli/update/">npmのドキュメント</a>を参照してください。</p>

<h2 id="export-zip" name="export-zip">export zip</h2>

<pre><code>akashic export zip [--output &lt;fileName&gt;] [--exclude &lt;excludedFileName&gt;]</code></pre>

<p>ゲームディレクトリをzip形式で圧縮したファイルを<code>&lt;fileName&gt;</code>に出力します。<code>--output</code>オプションが指定されなかった場合、<code>./game.zip</code>が指定されたかのように振る舞います。存在するファイル名・ディレクトリ名を指定した場合、エラーになります。</p>

<p><code>--exclude</code>オプションが指定された場合、指定されたファイル<code>&lt;excludedFileName&gt;</code>は出力から除外されます。複数のファイルを除外したい場合は、次のように複数回<code>--exclude</code>を指定してください。</p>

<pre><code>akashic export zip --exclude foo --exclude bar
</code></pre>

<p><code>--exclude</code>オプションが指定されなかった場合、次の名前が指定されたものとして振る舞います。</p>

<ul>
<li>./npm-shrinkwrap.json</li>
<li>./package.json</li>
</ul>

<h2 id="export-html" name="export-html">export html</h2>

<pre><code>akashic export html --output &lt;dirName&gt; [--bundle] [--strip] [--minify] [--magnify]</code></pre>

<p>単独でゲームを実行可能なHTMLファイル(と関連ファイル)を含むディレクトリを出力します。出力されたディレクトリのindex.htmlをWebブラウザで開くことで、akashic-sandboxなどの動作確認ツールなしにゲームを実行できます。</p>
<p>利用可能なオプションは次のとおりです:</p>

<ul>
<li><code>--output &lt;dirName&gt;</code>: 出力するフォルダを<code>&lt;dirName&gt;</code>にする(必須)</li>
<li><code>--bundle</code>: スクリプトアセットやテキストアセットなど、可能なものをindex.htmlにまとめる</li>
<li><code>--strip</code>: ゲーム実行に不要なファイルを出力から除外する</li>
<li><code>--minify</code>: スクリプトアセットをminifyする</li>
<li><code>--magnify</code>: ゲーム画面をブラウザのウィンドウサイズに合わせて拡縮するようにする</li>
</ul>

<p><code>--output</code>オプションに存在するファイル名・ディレクトリ名を指定した場合、エラーになります。またゲームのディレクトリ以下のパスを指定することはできません。たとえばgame.json のあるディレクトリで次のように指定するとエラーになります。</p>

<pre><code>$ akashic export html --output ./bundled  # エラー</code></pre>

<p><code>./bundled</code>ではなく<code>../bundled</code>にするなど、ゲームのディレクトリの外を指定してください。この場合、<code>../bundled/index.html</code>をWebブラウザで開くと、単独でゲームを実行できます(ゲーム実行には<code>../bundled/</code>以下のファイルがすべて必要である点に注意してください)。</p>

<pre><code>$ akashic export html --output ../bundled</code></pre>

<h2 id="stat" name="stat">stat</h2>

<pre><code>akashic stat &lt;target&gt; [options...]</code></pre>

<p><code>&lt;target&gt;</code>で指定された内容に関して情報を収集して出力します。現在<code>&lt;target&gt;</code>に与えられるのは<code>size</code>のみです。</p>

<h3 id="ゲームの容量計算(size)" name="ゲームの容量計算(size)">ゲームの容量計算(size)</h3>

<p><code>&lt;target&gt;</code>に<code>size</code>を指定すると、ゲームの容量を計算します。ゲームの容量とはゲームを配信する際にネットワーク通信が必要なコンテンツのファイルサイズの合計のことです。</p>
<p>何もオプションを付けずに実行した場合、以下のように表示されます。</p>

<pre><code>$ akashic stat size
image: 415.49KB (84%)
text: 25.60KB (5%)
ogg audio: 47.74KB
mp4 audio: 53.02KB (11%)
aac audio: 52.71KB
script: 641B (0%)
other: 1.44KB (0%)
  game.json: 1.44KB
[ ] TOTAL SIZE (using ogg): 490.90KB (502685B)
[*] TOTAL SIZE (using mp4): 496.19KB (508096B)
[ ] TOTAL SIZE (using aac): 495.87KB (507775B)</code></pre>

<p>オーディオはmp4とaacとoggのうち合計容量が大きいものを利用して計算します。結果表示の<code>(87%)</code>の部分は全体用量に占めるそのカテゴリのファイルの割合を示しています。<code>game.json</code>,<code>node_moduels/</code>以下のスクリプトは<code>other</code>に分類されます。</p>
<p><code>--limit</code>オプションが指定されると、ゲームの容量が指定された値を超えた場合にエラーと表示され、コマンド自体の戻り値が正常終了時の<code>0</code>ではなく<code>1</code>になります。</p>
<p>容量は<code>--limit 100KB</code>のように指定します。<code>1KB</code>は<code>1024B</code>として計算されます。単位として、<code>B</code>,<code>KB</code>,<code>MB</code>,<code>GB</code>が利用でき、末尾の<code>B</code>は省略できます。</p>

<p><code>--raw</code>オプションが指定されると、以下のように合計容量のバイト数のみを表示して終了します。</p>

<pre><code>$ akashic stat size --raw
1657274</code></pre>

<h2 id="initで作られるファイル" name="initで作られるファイル">initで作られるファイル</h2>

<h3 id="imageディレクトリ" name="imageディレクトリ">imageディレクトリ</h3>

<p>画像素材を配置するディレクトリ。</p>
<p>サポートされる拡張子はpng/jpgであり、拡張子と画像フォーマットは一致している必要があります。それ以外の拡張子のファイル、または &quot;.&quot; から始まるファイルは無視されます。</p>

<h3 id="textディレクトリ" name="textディレクトリ">textディレクトリ</h3>

<p>テキスト素材を配置するディレクトリ。</p>
<p>サポートされる拡張子は特に指定がないため、&quot;.&quot; から始まるファイル以外はすべて取り込まれます。<em>取り込まれないファイルを指定する方法は検討中。</em></p>

<h3 id="audioディレクトリ" name="audioディレクトリ">audioディレクトリ</h3>

<p>音楽、効果音など、音素材を配置するディレクトリ。</p>
<p>サポートされる拡張子はoggとaacであり、拡張子とファイルフォーマットは一致している必要があります。それ以外の拡張子のファイル、または &quot;.&quot; から始まるファイルは無視されます。</p>
<p>他の素材と異なり、音素材は、ファイル名の拡張子部分のみが異なる複数のファイルをまとめて取り扱います。それら(audio/foo.oggとaudio/foo.aacなど)は同一の内容であることが期待されます。これはゲームの実行環境に応じて適切な形式を選択し利用するためです。</p>

<h3 id="scriptディレクトリ" name="scriptディレクトリ">scriptディレクトリ</h3>

<p>スクリプト素材を配置するディレクトリ。</p>
<p>サポートされる拡張子は.jsと.jsonであり、拡張子とファイルフォーマットは一致している必要があります。それ以外の拡張子のファイル、または &quot;.&quot; から始まるファイルは無視されます。</p>
<p>慣習として、各Sceneを実装するファイルは、このディレクトリ内に &quot;Scene.js&quot; という接尾辞をつけて配置される事が推奨されます(例：titleScene.js,battleScene.js)。</p>

<h3 id="mainScene.jsファイル" name="mainScene.jsファイル">mainScene.jsファイル</h3>

<p>メインシーン。Akashicのゲームのエントリポイントであり、ゲームは必ず本シーンから実行されます。</p>
<p>akashic initを実行した直後は以下の内容になっています。</p>

<pre><code>var game = g.game;
module.exports = function() {
    var scene = new g.Scene({game: game});
    scene.loaded.add(function() {
        // ここにゲームのコードを記述します
        // sample
        var hello = new g.FilledRect({scene: scene, cssColor: &quot;#ff0000&quot;, width: 32, height: 32});
        scene.append(hello);
        hello.update.add(function() {
            hello.x++;
            hello.modified();
        });
    });
    return scene;
}d=</code></pre>

<h3 id="node_modulesディレクトリ" name="node_modulesディレクトリ">node_modulesディレクトリ</h3>

<p>各種ライブラリを配置するディレクトリ。</p>
<p>このディレクトリにはakashic installで追加されたnpmパッケージが配置されます。パッケージファイルはinstallやuninstallコマンドによって管理され、通常はゲーム開発者が操作する必要はありません。</p>

<h3 id="game.jsonファイル" name="game.jsonファイル">game.jsonファイル</h3>

<p>ゲームの各種情報を記述するファイル。</p>
<p>akashic initを実行した直後は以下のような内容になっています(ただし width,height,fps はinitで指定した値)。</p>

<pre><code>{
    &quot;width&quot;: 480,
    &quot;height&quot;: 480,
    &quot;fps&quot;: 30,
    &quot;assets&quot;: {
        &quot;mainScene&quot;: {
            &quot;type&quot;: &quot;script&quot;,
            &quot;path&quot;: &quot;script/mainScene.js&quot;,
            &quot;global&quot;: true
        }
    }
}</code></pre>

<p>詳細な仕様は<a href="/guide/game-json.html">game.jsonの仕様</a>を参照してください。</p>

<h2 id="Node.js開発者向けの追加情報" name="Node.js開発者向けの追加情報">Node.js開発者向けの追加情報</h2>

<p>akashicは、install,uninstallコマンドを除き、package.jsonに関知しません。</p>
<p>ゲーム開発者は、npm install --save-dev jasmineしてspecディレクトリにテストを配置するなど、任意の開発フローを(Akashicのディレクトリ構成と衝突するなどの問題がない限り)とることができます。</p>

</div>
</section>
<!--↑ボディ↑-->
<!--↓フッタ↓-->
{% include footer.html %}
<!--↑フッタ↑-->
</div></body>
</html>